(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9650],{95565:function(e,t,a){Promise.resolve().then(a.bind(a,58534))},58534:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return e7}});var l=a(91104),i=a(26816),s=a(41116),r=a(63137),n=a(1218),o=a(36623),c=a(41908),d=a(29125);let m=()=>(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(c.c,{size:"sm",color:"white"}),"Connecting to server"]}),u=(0,d.D)(()=>{(0,o.yv)((0,l.jsx)(m,{}),{key:"reconnect",variant:"warning",hideIconVariant:!0,preventDuplicate:!0,persist:!0})},1e3),p=()=>{let{profile:e}=(0,s.useProfile)(),[t,a]=(0,r.useState)(null),[l,i]=(0,r.useState)(null),c=(0,r.useRef)(!1),d=(0,r.useCallback)(()=>{if(!e)return;let t=new WebSocket("".concat((0,n.s)(),"/").concat(e.user.id));return t.onopen=()=>{console.log("Connected to server"),(0,o.sy)()},t.onclose=()=>{!0!==c.current&&(console.log("Disconnected from server"),setTimeout(()=>{d()},2e3),u())},a(t),t},[e]);return(0,r.useEffect)(()=>{n.p.getConfig().then(i)},[]),(0,r.useEffect)(()=>{let e=d();return c.current=!1,()=>{e&&e.close(),c.current=!0,(0,o.sy)()}},[d]),{socket:t,config:l}};var h=a(82833),x=a(33968),g=a(49242),f=a(98644),w=a(63234);function v(){return Math.floor(1e12*Math.random())}let b={id:"",src:"",prevSrc:"",width:1024,height:1024,posPrompt:"",negPrompt:"",isExpandedPrompt:!1,seed:v(),seedType:"random",topText:"",bottomText:"",guidanceScale:2.7,selectedAspectRatio:"square",selectedCharacter:{name:"Apu Apustaja",id:"apu_apustaja",images:{"hand-drawn":"https://memedeckblob.blob.core.windows.net/ai-characters/hand-drawn-apu-apustaja.png",photorealistic:"https://memedeckblob.blob.core.windows.net/ai-characters/photorealistic-apu-apustaja.png","ms-paint":"https://memedeckblob.blob.core.windows.net/ai-characters/ms-paint-apu-apustaja.png","pixel-art":"https://memedeckblob.blob.core.windows.net/ai-characters/pixel-art-apu-apustaja.png",cinematic:"https://memedeckblob.blob.core.windows.net/ai-characters/cinematic-apu-apustaja.png"}},selectedStyler:{name:"Anime",id:"anime",images:null},progress:0,isGenerating:!1,isRandomizing:!1},y={faceImage:"",baseImage:"",baseWidth:void 0,baseHeight:void 0,swappedImage:"",strength:1},j={text:""},_=[{idx:0,id:"0",type:"generated",image:{...b},text:{...j},faceswap:{...y}},{idx:1,id:"1",type:"generated",image:{...b},text:{...j},faceswap:{...y}},{idx:2,id:"2",type:"generated",image:{...b},text:{...j},faceswap:{...y}},{idx:3,id:"3",type:"generated",image:{...b},text:{...j},faceswap:{...y}}],N=(e,t)=>{switch(t.action){case"reset":return e.map(e=>e.idx!==t.idx?e:{...e,image:{...e.image,...b},text:{...e.text,...j},faceswap:{...e.faceswap,...y}});case"blank-slate":return[..._];case"update-panel":return e.map(e=>{var a,l;return e.idx!==t.idx?e:{...e,id:null!==(a=t.id)&&void 0!==a?a:e.id,type:null!==(l=t.type)&&void 0!==l?l:e.type,image:{...e.image,...t.image},text:{...e.text,...t.text},faceswap:{...e.faceswap,...t.faceswap}}});case"delete":return e.filter(e=>e.idx!==t.idx);default:return console.error("Unknown action type"),e}},k=(0,d.k)(x.P.updateMemePanel,1e3),C=(0,d.k)(x.P.postMemeTextOverlay,1e3);function z(e,t){return Object.values(e).map(e=>{var a,l,i,s,r,n,o,c,d,m,u,p,h,x,g,f,v,_,N,k,C,z,A,S,P,O,R,I;let E="text"===e.panel_type,W="generated"===e.panel_type,F="faceswap"===e.panel_type,D=e.panel_config,T=e.panel_config,L=e.panel_config,M={idx:e.idx,id:e.id,type:e.panel_type,image:{...b},text:{...j},faceswap:{...y}};if(E&&D)return{...M,text:{text:D.text}};if(F&&L)return{...M,image:{...b,src:null!==(a=L.swapped_image)&&void 0!==a?a:"",selectedAspectRatio:(0,w.vO)(null!==(l=null==L?void 0:L.base_width)&&void 0!==l?l:1024,null!==(i=null==L?void 0:L.base_height)&&void 0!==i?i:1024)},faceswap:{...y,baseWidth:null==L?void 0:L.base_width,baseHeight:null==L?void 0:L.base_height,baseImage:null!==(s=L.base_image)&&void 0!==s?s:"",faceImage:null!==(r=L.face_image)&&void 0!==r?r:"",swappedImage:null!==(n=L.swapped_image)&&void 0!==n?n:"",strength:null!==(o=L.strength)&&void 0!==o?o:1}};if(!W||!T)return M;{let e=null===(c=T.prompt)||void 0===c?void 0:c.character,a=e&&"string"==typeof e&&null!==(N=t.characters.find(t=>t.id===e.replace("ai_character:","")))&&void 0!==N?N:b.selectedCharacter,l=null===(d=T.prompt)||void 0===d?void 0:d.styler,i=l&&"string"==typeof l&&null!==(k=t.stylers.find(e=>e.id===l.replace("ai_image_style:","")))&&void 0!==k?k:b.selectedStyler;return{...M,image:{...b,src:null!==(C=null===(m=T.meme)||void 0===m?void 0:m.url)&&void 0!==C?C:"",width:null!==(z=null===(u=T.meme)||void 0===u?void 0:u.width)&&void 0!==z?z:1024,height:null!==(A=null===(p=T.meme)||void 0===p?void 0:p.height)&&void 0!==A?A:1024,posPrompt:null!==(S=null===(h=T.prompt)||void 0===h?void 0:h.user_positive_prompt)&&void 0!==S?S:"",negPrompt:null!==(P=null===(x=T.prompt)||void 0===x?void 0:x.user_negative_prompt)&&void 0!==P?P:"",guidanceScale:null!==(O=null===(g=T.prompt)||void 0===g?void 0:g.cfg_scale)&&void 0!==O?O:2.7,selectedCharacter:a,selectedStyler:i,...T.text_overlay,topText:null!==(R=null===(f=T.text_overlay)||void 0===f?void 0:f.top_text)&&void 0!==R?R:"",bottomText:null!==(I=null===(v=T.text_overlay)||void 0===v?void 0:v.bottom_text)&&void 0!==I?I:"",id:null===(_=T.meme)||void 0===_?void 0:_.id}}}})}let A=(0,r.createContext)({});var S=a(4180),P=a(60402),O=a(53433),R=a(11563);let I=e=>{let{profile:t,socket:a,config:i,queryParams:s,children:c}=e,{appendMemesToFeed:d,removeItemFromFeed:m}=(0,P.useFeed)(),[u,p]=(0,r.useState)(null),[h,b]=(0,r.useState)(null),[y,j]=(0,r.useState)(null),[I,E]=(0,r.useState)(null),[W,F]=(0,r.useState)(0),[D,T]=(0,r.useState)("generated"),[L,M]=(0,r.useState)(g.W.One),[H,U]=(0,r.useReducer)(N,_),[G,J]=(0,r.useState)([]),[V,q]=(0,r.useState)([]),[B,Y]=(0,r.useState)(!1),[Z,K]=(0,r.useState)(!1),[Q,X]=(0,r.useState)(!1),[$,ee]=(0,r.useState)(!1),[et,ea]=(0,r.useState)(!1),[el,ei]=(0,r.useState)(!1),[es,er]=(0,r.useState)(!1),en=(0,r.useMemo)(()=>H.slice(0,w._j[L]).some(e=>"text"===e.type?""===e.text.text:"generated"!==e.type&&"faceswap"!==e.type||""===e.image.src||e.image.isGenerating),[H,L]),eo=(0,r.useMemo)(()=>H.some(e=>e.image.isGenerating),[H]),ec=(0,r.useMemo)(()=>H.find(e=>e.idx===W),[H,W]),ed=(0,r.useCallback)(e=>{let t=null!=e?e:(0,S.uZ)();p(t);let a=new URL(window.location.href);return a.searchParams.set("meme",t.replace("meme:","")),window.history.replaceState({},"",a.toString()),t},[]),em=(0,r.useCallback)(async(e,t,a)=>{let l=Object.entries(null!=a?a:{}).slice(0,w._j[t]),i=a?Object.fromEntries(l):void 0,s=await x.P.createComposedMeme({meme_id:e,panel_layout:t,panel_config_init:i});if(!s)throw Error("Failed to create composed meme");return s},[]),eu=(0,r.useCallback)(e=>{let t={};return"generated"===e.type?t={meme:e.image.id}:"text"===e.type?t={text:e.text.text}:"faceswap"===e.type&&(t={swapped_image:e.faceswap.swappedImage,face_image:e.faceswap.faceImage,base_image:e.faceswap.baseImage,base_width:e.faceswap.baseWidth,base_height:e.faceswap.baseHeight,strength:e.faceswap.strength}),t},[]),ep=(0,r.useCallback)(()=>{U({action:"reset",idx:W})},[W]),eh=(0,r.useCallback)(async()=>{var e,t;U({action:"update-panel",idx:W,image:{isRandomizing:!0}});let a=await n.p.getRandomPrompt();U({action:"update-panel",idx:W,image:{posPrompt:a.user_positive_prompt,negPrompt:a.user_negative_prompt,seed:v(),seedType:"random",topText:"",bottomText:"",guidanceScale:a.cfg_scale,selectedAspectRatio:a.aspect_ratio,selectedCharacter:null!==(e=i.characters.find(e=>e.id===a.character.replace("ai_character:","")))&&void 0!==e?e:i.characters[0],selectedStyler:null!==(t=i.stylers.find(e=>e.id===a.styler.replace("ai_image_style:","")))&&void 0!==t?t:i.stylers[0],isRandomizing:!1}})},[i.characters,i.stylers,W]),ex=(0,r.useCallback)(async(e,t,a)=>{if(U({action:"update-panel",idx:e,text:{text:a}}),!u)throw Error("Failed to find composed meme id");let l=await k(u,t,{panel_type:"text",panel_config:{text:a}});J(e=>{let t=e.findIndex(e=>e.id===u);if(-1===t)return e;let a={...e[t].panels,[W]:l},i={...e[t],panels:a};return[...e.slice(0,t),i,...e.slice(t+1)]})},[u,W]),eg=(0,r.useCallback)((e,t,a)=>{var l,i;if(U({action:"update-panel",idx:e,image:{[t]:a}}),!u)throw Error("Failed to find composed meme id");let s=H.find(t=>t.idx===e);if(!s)throw Error("Failed to find active panel");let r="topText"===t,n={top_text:a,bottom_text:null!==(l=s.image.bottomText)&&void 0!==l?l:""},o={top_text:null!==(i=s.image.topText)&&void 0!==i?i:"",bottom_text:a},c={top_text_size:"md",bottom_text_size:"md",additional_config:null,...r?n:o};C(s.image.id,c)},[u,H]),ef=(0,r.useCallback)(async e=>{ed(e.id),e.posts&&e.posts.length>0?E(e.posts[0]):E(null),M(e.panel_layout);let t=e.panels,a=[],l=(a=t&&Object.keys(t).length>0?z(t,i):_)[0];F(0),"text"===l.type?T("text"):l.faceswap.baseImage||l.faceswap.faceImage?T("faceswap"):T("generated"),U({action:"blank-slate"}),a.map(e=>{let t=e.image,a=e.text,l=e.faceswap;U({idx:e.idx,id:e.id,action:"update-panel",type:e.type,image:t,text:a,faceswap:l})})},[i,ed]),ew=(0,r.useCallback)(e=>{if(!u)throw Error("Failed to find composed meme id");let t=(0,w.vO)(e.width,e.height);U({action:"update-panel",idx:W,type:"generated",image:{...e.prompt,width:e.width,height:e.height,id:e.id,src:e.url,prevSrc:e.url,selectedAspectRatio:t}}),J(a=>{var l;let i=a.findIndex(e=>e.id===u);if(-1===i)return a;let s=W.toString(),r=a[i],n={...r,panels:{...r.panels,[s]:{...null===(l=r.panels)||void 0===l?void 0:l[s],id:e.id,idx:W,panel_type:"generated",panel_config:{meme:{...e,prompt:{aspect_ratio:t}},prompt:{...e.prompt,aspect_ratio:t},text_overlay:e.text_overlay},created_at:1e6*Date.now()}}};return[...a.slice(0,i),n,...a.slice(i+1)]}),k(u,H[W].id,{panel_type:"generated",panel_config:{meme:e.id}})},[W,u,H]),ev=(0,r.useCallback)(e=>{if(e===W)return;F(e);let t=H.find(t=>t.idx===e);if(!t)throw Error("Failed to find active panel");console.log("clicking pane",t),"generated"!==t.type||t.image.posPrompt?T(t.type):T("library")},[W,H]),eb=(0,r.useCallback)(e=>{T(e),U({action:"update-panel",idx:W,type:(0,f.JY)(e)})},[W]),ey=(0,r.useCallback)(async e=>{E(null),F(0),ea(!0);let a=e.panel_layout,l=e.panels;if(!l||!a)throw Error("No panels found in meme");let s=z(l,i),r=ed();try{await em(r,a,{...Object.fromEntries(Object.entries(s).map(e=>{let[t,a]=e;return[t,{panel_type:a.type,panel_config:eu(a)}]}))})}catch(e){throw(0,o.yv)("Failed to remix meme",{variant:"error"}),Error("Failed to init panels server side")}finally{ea(!1)}let n={id:r,source:"composed",panel_layout:a,panels:l,by:t.user.id};J(e=>[n,...e]),ef(n);let c=new URL(window.location.href);c.searchParams.delete("remix"),window.history.replaceState({},"",c.toString())},[i,em,ef,eu,t.user.id,ed]),ej=(0,r.useCallback)(async e=>{if(e===L)return;M(e),F(0);let t={};if(e===g.W.TwoVertical)t={selectedAspectRatio:"landscape"};else if(e===g.W.TwoHorizontal)t={selectedAspectRatio:"portrait"};else if(e===g.W.Four)t={selectedAspectRatio:"square"};else{let e=null==ec?void 0:ec.image.selectedAspectRatio;t={selectedAspectRatio:null!=e?e:"square"}}if(U({action:"update-panel",idx:W,image:t}),J(t=>{let a=t.findIndex(e=>e.id===u);if(-1===a)return t;let l={...t[a],panel_layout:e};return[...t.slice(0,a),l,...t.slice(a+1)]}),!u)throw Error("Failed to find composed meme id");x.P.updateComposedMemeLayout(u,{panel_layout:e})},[ec,W,u,L]),e_=(0,r.useCallback)(async e=>{ea(!0);let a=ed(),l=await em(a,L,{});e&&"string"==typeof e&&(l={...l,0:{...l[0],panel_config:{...l[0].panel_config,prompt:{...l[0].panel_config.prompt,character:e}}}}),U({action:"blank-slate"}),Object.values(l).map(e=>{U({action:"update-panel",idx:e.idx,id:e.id})}),J(e=>{let i={id:a,source:"composed",panel_layout:L,panels:l,by:t.user.id};return ef(i),[i,...e]}),ea(!1)},[em,ef,t.user.id,L,ed]),eN=(0,r.useCallback)(async e=>{let t=i.characters.find(t=>t.id===e);if(t)console.log("Found character",t);else throw Error("Failed to find character");U({action:"update-panel",idx:0,image:{selectedCharacter:t}}),await e_(e);let a=new URL(window.location.href);a.searchParams.delete("character"),window.history.replaceState({},"",a.toString())},[i.characters,e_]),ek=(0,r.useCallback)(async e=>{let t=e.filter(e=>e.is_creator);J(t);let{remixMemeId:a,memeId:l,characterId:i}=s,r=()=>{t[0]&&ef(t[0])};try{let e;let i=null!=a?a:l;if(i&&(t.find(e=>e.id.replace("meme:","")===i)||(e=await x.P.getMeme(i)),!e))throw Error("Failed to find matching meme from remixId");a?ey(e):l?ef(e):r()}catch(e){console.error(e),r()}i&&eN(i)},[s,ef,eN,ey,J]),eC=(0,r.useCallback)(async()=>{if(u)try{K(!0);let e=async()=>{let e=await x.P.getLibrary({source:["composed"],start:0,limit:1});e?ek(e):await e_()};J(t=>{let a=t.findIndex(e=>e.id===u);if(-1===a)return t;t[a+1]?ef(t[a+1]):t[a-1]?ef(t[a-1]):(U({action:"blank-slate"}),p(null),b(null),j(null),E(null),M(g.W.One),T("generated"));let l=[...t.slice(0,a),...t.slice(a+1)];return 0===l.length&&e(),l});let t=new URL(window.location.href);t.searchParams.delete("meme"),window.history.replaceState({},"",t.toString()),await x.P.deleteMeme(u)}catch(e){(0,o.yv)("Failed to delete meme",{variant:"error"})}finally{K(!1)}},[u,ef,e_,ek]),ez=(0,r.useCallback)(async()=>{if(I)try{X(!0),await x.P.deletePost(I),E(null),J(e=>{let t=e.findIndex(e=>e.id===u);return -1===t?e:[...e.slice(0,t),{...e[t],posts:[]},...e.slice(t+1)]}),m(I)}catch(e){(0,o.yv)("Failed to delete post",{variant:"error"})}finally{X(!1)}},[u,I,m]),eA=(0,r.useCallback)(async(e,a)=>{let l=a.slice(0,w._j[e]);try{ee(!0),U({action:"blank-slate"}),Object.values(l).map(e=>{U({action:"update-panel",...e})});let a=ed();await em(a,e,{...Object.fromEntries(Object.entries(l).map(e=>{let[t,a]=e;return[t,{panel_type:a.type,panel_config:eu(a)}]}))}),J(l=>[{id:a,source:"composed",panel_layout:e,panels:function(e){let t={};return e.forEach(e=>{"text"===e.type?t[e.idx]={idx:e.idx,id:e.id,panel_type:"text",panel_config:{text:e.text.text},created_at:1e3*Date.now()}:t[e.idx]={idx:e.idx,id:e.id,panel_type:"generated",panel_config:{meme:{id:e.image.id,url:e.image.src,width:e.image.width,height:e.image.height},prompt:{user_positive_prompt:e.image.posPrompt,user_negative_prompt:e.image.negPrompt,cfg_scale:e.image.guidanceScale,character:"ai_character:".concat(e.image.selectedCharacter.id),styler:"ai_image_style:".concat(e.image.selectedStyler.id),aspect_ratio:e.image.selectedAspectRatio},text_overlay:{top_text:e.image.topText,bottom_text:e.image.bottomText}},created_at:1e3*Date.now()}}),t}(H),prompt:{aspect_ratio:w.W$[e]},by:t.user.id},...l]),E(null)}catch(e){(0,o.yv)("Failed to duplicate post",{variant:"error"})}finally{ee(!1)}},[em,eu,H,t.user.id,ed]),eS=(0,r.useCallback)((e,t,l,i)=>{var s;let r=H[e],n={panel_id:r.id,faceswap_strength:r.faceswap.strength,face_image:t,base_image:l,base_width:i.width,base_height:i.height},o=u;o||(console.warn("No composed meme_id in memory, generating a new one"),o=ed());let c={kind:"generate_faceswap",meme_id:o,panel_index:e,panel_layout:L,data:n};console.log("Generating faceswap",c),U({idx:e,action:"update-panel",type:"faceswap",image:{isGenerating:!0,src:void 0,prevSrc:null===(s=H[e])||void 0===s?void 0:s.image.src,seed:0},text:{text:""}}),a.send(JSON.stringify(c))},[u,ed,H,L,a]),eP=(0,r.useCallback)((e,l)=>{let i=l.image,s="fixed"===i.seedType?i.seed:v(),r={workflow:"combined",quality:"fast",do_prompt_expansion:i.isExpandedPrompt,user_id:t.user.id,positive_prompt:i.posPrompt,negative_prompt:i.negPrompt,seed:s,top_text:i.topText,bottom_text:i.bottomText,aspect_ratio:L!==g.W.One?w.W$[L]:i.selectedAspectRatio,character:i.selectedCharacter.id?{id:i.selectedCharacter.id,strength_model:1}:null,styler:i.selectedStyler.id?{id:i.selectedStyler.id,strength_model:1}:null,cfg_scale:i.guidanceScale},n=w.e5[i.selectedAspectRatio];U({idx:e,action:"update-panel",type:"generated",image:{isGenerating:!0,src:void 0,prevSrc:i.src,seed:s,width:n[0],height:n[1]},text:{text:""},faceswap:{faceImage:void 0,baseImage:void 0,strength:1}});let o=u;o||(console.warn("No composed meme_id in memory, generating a new one"),o=ed());let c={kind:"generate_image",meme_id:o,data:r};console.log("sending payload",c=L!==g.W.One?{...c,panel_index:e,panel_layout:L}:{...c,panel_index:0,panel_layout:g.W.One}),a.send(JSON.stringify(c))},[u,t.user.id,L,ed,a]),eO=(0,r.useCallback)(async()=>{if(!u)throw Error("Failed to post composed meme");try{Y(!0);let e=await (0,R.jt)(H,L),a=H.find(e=>0===e.idx);if(!a)throw Error("Failed to find first panel");let{canvasWidth:l,canvasHeight:i}=(0,O.G)(L,a),s={filetype:"image/jpeg",bytes:Array.from(new Uint8Array(e)),width:l,height:i},r=await x.P.composedUpload(u,s).catch(e=>(console.error("Failed to compile composed meme",e),null));if(!r)throw Error("Failed to post composed meme");b(r.url),j(e);let n=await x.P.createPost({post_type:{meme:u}}).catch(e=>{throw console.error("Failed to post composed meme",e),e});if(!n)throw Error("Failed to post composed meme");let o={id:u,url:r.url,posts:[n.id],width:s.width,height:s.height};E(n.id),d([o],t),er(!0)}catch(e){console.error("Failed to compile composed meme",e)}finally{Y(!1)}},[d,u,H,t,L]);return(0,r.useEffect)(()=>{a.onmessage=e=>{let a=H.find(e=>e.image.isGenerating);if(!a){console.error("Failed to find generating panel");return}if("faceswap_generated"===(e=JSON.parse(e.data)).type){console.log("Faceswap generated",e);let t=e.data,l=new Uint8Array(t),i=new Blob([l],{type:"image/jpeg"}),s=new FileReader;s.onloadend=()=>{let t=s.result;U({idx:a.idx,action:"update-panel",type:"faceswap",image:{src:t,progress:100,isGenerating:!1,width:e.dimensions[0],height:e.dimensions[1],selectedAspectRatio:(0,w.vO)(e.dimensions[0],e.dimensions[1])},faceswap:{swappedImage:t,baseWidth:e.dimensions[0],baseHeight:e.dimensions[1]}});let l={id:e.id,url:t,width:e.dimensions[0],height:e.dimensions[1],created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()};J(e=>{let i=e.findIndex(e=>e.id===u);if(-1===i)return e;let s=e[i].panels,r={id:a.id,idx:a.idx,panel_type:"generated",panel_config:{meme:l,base_image:a.faceswap.baseImage,face_image:a.faceswap.faceImage,base_width:a.faceswap.baseWidth,base_height:a.faceswap.baseHeight,swapped_image:t},created_at:1e6*Date.now()},n={...s,[a.idx]:r},o={...e[i],panels:n};return[...e.slice(0,i),o,...e.slice(i+1)]})},s.readAsDataURL(i)}else if("image_generating"===e.type||"image_generating"===e.kind){let t=e.data,l=new Uint8Array(t),i=new Blob([l],{type:"image/jpeg"}),s=new FileReader;s.onloadend=()=>{let t=s.result;U({idx:a.idx,action:"update-panel",image:{src:t,progress:e.progress}})},s.readAsDataURL(i)}else if("image_generated"===e.kind||"meme_created"===e.type){let l=e.data,i=new Uint8Array(l),s=new Blob([i],{type:"image/jpeg"}),r=new FileReader;r.onloadend=()=>{var l,i;let s=e.id,n=e.prompt_config,o=r.result;if(!a)throw Error("Failed to find active panel");let c={top_text:null!==(l=a.image.topText)&&void 0!==l?l:"",bottom_text:null!==(i=a.image.bottomText)&&void 0!==i?i:"",top_text_size:"md",bottom_text_size:"md",additional_config:null},d={id:s,url:o,prompt:{...n,seed:"random"===a.image.seedType?v():n.seed,styler:n.styler.id,character:n.character.id,user_positive_prompt:n.positive_prompt,user_negative_prompt:n.negative_prompt},text_overlay:{...c,created_at:1e6*Date.now(),updated_at:1e6*Date.now()},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()};if(U({idx:a.idx,action:"update-panel",type:"generated",image:{id:s,src:o,prevSrc:o,progress:100,isGenerating:!1}}),!u)throw Error("Failed to find composed meme id");J(e=>{let l=e.findIndex(e=>e.id===u);if(-1===l)return e;let i=e[l].panels,s={id:a.id,idx:a.idx,panel_type:"generated",panel_config:{meme:d,prompt:d.prompt,text_overlay:{...c,by:t.user.id,created_at:1e6*Date.now(),updated_at:1e6*Date.now()}},created_at:1e6*Date.now()},r={...i,[a.idx]:s},n={...e[l],panels:r};return[...e.slice(0,l),n,...e.slice(l+1)]})},r.readAsDataURL(s)}else"same_prompt"===e.kind&&U({idx:a.idx,action:"update-panel",image:{progress:100,src:a.image.prevSrc,isGenerating:!1}})}},[u,H,t.user.id,a]),(0,r.useEffect)(()=>{let e=localStorage.getItem("isExpandedPrompt");e&&U({action:"update-panel",idx:W,image:{isExpandedPrompt:JSON.parse(e)}})},[W,ef]),(0,l.jsx)(A.Provider,{value:{activePanelIdx:W,selectedTab:D,selectedLayout:L,activePanel:ec,panels:H,history:G,library:V,config:i,postId:I,composedMemeId:u,composedMemeUrl:h,composedMemeBytes:y,isPostDisabled:en,isPosting:B,isUnpublishing:Q,isDeleting:Z,isDuplicating:$,isCreatingProject:et,isHistoryOpen:el,isPostModalOpen:es,isGenerateDisabled:eo,setLibrary:q,setHistory:J,toggleIsHistoryOpen:()=>ei(e=>!e),onClickResetPromptSettings:ep,onClickRandomPrompt:eh,onChangeTextPanel:ex,onChangeTextOverlay:eg,onClosePostModal:()=>er(!1),onClickHistory:ef,onClickLibrary:ew,onClickPane:ev,onClickTab:eb,onFetchHistory:ek,onSelectStudioLayout:ej,onClickNewProject:e_,onClickDelete:eC,onClickUnpublish:ez,onClickDuplicatePost:eA,onClickGenerate:eP,onClickFaceswap:eS,onClickPost:eO,dispatchPanelAction:U},children:c})},E=()=>(0,r.useContext)(A);var W=a(71035),F=a(45268),D=a(41340);let T=()=>{var e;let{config:t,activePanel:a,activePanelIdx:i,dispatchPanelAction:s}=E(),{selectedStyler:n,selectedCharacter:o}=null!==(e=null==a?void 0:a.image)&&void 0!==e?e:{},c=(0,r.useMemo)(()=>t.characters,[t.characters]),d=(0,r.useMemo)(()=>null==o?void 0:o.id,[o]),m=(0,r.useMemo)(()=>null==n?void 0:n.id,[n]),u=(0,r.useMemo)(()=>c.map(e=>({...e,avatar:function(e,t){if("normal"===t)return;let a=e.replace(/[_\s]/g,"-"),l=t.replace(/[_\s]/g,"-");return"https://memedeckblob.blob.core.windows.net/ai-characters/".concat(a,"-").concat(l,".png")}(null!=m?m:"",e.id)})).sort((e,t)=>"normal"===e.id?1:"normal"===t.id?-1:0),[c,m]),p=(0,r.useCallback)(e=>{let t=c.find(t=>t.id===e);t&&s({idx:i,action:"update-panel",image:{selectedCharacter:t}})},[i,c,s]);return(0,l.jsx)(W.g,{items:u,placeholder:"Select a character","aria-label":"Character",classNames:{trigger:"h-[80px]",listbox:"h-fit",listboxWrapper:"min-h-[400px]"},selectedKeys:[d].filter(Boolean),onChange:e=>p(e.target.value),renderValue:e=>e.map(e=>{var t,a,i;return(0,l.jsxs)("div",{className:"flex items-center gap-2",children:[(0,l.jsx)(F.h,{alt:(null===(t=e.data)||void 0===t?void 0:t.id)+"-avatar",className:"shrink-0 mr-2",radius:"md",size:"lg",src:null===(a=e.data)||void 0===a?void 0:a.avatar}),(0,l.jsxs)("div",{className:"flex flex-col",children:[(0,l.jsx)("span",{className:"text-tiny text-default-600",children:"Character"}),(0,l.jsx)("h3",{className:"text-xl font-semibold",children:null===(i=e.data)||void 0===i?void 0:i.name})]})]},e.key)}),children:e=>(0,l.jsx)(D.R,{textValue:null==e?void 0:e.name,"aria-label":null==e?void 0:e.name,children:(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(F.h,{alt:(null==e?void 0:e.id)+"-avatar",className:"shrink-0 mr-2",radius:"md",size:"lg",src:null==e?void 0:e.avatar}),(0,l.jsx)("div",{className:"flex flex-col",children:(0,l.jsx)("span",{className:"text-base font-medium",children:null==e?void 0:e.name})})]})},null==e?void 0:e.id)})};var L=a(49566),M=a(56399),H=a(57826),U=a(6203);let G=()=>{let{activePanelIdx:e,activePanel:t,dispatchPanelAction:a}=E();if(!t)return null;let{isExpandedPrompt:i}=t.image;return(0,l.jsx)("div",{className:"flex flex-row gap-2 justify-start",children:(0,l.jsx)(U.i,{size:"sm",color:"warning",classNames:{thumb:"bg-white-400",label:"text-white-400/75"},onValueChange:t=>{a({idx:e,action:"update-panel",image:{isExpandedPrompt:t}})},isSelected:i,children:"Expand details in your prompt with AI."})})},J=()=>{let{activePanel:e,activePanelIdx:t,isGenerateDisabled:a,dispatchPanelAction:i,onClickGenerate:s}=E();if(!e)return null;let{posPrompt:r}=e.image;return(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsx)(M.Y,{classNames:{input:"placeholder:text-white-400/25"},fullWidth:!0,label:"Prompt",endContent:(0,l.jsx)(H.A,{isIconOnly:!0,isDisabled:!r,style:{display:r?"flex":"none"},size:"sm",radius:"full",variant:"light",className:"absolute top-1 right-1",onClick:()=>{i({idx:t,action:"update-panel",image:{posPrompt:""}})},children:(0,l.jsx)(L.JO,{icon:"ic:baseline-clear",width:16,className:"text-white-400"})}),autoFocus:!0,isMultiline:!0,isRequired:!0,placeholder:"Describe the meme you want to generate",value:r,onValueChange:e=>{i({idx:t,action:"update-panel",image:{posPrompt:e}})},onKeyDown:l=>{"Enter"!==l.key||a||(l.preventDefault(),s(t,e))}},"desktop-prompt"),(0,l.jsx)(G,{})]})};var V=a(63471),q=a(18057),B=a(96091);let Y={base:(0,V.cn)("inline-flex flex-col m-0 p-2 max-w-[100%] items-center justify-center","w-full cursor-pointer rounded-lg 3 !border-medium border-default-100","data-[selected=true]:border-warning bg-black-300 hover:border-white-400/10"),label:"inline-flex flex-col items-center",labelWrapper:"m-0 gap-1 min-w-0 max-w-full",description:"truncate text-center text-white-400/90 max-w-full",wrapper:"hidden"},Z={square:"icon-park-twotone:square-small",landscape:"icon-park-twotone:rectangle-small",portrait:"icon-park-twotone:rectangle-small"},K=()=>{let{config:e,activePanel:t,activePanelIdx:a,selectedLayout:i,dispatchPanelAction:s}=E();if(!t)return null;let{selectedAspectRatio:r}=t.image;return i!==g.W.One?null:(0,l.jsx)(q.X,{classNames:{wrapper:"flex-nowrap gap-2",label:"text-white-400 font-medium text-small"},defaultValue:"square",label:"Aspect Ratio",orientation:"horizontal",value:r,onValueChange:e=>{s({idx:a,action:"update-panel",image:{selectedAspectRatio:e}})},children:Object.entries(e.quality.quality).sort((e,t)=>{let[a]=e,[l]=t;return a.localeCompare(l)}).map(e=>{let[t]=e;return(0,l.jsxs)(B.J,{classNames:Y,value:t,children:[(0,l.jsx)("div",{className:"w-full flex justify-center",children:(0,l.jsx)(L.JO,{icon:Z[t],className:"portrait"===t?"rotate-90":"",width:40})}),(0,l.jsx)("p",{className:"text-sm text-white-400/90 text-center",children:t.charAt(0).toUpperCase()+t.slice(1)})]},t)})})},Q=()=>{var e;let{config:t,activePanel:a,activePanelIdx:i,dispatchPanelAction:s}=E(),{selectedStyler:n}=null!==(e=null==a?void 0:a.image)&&void 0!==e?e:{},o=(0,r.useCallback)(e=>{let a=t.stylers.find(t=>t.id===e);a&&s({idx:i,action:"update-panel",image:{selectedStyler:a}})},[i,t.stylers,s]);return(0,l.jsx)(W.g,{"aria-label":"styler selector",label:"Style",placeholder:"No additional styler",selectedKeys:n?[n.id]:[],size:"md",onChange:e=>o(e.target.value),children:t.stylers.map(e=>(0,l.jsx)(D.R,{"aria-label":e.name,className:"flex flex-row items-center gap-2",children:e.name},e.id))})};var X=a(80562),$=a(49882),ee=a(74926),et=a(87091);let ea=()=>{let{activePanelIdx:e,activePanel:t,isGenerateDisabled:a,onChangeTextOverlay:i,onClickGenerate:s}=E();if(!t)return null;let{topText:r,bottomText:n}=t.image;return(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)(et.Y,{classNames:{input:"placeholder:text-white-400/25",inputWrapper:"!bg-black-400 rounded-lg"},fullWidth:!0,label:"Top text",placeholder:"Add top text",value:r,onValueChange:t=>{i(e,"topText",t)},maxLength:120,isClearable:!0,onKeyDown:l=>{"Enter"!==l.key||a||(l.preventDefault(),s(e,t))}},"desktop-top-text-overlay"),(0,l.jsx)(et.Y,{classNames:{input:"placeholder:text-white-400/25",inputWrapper:"!bg-black-400 rounded-lg"},fullWidth:!0,label:"Bottom text",placeholder:"Add bottom text",value:n,onValueChange:t=>{i(e,"bottomText",t)},maxLength:120,isClearable:!0,onKeyDown:l=>{"Enter"!==l.key||a||(l.preventDefault(),s(e,t))}},"desktop-bottom-text-overlay")]})},el=e=>{let{isMobile:t=!1}=e,{activePanelIdx:a,activePanel:i,isGenerateDisabled:s,onClickGenerate:r,dispatchPanelAction:n}=E();if(!i)return null;let{negPrompt:o,seed:c,seedType:d}=i.image;return(0,l.jsxs)(X.d,{variant:"shadow",className:"border-default-200 dark:border-default-100",children:[(0,l.jsx)($.G,{classNames:{title:"text-base",content:"pt-0 pb-4 flex flex-col gap-6"},"aria-label":"Text",title:"Text",subtitle:"Add text to your image",children:(0,l.jsx)(ea,{})},"1"),(0,l.jsxs)($.G,{classNames:{title:"text-base",content:"pt-0 pb-4 flex flex-col gap-6"},"aria-label":"Advanced",title:"Advanced",children:[(0,l.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,l.jsxs)("div",{className:"inline-flex flex-row gap-2 justify-between",children:[(0,l.jsx)("label",{className:"text-white-400 font-medium text-small",children:"Seed"}),(0,l.jsxs)(ee.g,{children:[(0,l.jsx)(H.A,{size:"sm",className:"h-5 px-0",color:"warning",variant:"fixed"===d?"solid":"bordered",onClick:()=>{n({idx:a,action:"update-panel",image:{seedType:"fixed"}})},children:"Fixed"}),(0,l.jsx)(H.A,{size:"sm",className:"h-5 px-0",color:"warning",variant:"random"===d?"solid":"bordered",onClick:()=>{n({idx:a,action:"update-panel",image:{seed:v(),seedType:"random"}})},children:"Random"})]})]}),(0,l.jsx)(et.Y,{fullWidth:!0,type:"number",label:null,classNames:{input:"placeholder:text-white-400/30",inputWrapper:"!bg-black-400 rounded-lg"},value:c.toString(),onValueChange:e=>{let t=parseInt(e);isNaN(t)||n({idx:a,action:"update-panel",image:{seed:t}})}})]}),!t&&(0,l.jsx)(M.Y,{className:"px-0",classNames:{input:"placeholder:text-white-400/30",inputWrapper:"!bg-black-400 rounded-lg"},fullWidth:!0,label:"Negative prompt",labelPlacement:"outside",placeholder:'What do you want the image NOT to look like? E.g. "no cats"',value:o,onValueChange:e=>{n({idx:a,action:"update-panel",image:{negPrompt:e}})},onKeyDown:e=>{"Enter"!==e.key||s||(e.preventDefault(),r(a,i))}},"desktop-negative-prompt")]},"2")]})};var ei=a(73367);let es=()=>{let{activePanelIdx:e,activePanel:t,dispatchPanelAction:a}=E();if(!t)return null;let{guidanceScale:i}=t.image;return(0,l.jsxs)("div",{className:"my-1 flex flex-col gap-2 px-0",children:[(0,l.jsx)(ei.L,{size:"md",step:.1,color:"foreground",label:(0,l.jsxs)("div",{className:"flex flex-row gap-1.5 items-center",children:[(0,l.jsx)("p",{className:"text-white-400 font-medium text-small",children:"Guidance "}),(0,l.jsx)("p",{className:"text-default-500 font-normal text-tiny",children:"(cfg_scale)"})]}),showSteps:!0,maxValue:3,minValue:1.5,value:i,onChange:t=>{a({idx:e,action:"update-panel",image:{guidanceScale:t}})},className:"max-w-md"}),(0,l.jsx)("p",{className:"text-default-500 font-normal text-small",children:"How close the AI follows the prompt, lower is more creative."})]})},er=e=>{let{isMobile:t=!1}=e;return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(T,{}),(0,l.jsx)(Q,{}),!t&&(0,l.jsx)(J,{}),(0,l.jsx)(K,{}),(0,l.jsx)(es,{}),(0,l.jsx)(el,{isMobile:t})]})};var en=a(9698),eo=a(59458);let ec=e=>{let{children:t,...a}=e;return eo.BB?(0,l.jsx)(en.e,{...a,children:t}):(0,l.jsx)(l.Fragment,{children:t})},ed=()=>{let{activePanelIdx:e,selectedTab:t,onClickTab:a}=E();return(0,l.jsxs)("header",{className:"flex gap-3 items-center justify-between",children:[(0,l.jsxs)("h1",{className:"text-lg uppercase tracking-wide",children:["Panel ",e+1]}),(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(ec,{content:"AI Generation",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",isIconOnly:!0,variant:"flat",color:"generated"===t?"warning":"default",onClick:()=>a("generated"),children:(0,l.jsx)(L.JO,{icon:"ph:sparkle-fill",className:"fill-orange-400 size-5"})})}),(0,l.jsx)(ec,{content:"Text",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",isIconOnly:!0,variant:"flat",color:"text"===t?"warning":"default",onClick:()=>a("text"),children:(0,l.jsx)(L.JO,{icon:"fluent:text-t-24-filled",className:"fill-orange-400 size-6"})})}),(0,l.jsx)(ec,{content:"Your Library",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",isIconOnly:!0,variant:"flat",color:"library"===t?"warning":"default",onClick:()=>a("library"),children:(0,l.jsx)(L.JO,{icon:"fluent:emoji-meme-24-regular",className:"fill-orange-400 size-5"})})}),(0,l.jsx)(ec,{content:"Faceswap",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",isIconOnly:!0,variant:"flat",color:"faceswap"===t?"warning":"default",onClick:()=>a("faceswap"),children:(0,l.jsx)(L.JO,{icon:"tabler:replace-filled",className:"fill-orange-400 size-5"})})})]})]})},em=()=>{let{activePanel:e,activePanelIdx:t,onChangeTextPanel:a}=E();if(!e)return null;let{text:i}=e.text;return(0,l.jsx)("div",{children:(0,l.jsx)(et.Y,{classNames:{input:"placeholder:text-white-400/25",inputWrapper:"!bg-black-500 rounded-lg"},fullWidth:!0,label:"Panel text",placeholder:"Add panel text",value:i,onValueChange:l=>{a(t,e.id,l)},maxLength:120,isClearable:!0},"desktop-panel-text")})};var eu=a(83301),ep=a(61281);let eh=()=>{let{activePanelIdx:e,activePanel:t,isGenerateDisabled:a,onClickRandomPrompt:i,onClickResetPromptSettings:s,onClickGenerate:r}=E();if(!t)return null;let{isGenerating:n,isRandomizing:o}=t.image;return(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsxs)("div",{className:"flex gap-3",children:[(0,l.jsx)(H.A,{className:"flex-1 text-md h-11",variant:"solid",size:"md",startContent:(0,l.jsx)(L.JO,{icon:"ic:baseline-refresh",width:20}),onClick:s,children:(0,l.jsx)("h1",{children:"Reset"})},"desktop-clear"),(0,l.jsx)(H.A,{className:"flex-1 text-md h-11",variant:"solid",size:"md",startContent:(0,l.jsx)(L.JO,{icon:"ion:dice-sharp",width:20}),isLoading:o,onClick:i,children:(0,l.jsx)("h1",{children:"Random"})},"desktop-lucky")]}),(0,l.jsx)(H.A,{fullWidth:!0,className:"text-md h-11",variant:"shadow",color:"primary",size:"md",isLoading:n,isDisabled:a,onClick:()=>{r(e,t)},children:(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[!n&&(0,l.jsx)(eu.default,{src:ep.Z,alt:"Generate",className:"size-5"}),(0,l.jsx)("h1",{children:"Generate"})]})},"desktop-generate")]})};var ex=a(61698),eg=a(18262),ef=a(71459),ew=a(64737);let ev=()=>{let{activePanel:e,library:t,setLibrary:a,onClickLibrary:i}=E(),[s,n]=(0,r.useState)(!1),[o,c]=(0,r.useState)(""),{isFetching:d,hasMore:m,onReachedEnd:u,onSearch:p}=(0,ew.M)({feed:t,setFeed:a,hasFetched:s,searchQuery:o,setSearchQuery:c,setHasFetched:n,fetchFn:(e,t)=>{let{start:a,limit:l,search:i}=e;return x.P.getLibrary({source:["generated","upload"],start:a,limit:l,search:i},t)},fetchOnLoad:!0,pageSize:20,ignoreWindowScroll:!0}),h=(0,r.useCallback)(e=>{let{scrollLeft:t,clientWidth:a,scrollWidth:l}=e.currentTarget;t+a>=l-400&&m&&u()},[m,u]);return e?(0,l.jsxs)("div",{className:"flex size-full min-h-0 flex-col gap-3",children:[(0,l.jsx)("div",{children:(0,l.jsx)(eg.T,{value:o,placeholder:"Search your library",onSearch:p})}),(0,l.jsx)("div",{className:"flex-1 w-full min-h-0 overflow-y-scroll",onScroll:h,children:(0,l.jsx)(ex.o,{memes:t,hasFetched:s,hasSearched:o.length>0,isFetching:d,className:"overflow-hidden -mr-3",breakpoints:{default:2},renderItem:(t,a)=>(0,l.jsx)(ef.Y,{meme:t,isSelected:t.id===e.image.id,onClick:()=>i(t)},"".concat(a,"-").concat(t.id))})})]}):null};var eb=a(70127),ey=a(1490),ej=a(78906),e_=a(67303);let eN=async e=>new Promise((t,a)=>{let l=new Image,i=new FileReader;i.onload=()=>{l.src=i.result},l.onload=()=>{let a=(0,w.vO)(l.width,l.height),[i,s]=w.e5[a],r=document.createElement("canvas");r.width=i,r.height=s;let n=r.getContext("2d");if(!n)return;let o=l.width,c=l.height;(0,e_.h)({ctx:n,image:l,targetWidth:i,targetHeight:s,imageWidth:o,imageHeight:c}),t({base64:r.toDataURL(e.type),aspectRatio:a,targetWidth:i,targetHeight:s})},i.onerror=e=>{a(e)},i.readAsDataURL(e)}),ek=e=>{let{label:t,imageRef:a,isBaseImage:i=!1,initialSrc:s,setImage:n}=e,{composedMemeId:d,activePanelIdx:m,activePanel:u,dispatchPanelAction:p}=E(),[h,g]=(0,r.useState)(s),[f,w]=(0,r.useState)(!1),[v,b]=(0,r.useState)(!1),y=(0,r.useCallback)(async e=>{if(d&&u&&e){if((0,o.sy)(),e.length>10){(0,o.yv)("Please upload 10 files or less",{variant:"error"});return}for(let t=0;t<e.length;t++)if(e[t].size>33554432){(0,o.yv)("Please upload files 32MB or less",{variant:"error"});return}w(!0);try{var t;if(0===e.length)return;let a=e[0],{base64:l,aspectRatio:s,targetWidth:r,targetHeight:o}=await eN(a),c=l.split(",")[1],h=Uint8Array.from(atob(c),e=>e.charCodeAt(0));g(l);let f=await x.P.faceswapUpload(d,u.id,{bytes:Array.from(h),filetype:"image/jpeg",is_face:!i}),w=null==f?void 0:f.panel_config;if(!w)return;let v=i?w.base_image:w.face_image;v&&n(v),p({idx:m,action:"update-panel",type:"faceswap",image:{src:void 0,selectedAspectRatio:i?s:u.image.selectedAspectRatio,width:i?r:w.base_width,height:i?o:w.base_height},faceswap:{faceImage:w.face_image,baseImage:w.base_image,strength:null!==(t=w.strength)&&void 0!==t?t:1,baseWidth:i?r:w.base_width,baseHeight:i?o:w.base_height}})}catch(e){console.error("Error uploading files",e)}finally{w(!1)}}},[u,m,d,p,i,n]),j=(0,r.useCallback)(async()=>{if(!d||!u)return null;b(!0);try{await x.P.faceswapDelete(d,u.id,{is_face:!i}),g(null),n(void 0)}catch(e){console.error("Error deleting meme",e)}finally{b(!1)}},[u,d,i,n]);return(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("p",{className:"text-white-400 font-medium text-small",children:t}),(0,l.jsxs)(eb.w,{radius:"md",className:"border-1 border-transparent transition-all ".concat(!h&&"hover:border-orange-400"),children:[(0,l.jsx)("div",{className:"size-[350px] flex items-center justify-center ".concat(h?"":"cursor-pointer"),children:h?(0,l.jsx)(ey.J,{ref:a,alt:"".concat(t," image input"),classNames:{img:"object-contain h-full rounded-none",wrapper:"object-contain h-full rounded-none"},src:h}):(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(L.JO,{className:"size-8",icon:"hugeicons:image-upload-01"}),(0,l.jsx)("input",{type:"file",multiple:!1,accept:S.RL,className:"absolute inset-0 size-full cursor-pointer opacity-0",onChange:e=>y(e.target.files)})]})}),(0,l.jsxs)(ej.i,{className:"gap-4 justify-end min-h-10 overflow-hidden py-2 absolute bottom-1 w-full px-3 z-10",children:[f?(0,l.jsx)(c.c,{size:"sm",color:"warning"}):null,h&&!f?(0,l.jsx)(H.A,{size:"sm",variant:"flat",className:"backdrop-blur-sm bg-red-900/70",isIconOnly:!0,color:"danger",isLoading:v,onClick:j,children:(0,l.jsx)(L.JO,{className:"size-5 !text-red-400",icon:"ic:baseline-close"})}):null]})]})]})},eC=()=>{var e,t;let{activePanel:a,activePanelIdx:i,onClickFaceswap:s,dispatchPanelAction:n}=E(),o=(0,r.useRef)(null),c=(0,r.useCallback)(e=>{n({idx:i,action:"update-panel",faceswap:{strength:e}})},[i,n]),d=(0,r.useCallback)(e=>{n({idx:i,action:"update-panel",faceswap:{faceImage:e}})},[i,n]),m=(0,r.useCallback)(e=>{n({idx:i,action:"update-panel",faceswap:{baseImage:e}})},[i,n]),u=null==a?void 0:null===(e=a.faceswap)||void 0===e?void 0:e.baseImage,p=null==a?void 0:null===(t=a.faceswap)||void 0===t?void 0:t.faceImage;return(0,l.jsxs)("div",{className:"flex size-full flex-col gap-3 justify-between",children:[(0,l.jsxs)("div",{className:"flex size-full flex-col gap-4",children:[(0,l.jsx)(ek,{imageRef:o,label:"Base Image",isBaseImage:!0,initialSrc:null!=u?u:null,setImage:m},"faceswap-base-image"),(0,l.jsx)(ek,{label:"Face Image",initialSrc:null!=p?p:null,setImage:d},"faceswap-face-image"),(0,l.jsx)(ei.L,{size:"md",step:.01,color:"warning",label:(0,l.jsx)("p",{className:"text-white-400 font-medium text-small",children:"Faceswap Strength"}),maxValue:1,minValue:0,value:null==a?void 0:a.faceswap.strength,onChange:e=>c(e),className:"max-w-md"})]}),a&&(0,l.jsx)(H.A,{fullWidth:!0,className:"text-md h-11",variant:"shadow",color:"primary",size:"md",isLoading:a.image.isGenerating,isDisabled:!p||!u,onClick:()=>{var e,t;if(!p||!u||!o.current)return;let l={width:null===(e=o.current)||void 0===e?void 0:e.naturalWidth,height:null===(t=o.current)||void 0===t?void 0:t.naturalHeight};s(a.idx,p,u,l)},children:(0,l.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,l.jsx)(L.JO,{icon:"tabler:replace-filled",className:"fill-orange-400 size-5"}),(0,l.jsx)("h1",{children:"Swap faces"})]})},"desktop-faceswap")]},"faceswap-controls-".concat(i))},ez=e=>{let{isMobile:t}=e,{selectedTab:a}=E();return(0,l.jsxs)("section",{className:"flex flex-1 flex-col gap-4 size-full",children:[(0,l.jsxs)("div",{className:"flex flex-1 flex-col gap-4 w-full min-h-0 p-1 overflow-y-scroll overflow-x-auto",children:[(0,l.jsx)(ed,{}),"generated"===a&&(0,l.jsx)(er,{isMobile:t}),"text"===a&&(0,l.jsx)(em,{}),"library"===a&&(0,l.jsx)(ev,{}),"faceswap"===a&&(0,l.jsx)(eC,{})]}),"generated"===a&&!t&&(0,l.jsx)(eh,{})]})};var eA=a(62477),eS=a(96044),eP=a(21612);let eO=e=>{let{meme:t,aspectRatio:a}=e,{config:i}=E(),s=(0,r.useRef)(null);return(0,r.useEffect)(()=>{(async()=>{let e=s.current;if(!e)return;let l=t.panels,r=t.panel_layout;if(!l||!r)return;let n=z(l,i);await (0,R.mr)({canvas:e,studioPanels:n,studioLayout:r,aspectRatio:a})})()},[t,t.panels,a,i]),(0,l.jsx)("div",{className:"size-full flex items-center justify-center",children:(0,l.jsx)("canvas",{ref:s,className:"w-full max-h-full object-contain"})})},eR=e=>{var t,a,i,s,r,n;let{meme:o}=e,c=(null===(t=o.prompt)||void 0===t?void 0:t.aspect_ratio)==="square";return"composed"===o.source?(0,l.jsx)(eO,{meme:o,aspectRatio:null===(s=o.prompt)||void 0===s?void 0:s.aspect_ratio}):o.url?(0,l.jsxs)(l.Fragment,{children:[!c&&(0,l.jsx)(eu.default,{src:o.url,width:1024,height:1024,quality:1,priority:!0,alt:"".concat(o.id," background blur"),className:"object-cover object-center blur-md absolute inset-0 z-[-1] scale-[2]"}),(0,l.jsx)(eP.g,{type:"generated",src:o.url,topText:null!==(r=null===(a=o.text_overlay)||void 0===a?void 0:a.top_text)&&void 0!==r?r:null,bottomText:null!==(n=null===(i=o.text_overlay)||void 0===i?void 0:i.bottom_text)&&void 0!==n?n:null,centerText:null,canvasHeight:o.height,canvasWidth:o.width,imageHeight:o.height,imageWidth:o.width,alt:"Generated meme ".concat(o.id)})]}):null},eI=(0,r.createContext)({}),eE=e=>{let{children:t}=e,{history:a,setHistory:i,onFetchHistory:s}=E(),[n,o]=(0,r.useState)(!1),{isFetching:c,hasMore:d,onReachedEnd:m}=(0,ew.M)({feed:a,setFeed:i,hasFetched:n,setHasFetched:o,fetchFn:(e,t)=>{let{start:a,limit:l}=e;return x.P.getLibrary({source:["composed"],start:a,limit:l},t)},fetchOnLoad:!0,onFetchOnLoad:s,pageSize:0===a.length?1:20,ignoreWindowScroll:!0});return(0,l.jsx)(eI.Provider,{value:{isFetching:c,hasMore:d,onReachedEnd:m},children:t})},eW=()=>(0,r.useContext)(eI),eF=()=>{let{composedMemeId:e,history:t,isHistoryOpen:a,onClickHistory:i}=E(),{isFetching:s,hasMore:n,onReachedEnd:o}=eW(),d=(0,r.useCallback)(e=>{let{clientWidth:t,scrollWidth:a,scrollLeft:l}=e;l+t>=a-400&&o()},[o]),m=(0,r.useCallback)(e=>{let{index:a}=e;return a===t.length?n?172:12:172},[n,t.length]),u=(0,r.useCallback)(a=>{let{columnIndex:r,key:n,style:o}=a;if(r===t.length)return s?(0,l.jsx)("div",{style:o,className:"flex w-full justify-center px-3",children:(0,l.jsx)(c.c,{})},n):null;let d=t[r],m=d.id===e;return(0,l.jsx)("div",{style:o,className:"min-w-[172px] max-w-[172px] pl-3 py-3 cursor-pointer",onClick:()=>i(d),children:(0,l.jsx)("div",{className:"size-full relative bg-white-400/10 rounded-md border-2 overflow-hidden ".concat(m?"border-blue-500":"border-white-400/10"),children:(0,l.jsx)(eR,{meme:d})})},n)},[e,t,s,i]);return(0,l.jsx)(h.E.div,{initial:{bottom:-184},animate:{bottom:a?0:-184},exit:{bottom:-184},transition:{duration:.3,transitionProperty:"bottom"},className:"absolute inset-x-0 h-0 lg:h-[184px] w-full bg-black-0 border-black-100 border-t hidden lg:flex",children:(0,l.jsxs)("div",{className:"size-full flex-none flex-col gap-4 flex border-r-1 border-black-100 overflow-hidden",children:[0===t.length&&(0,l.jsx)("p",{className:"mx-3 text-white-400/50 text-sm",children:"No images generated yet"}),(0,l.jsx)("div",{className:"flex-1 min-h-0",children:(0,l.jsx)(eA.ZP,{children:e=>{let{width:a}=e;return(0,l.jsx)(eS.rj,{scrollDirection:"horizontal",width:a,height:184,rowCount:1,rowHeight:184,columnCount:t.length+1,columnWidth:m,overscanColumnCount:10,onScroll:d,cellRenderer:u})}})})]})})};var eD=a(49141);let eT=e=>{let{children:t,onClick:a}=e;return(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex size-full max-h-full min-h-0 items-start xs:items-center justify-center overflow-y-auto overflow-x-hidden bg-white-100 px-4 py-[10vh]",onClick:a,children:t})};var eL=a(28563),eM=a(83321),eH=a(34260),eU=a(30027);let eG=()=>{let e=(0,i.useRouter)(),{profile:t}=(0,s.useProfile)(),{composedMemeId:a,composedMemeUrl:r,composedMemeBytes:n,onClosePostModal:o}=E(),d=async()=>{if(!n)return;await navigator.clipboard.write([new ClipboardItem({"image/png":new Blob([n],{type:"image/png"})})]);let e=encodeURIComponent("ctrl+v to paste meme");window.open("https://twitter.com/intent/tweet?text=".concat(e),"_blank")};return(0,l.jsx)(eT,{onClick:o,children:(0,l.jsxs)("form",{className:"relative flex w-full min-w-0 max-w-lg flex-col gap-3 rounded-xl bg-black-400 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,l.jsxs)("header",{className:"relative flex w-full items-center justify-between px-3 pt-3",children:[(0,l.jsx)("div",{className:"flex items-center",children:t&&(0,l.jsx)(eD.z,{className:"cursor-pointer",name:"",onClick:()=>{e.push("/u/".concat(null==t?void 0:t.user.twitter_handle)),o()},avatarProps:{src:t.twitter_profile.profile_image_url_https,size:"sm"}})}),(0,l.jsx)(H.A,{isIconOnly:!0,className:"rounded-full",variant:"light",size:"sm",onClick:o,children:(0,l.jsx)(eu.default,{src:eL.Z,alt:"close",className:"w-3"})})]}),(0,l.jsx)("main",{className:"min-h-72 gap-7 flex flex-col items-center justify-center",children:a&&r?(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("h1",{className:"text-xl -mb-2",children:"Meme Posted to the Feed!"}),(0,l.jsx)(eU.default,{href:"/library?memeId=".concat(a),className:"size-40 z-40 rounded-md bg-black-100 object-contain",children:(0,l.jsx)(eH.h,{imageUrl:r})}),(0,l.jsx)("div",{className:"flex gap-3 w-full justify-center",children:(0,l.jsxs)(H.A,{className:"flex items-center justify-center gap-2 rounded-2xl bg-blue-500 px-5 py-1 text-sm",onClick:d,children:[(0,l.jsx)(eu.default,{src:eM.Z,alt:"X",className:"w-5"}),(0,l.jsx)("p",{className:"text-lg",children:"Share"})]})})]}):(0,l.jsx)(c.c,{})}),(0,l.jsx)("footer",{className:"h-11"})]})})},eJ=()=>{let{history:e,isHistoryOpen:t,toggleIsHistoryOpen:a}=E(),{onReachedEnd:i}=eW();return(0,l.jsx)(H.A,{radius:"full",variant:"light",disableRipple:!0,className:"z-1 ".concat(t?"bg-orange-400/10":""),onClick:()=>{!t&&e.length<20&&i(e.length),a()},startContent:(0,l.jsx)(L.JO,{icon:"ic:round-history",width:20,className:t?"text-orange-400/75":"text-white-400/75"}),children:(0,l.jsx)("h2",{className:"font-medium ".concat(t?"text-orange-400":"text-white-400/75"),children:"History"})})},eV=()=>(0,l.jsx)("footer",{className:"relative flex flex-col w-full items-center justify-center",children:(0,l.jsx)("div",{className:"flex min-w-full gap-3 items-center justify-between border-b border-white-400/10 px-4 h-[66px]",children:(0,l.jsx)("div",{className:"hidden lg:block",children:(0,l.jsx)(eJ,{})})})});var eq=a(58029),eB=a(4229),eY=a(38630),eZ=a(8748),eK=a(23640),eQ=a(48751);let eX={[g.W.One]:{label:"One Pane",icon:{src:"/memedeck:memedeck:meme-deck.os/_next/static/media/one-pane.2f9a7f4d.svg",height:30,width:30,blurWidth:0,blurHeight:0}},[g.W.TwoVertical]:{label:"Two Vertical",icon:{src:"/memedeck:memedeck:meme-deck.os/_next/static/media/two-pane-vertical.bcad13c4.svg",height:30,width:30,blurWidth:0,blurHeight:0}},[g.W.TwoHorizontal]:{label:"Two Horizontal",icon:{src:"/memedeck:memedeck:meme-deck.os/_next/static/media/two-pane-horizontal.ad349fa3.svg",height:30,width:30,blurWidth:0,blurHeight:0}},[g.W.Four]:{label:"Four Panes",icon:{src:"/memedeck:memedeck:meme-deck.os/_next/static/media/four-pane.09ada0ab.svg",height:30,width:30,blurWidth:0,blurHeight:0}}},e$=()=>{let{selectedLayout:e,onSelectStudioLayout:t,isCreatingProject:a,postId:i}=E();return(0,l.jsx)(W.g,{size:"sm",value:e,isDisabled:a||!!i,selectedKeys:[e],startContent:(0,l.jsx)(eu.default,{src:eX[e].icon,alt:eX[e].label,width:24,height:24}),onChange:e=>t(e.target.value),className:"max-w-48","aria-label":"Panel Layout",children:Object.entries(eX).map(e=>{let[t,{label:a,icon:i}]=e;return(0,l.jsx)(D.R,{value:t,"aria-label":a,startContent:(0,l.jsx)(eu.default,{src:i,alt:a,width:24,height:24}),children:a},t)})})},e0=()=>{let{panels:e,selectedLayout:t,activePanel:a,postId:i,isPosting:s,isPostDisabled:n,isDeleting:o,isUnpublishing:c,isDuplicating:d,onClickDuplicatePost:m,onClickDelete:u,onClickUnpublish:p,onClickPost:h}=E(),x=(0,r.useCallback)(async()=>{let a=await (0,R.jt)(e,t),l=URL.createObjectURL(new Blob([a],{type:"image/jpeg"})),i=document.createElement("a");i.href=l,i.setAttribute("target","_blank"),i.click()},[e,t]);if(!a)return null;let g=!a.image.isGenerating;return(0,l.jsxs)("div",{className:"flex gap-2.5 items-center z-1",children:[!i&&(0,l.jsx)(l.Fragment,{children:g&&(0,l.jsx)(ec,{content:"Delete meme",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",variant:"flat",className:"backdrop-blur-sm bg-red-500/20",isIconOnly:!0,color:"danger",isLoading:o,onClick:u,children:(0,l.jsx)(L.JO,{className:"size-5 !text-red-500",icon:"mdi:delete"})})})}),(0,l.jsx)(ec,{content:"Duplicate meme",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",variant:"flat",isIconOnly:!0,className:"backdrop-blur-sm",isLoading:d,onClick:()=>m(t,e),children:(0,l.jsx)(L.JO,{className:"size-5",icon:"ion:duplicate-outline"})})}),(0,l.jsx)(ec,{content:"Download",delay:500,showArrow:!0,closeDelay:200,children:(0,l.jsx)(H.A,{size:"sm",variant:"flat",color:"default",className:"backdrop-blur-sm",isDisabled:n,isIconOnly:!0,onClick:x,children:(0,l.jsx)(L.JO,{className:"size-5",icon:"mingcute:download-line"})})}),(0,l.jsx)(ee.g,{variant:"flat",className:"backdrop-blur-sm",children:(0,l.jsx)(H.A,{size:"sm",isDisabled:n,isLoading:i?c:s,onClick:i?p:h,children:(0,l.jsx)("h3",{className:"text-sm",children:i?"Unpublish":"Publish"})})})]})},e1=()=>{let{goBack:e}=(0,eQ.useAppHistory)(),{isCreatingProject:t,onClickNewProject:a,postId:i}=E();return(0,l.jsx)("header",{className:"flex w-full flex-col justify-center gap-4 h-14 min-h-14 px-3 lg:flex-row lg:justify-between",children:(0,l.jsxs)("div",{className:"flex flex-row w-full items-center gap-2 justify-between",children:[(0,l.jsxs)("div",{className:"flex gap-1 items-center text-large font-medium select-none z-[1]",children:[(0,l.jsx)(eK.O,{src:eL.Z,alt:"Close",margin:"m-0",w:"w-3",onClick:e}),(0,l.jsxs)("div",{className:"flex items-center",children:[(0,l.jsx)(eu.default,{priority:!0,src:eZ.Z,alt:"Meme Deck",className:"hidden h-8 w-auto xl:block",draggable:!1}),(0,l.jsx)("h1",{className:"text-stone-300 text-lg hidden sm:block",children:"Studio"})]})]}),(0,l.jsxs)("div",{className:"absolute inset-x-0 flex justify-center z-0 gap-2",children:[(0,l.jsx)(e$,{}),(0,l.jsx)(H.A,{size:"sm",variant:"flat",color:"warning",isLoading:t,onClick:()=>a(),startContent:!t&&(0,l.jsx)(L.JO,{className:"size-4",icon:"akar-icons:plus"}),children:(0,l.jsx)("h3",{className:"font-medium text-sm",children:"New"})})]}),(0,l.jsx)("div",{className:"hidden lg:flex",children:(0,l.jsx)(e0,{})}),!i&&(0,l.jsx)("div",{className:"flex lg:hidden flex-row items-center gap-3",children:(0,l.jsxs)(eq.j,{children:[(0,l.jsx)(eB.b,{children:(0,l.jsx)(H.A,{isIconOnly:!0,className:"flex lg:hidden",radius:"full",size:"sm",variant:"flat",children:(0,l.jsx)(L.JO,{icon:"solar:menu-dots-bold",width:24})})}),(0,l.jsx)(eY.g,{className:"flex max-h-[50vh] w-[320px] justify-start gap-3 overflow-scroll p-4 lg:hidden",children:(0,l.jsx)(ez,{isMobile:!0})})]})})]})})},e4=e=>{let{children:t}=e;return(0,l.jsx)("div",{className:"container",children:(0,l.jsx)("div",{className:"square",children:t})})};var e2=a(43076);let e3=e=>{var t,a,i;let{index:s}=e,{activePanelIdx:r,panels:n,selectedLayout:o,onClickPane:c}=E(),d=n.find(e=>e.idx===s);if(!d)return console.error("Panel not found for index",s),null;let m=d.image.isGenerating,u=r===s,p=d.image,x=d.text,f=d.faceswap,v=o!==g.W.One?w.B5[o]:1,b=w.WN[o],y=1024,j=1024;switch(o){case g.W.One:let _=null!==(t=p.selectedAspectRatio)&&void 0!==t?t:"square",N=w.e5[_];v=(y=N[0]||1024)/(j=N[1]||1024);break;case g.W.TwoHorizontal:v=(y=768)/(j=1024);break;case g.W.TwoVertical:v=(y=1024)/(j=768);break;case g.W.Four:v=(y=1024)/(j=1024)}let k=null!==(a=p.width)&&void 0!==a?a:y,C=null!==(i=p.height)&&void 0!==i?i:j;return(null==f?void 0:f.baseWidth)&&(k=f.baseWidth),(null==f?void 0:f.baseHeight)&&(C=f.baseHeight),(0,l.jsxs)("div",{style:{aspectRatio:v},className:"".concat(b," flex-1 border-3 overflow-hidden mx-auto my-0 bg-black-400 ").concat(u?"border-orange-400":"border-transparent"),onClick:()=>c(s),children:[p.isGenerating&&!p.src&&(0,l.jsx)(h.E.div,{className:"size-full flex items-center justify-center backdrop-blur-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,l.jsx)(e2.X,{className:"size-full opacity-50"})}),(0,l.jsx)(h.E.div,{className:"size-full max-h-full flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},children:(0,l.jsx)(eP.g,{type:d.type,src:p.src,topText:p.topText,progress:m?p.progress:100,bottomText:p.bottomText,centerText:x.text,imageWidth:k,imageHeight:C,canvasHeight:j,canvasWidth:y},p.src)})]})},e5=()=>{let{selectedLayout:e,activePanel:t}=E(),a=w._j[e],i=!t||"0"===t.id;return(0,l.jsx)(e4,{children:(0,l.jsx)("div",{className:"size-full flex items-center justify-center overflow-hidden max-h-full max-w-full min-h-0",children:i?(0,l.jsx)(c.c,{}):(0,l.jsx)("div",{className:"max-h-full max-w-full grid ".concat(w.HS[e]),children:Array.from({length:a}).map((e,t)=>(0,l.jsx)(e3,{index:t},t))})})})},e6=()=>{let{activePanel:e,activePanelIdx:t,isGenerateDisabled:a,dispatchPanelAction:i,onClickGenerate:s}=E();if(!e)return null;let{posPrompt:r,isGenerating:n}=e.image;return(0,l.jsxs)("div",{className:"w-full border-black-100 bg-black-400 gap-3 flex lg:hidden p-4 pb-12",children:[(0,l.jsx)(M.Y,{classNames:{base:"flex-1",input:"placeholder:text-white-400/25"},fullWidth:!0,label:"Prompt",isMultiline:!0,isRequired:!0,placeholder:"Describe the meme you want to generate",value:r,onValueChange:e=>{i({idx:t,action:"update-panel",image:{posPrompt:e}})},onKeyDown:l=>{"Enter"!==l.key||a||(l.preventDefault(),s(t,e))}},"mobile-prompt"),(0,l.jsx)(H.A,{isIconOnly:!0,className:"text-md",variant:"solid",color:"primary",radius:"full",isLoading:n,isDisabled:a,onClick:()=>{s(t,e)},children:(0,l.jsx)(eu.default,{src:ep.Z,alt:"Generate",className:"size-6"})},"mobile-generate")]})},e8=()=>{let{isPostModalOpen:e,isHistoryOpen:t,postId:a}=E();return(0,l.jsxs)("div",{className:"fixed z-50 flex flex-row items-center justify-between h-screen overflow-y-auto dot-grid inset-x-0 min-h-screen max-h-screen t-0",children:[(0,l.jsxs)("div",{className:"relative flex flex-col flex-1 size-full min-h-0 overflow-hidden",children:[(0,l.jsx)(e1,{}),(0,l.jsx)(h.E.main,{className:"size-full relative flex justify-end flex-1 max-w-[100vw]",children:(0,l.jsx)(h.E.div,{initial:{height:"100%"},animate:{height:t?"calc(100% - 184px)":"100%"},exit:{height:"100%"},transition:{duration:.3,transitionProperty:"height"},className:"w-full lg:min-w-0",children:(0,l.jsxs)("div",{className:"flex flex-col size-full transition-all",children:[(0,l.jsx)("div",{className:"size-full min-h-0 overflow-hidden p-3 lg:px-6 lg:py-3 flex flex-row justify-center",children:(0,l.jsx)(e5,{})}),(0,l.jsx)(eV,{}),(0,l.jsx)(eF,{}),(0,l.jsx)(e6,{})]})})}),e&&(0,l.jsx)(eG,{})]}),!a&&(0,l.jsx)("div",{className:"p-3 pl-0 h-full hidden lg:flex",children:(0,l.jsx)("div",{className:"p-3 rounded-2xl bg-[#0F0F0F] border-1 border-black-100 w-96 max-h-full flex-none flex-col gap-4 lg:h-full",children:(0,l.jsx)(ez,{})})})]})};function e7(){var e,t,a;let r=(0,i.useSearchParams)(),n=null!==(e=r.get("remix"))&&void 0!==e?e:void 0,o=null!==(t=r.get("meme"))&&void 0!==t?t:void 0,c=null!==(a=r.get("character"))&&void 0!==a?a:void 0,{profile:d}=(0,s.useProfile)(),{socket:m,config:u}=p();return d&&m&&u&&window.localStorage?(0,l.jsx)(I,{profile:d,socket:m,config:u,queryParams:{memeId:o,remixMemeId:n,characterId:c},children:(0,l.jsx)(eE,{children:(0,l.jsx)(e8,{})})}):null}},61698:function(e,t,a){"use strict";a.d(t,{o:function(){return n}});var l=a(91104),i=a(41908),s=a(51347);let r={default:3,1100:3,700:2,500:1},n=e=>{let{memes:t,isFetching:a,hasFetched:n,hasSearched:o,className:c="overflow-hidden pl-3 pt-3",breakpoints:d=r,renderItem:m}=e;return(0,l.jsxs)("div",{className:c,children:[!a&&0===t.length&&(n||o)?(0,l.jsx)("div",{className:"text-white-400/75",children:"No memes"}):null,a&&0===t.length&&(0,l.jsx)("div",{className:"flex w-full justify-center p-3",children:(0,l.jsx)(i.c,{})}),(0,l.jsx)(s.Z,{breakpointCols:d,className:"my-masonry-grid min-w-full max-w-full",columnClassName:"my-masonry-grid_column",children:t.map(m)}),a&&t.length>0&&(0,l.jsx)("div",{className:"flex w-full justify-center p-3",children:(0,l.jsx)(i.c,{})})]})}},34260:function(e,t,a){"use strict";a.d(t,{h:function(){return s}});var l=a(91104),i=a(83301);let s=e=>{let{imageUrl:t,priorityLoadImage:a,alt:s="Meme"}=e;return(0,l.jsxs)("div",{className:"relative size-full select-none overflow-hidden rounded-xl bg-white-400/10",children:[(0,l.jsx)(i.default,{className:"absolute z-0 inset-0 object-cover blur-lg scale-110 size-full",src:t,alt:"Meme blur",width:400,height:400,quality:1,priority:a}),(0,l.jsx)(i.default,{draggable:!1,className:"absolute z-1 inset-0 size-full object-contain",src:t,alt:s,width:640,height:640,sizes:"640px",quality:50,priority:a})]})}},18262:function(e,t,a){"use strict";a.d(t,{T:function(){return o}});var l=a(91104),i=a(63137),s=a(83301),r=a(87091),n=a(20279);let o=e=>{let{value:t,autofocus:a,initialSearch:o,placeholder:c="Search for memes. (i.e. pepe)",onFocus:d,onSearch:m}=e,u=(0,i.useRef)(null);return(0,l.jsx)(r.Y,{isClearable:!0,onClear:()=>{null==m||m("")},radius:"full",classNames:{input:"text-base placeholder:text-base placeholder:text-white-400/50"},startContent:(0,l.jsx)(s.default,{priority:!0,src:n.Z,alt:"Dropdown",onClick:e=>{var t;e.preventDefault(),null===(t=u.current)||void 0===t||t.focus()},className:"mr-1 size-5 cursor-text select-none opacity-75"}),ref:u,autoFocus:a,defaultValue:o,placeholder:c,className:"h-10 min-w-24 flex-1 rounded-full border border-white-400/5 bg-white-400/5 shadow-sm outline-none placeholder:text-xl placeholder:text-white-400/50",value:t,onFocus:d,onChange:e=>null==m?void 0:m(e.target.value)})}},71459:function(e,t,a){"use strict";a.d(t,{Y:function(){return n}});var l=a(91104),i=a(83301),s=a(4104),r=a(21612);let n=e=>{var t,a,n,o,c,d,m,u,p,h;let{meme:x,isSelected:g,showCreator:f=!1,onClick:w}=e,{onOpenMeme:v}=(0,s.useMemeModal)();return(0,l.jsx)("article",{className:"relative w-full cursor-pointer overflow-hidden rounded-lg border-2 ".concat(g?"border-blue-500":"border-transparent"),onClick:()=>w?w():v(x.id),children:(0,l.jsxs)("div",{className:"group flex w-full flex-col",children:["generated"===x.source?(0,l.jsx)(r.g,{type:x.source,src:x.url,alt:x.id,canvasWidth:null!==(n=x.width)&&void 0!==n?n:1024,canvasHeight:null!==(o=x.height)&&void 0!==o?o:1024,imageWidth:null!==(c=x.width)&&void 0!==c?c:1024,imageHeight:null!==(d=x.height)&&void 0!==d?d:1024,topText:null!==(m=null===(t=x.text_overlay)||void 0===t?void 0:t.top_text)&&void 0!==m?m:null,bottomText:null!==(u=null===(a=x.text_overlay)||void 0===a?void 0:a.bottom_text)&&void 0!==u?u:null,centerText:null,className:"z-0 size-full rounded-lg bg-white-400/5 transition-transform group-hover:scale-105"}):(0,l.jsx)(i.default,{className:"z-0 size-full rounded-lg bg-white-400/5 transition-transform group-hover:scale-105",src:x.url,alt:x.id,width:null!==(p=x.width)&&void 0!==p?p:1024,height:null!==(h=x.height)&&void 0!==h?h:1024}),f&&(0,l.jsx)("div",{className:"absolute inset-0 z-0 flex select-none items-end px-1.5 py-1 opacity-0 transition-opacity hover:opacity-100",children:(0,l.jsx)("div",{className:"flex flex-1 items-center gap-2",children:(0,l.jsxs)("div",{className:"flex flex-1 items-center gap-2 truncate p-1 text-sm font-semibold drop-shadow-[0.5px_0.5px_1px_rgba(0,0,0,80)]",children:[(0,l.jsx)(i.default,{src:x.creator_avatar||"",alt:x.creator_handle||"",className:"rounded-full hover:scale-105",width:24,height:24}),x.creator_handle]})})})]})})}},64737:function(e,t,a){"use strict";a.d(t,{M:function(){return r}});var l=a(63137),i=a(29125),s=a(21204);let r=e=>{let{feed:t,setFeed:a,hasFetched:r,setHasFetched:n,searchQuery:o,setSearchQuery:c,fetchFn:d,initialQuery:m,characterId:u,interval:p=s.u.AllTime,sortBy:h=s.a.Recent,fetchOnLoad:x=!0,pageSize:g=50,ignoreWindowScroll:f=!1,onFetchOnLoad:w}=e,[v,b]=(0,l.useState)(0),[y,j]=(0,l.useState)(!0),[_,N]=(0,l.useState)(!1),k=(0,l.useCallback)(async(e,t)=>{let l=await d(e,t);return a(t=>l.length>0&&Number(e.start)>0?[...t,...l]:l),N(!1),n(!0),j(l.length===g),l},[d,g,a,n]),C=(0,l.useMemo)(()=>(0,i.k)(k,1e3),[k]),z=(0,l.useCallback)(async(e,t)=>{var a,l,i,s,r;return N(!0),n(!1),C({search:null!==(a=e.search)&&void 0!==a?a:o,start:null!==(l=e.start)&&void 0!==l?l:v,limit:null!==(i=e.limit)&&void 0!==i?i:g,interval:null!==(s=e.interval)&&void 0!==s?s:p,sort_by:null!==(r=e.sort_by)&&void 0!==r?r:h,...u&&{character_id:u}},t)},[u,C,p,h,g,o,n,v]),A=(0,l.useCallback)(e=>{if(!r||!y||_)return;let t=null!=e?e:v+g;console.log("onReachedEnd",{newStart:t}),b(t),z({start:t})},[r,y,_,v,g,z]),S=(0,l.useCallback)(async()=>{let e=window.innerHeight;document.body.offsetHeight-window.scrollY<3*e&&A()},[A]),P=(0,l.useCallback)(e=>{let t=new URL(window.location.href);e.length>0?t.searchParams.set("query",e):t.searchParams.delete("query"),window.history.pushState({},"",t.toString())},[]),O=(0,l.useCallback)(async(e,t,a)=>{null==c||c(e),c&&P(e),b(0),j(!0),z({search:e,start:0,limit:g,sort_by:a,interval:t})},[z,g,c,P]);return(0,l.useEffect)(()=>{if(!f)return window.addEventListener("scroll",S),()=>window.removeEventListener("scroll",S)},[S,f]),(0,l.useEffect)(()=>{let e=new AbortController;if(!r&&!(t.length>0)&&x&&!_)return z({search:m,start:0,limit:g},e.signal).then(w),()=>{!e.signal.aborted&&_&&e.abort()}},[t.length,z,x,r,m,_,w,g]),{feed:t,setFeed:a,setHasMore:j,onSearch:O,isFetching:_,hasMore:y,setIsFetching:N,setHasFetched:n,onReachedEnd:A}}},1218:function(e,t,a){"use strict";a.d(t,{p:function(){return r},s:function(){return i}});var l=a(59458);let i=()=>l.cm?"wss://staging-api.memedeck.xyz/v1/generation/ws":l.BB||l.j7?"wss://api.memedeck.xyz/v1/generation/ws":"ws://127.0.0.1:8080/v1/generation/ws";class s{async getConfig(){return fetch("".concat(s.BASE_URL,"/generation/config")).then(e=>e.json())}async getRandomPrompt(){return fetch("".concat(s.BASE_URL,"/generation/prompt")).then(e=>e.json())}}s.BASE_URL=l.cm?"https://staging-api.memedeck.xyz/v1":l.BB||l.j7?"https://api.memedeck.xyz/v1":"http://127.0.0.1:8080/v1";let r=new s},20279:function(e,t){"use strict";t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/search.3dc28276.svg",height:18,width:18,blurWidth:0,blurHeight:0}},83321:function(e,t){"use strict";t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/x.493d8304.png",height:45,width:41,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAQAAACfDS2NAAAAeElEQVR42h3JIQoCURiF0dtUEOwmMQlGnSKuYbAIbsFucAViGMFgE0b3YdRueUuxyH+/p8zEwxGLvGaMkCcUYkvy/dOJISlmkrz3hTMvStRw4IobNfr1lLtZHHm48tztljzZ+eqTpShIMQr5wJtaXsY0hL59Nl79AU07Rc3uyJI/AAAAAElFTkSuQmCC",blurWidth:7,blurHeight:8}},8748:function(e,t){"use strict";t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/logo-wide.572ec4d3.svg",height:256,width:702,blurWidth:0,blurHeight:0}}},function(e){e.O(0,[3107,6557,2376,7826,9749,5981,27,330,9566,6593,1397,9697,1035,9857,9168,9654,3968,8933,3634,9514,5171,1744],function(){return e(e.s=95565)}),_N_E=e.O()}]);