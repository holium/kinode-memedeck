"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5658],{61858:function(e,t,a){a.d(t,{h:function(){return s}});var i=a(57348),l=a(45155),n=a(15346),r=a(18491);let s=e=>{let{imageUrl:t,priorityLoadImage:a,alt:s="Meme",isNsfw:o}=e,[c,d]=(0,n.useState)(o);return(0,i.jsxs)("div",{className:"relative size-full select-none overflow-hidden rounded-xl bg-white-400/10",children:[(0,i.jsx)(l.default,{draggable:!1,className:"absolute z-1 inset-0 size-full object-contain ".concat(c?"blur-xl":""),src:t,alt:s,width:640,height:640,sizes:"640px",quality:100,priority:!o&&a}),c&&(0,i.jsx)(r.T,{src:t,onClickShow:()=>d(!1)})]})}},37824:function(e,t,a){a.d(t,{O:function(){return n}});var i=a(57348),l=a(45155);let n=e=>{let{src:t,alt:a,id:n,margin:r="m-2",w:s="w-3.5",onClick:o}=e;return(0,i.jsx)("button",{id:n,className:"flex size-9 items-center justify-center rounded-full hover:bg-black-100 ".concat(r),onClick:o,children:(0,i.jsx)(l.default,{priority:!0,src:t,alt:a,className:"opacity-85 ".concat(s)})})}},2406:function(e,t,a){a.d(t,{I:function(){return u}});var i=a(57348),l=a(53350),n=a(26151),r=a(67425),s=a(87840),o=a(15346),c=a(56480),d=a(35971);let u=e=>{let{memeId:t,initialVotes:a,userId:u,size:m="sm",border:h="",readOnly:f=!1,addVoteApi:p,removeVoteApi:x,onClick:g}=e,{getMeme:v,voteOnMeme:w}=(0,d.useFeed)(),b=(0,o.useMemo)(()=>v(t),[v,t]),y=(0,o.useMemo)(()=>b?b.votes:a,[a,b]),{voteSum:j,hasUpvoted:_,hasDownvoted:k}=(0,c.u)(u,y);return(0,i.jsxs)(n.g,{size:m,isDisabled:f,children:[(0,i.jsxs)(r.A,{isIconOnly:0===j,onClick:e=>{if(e.stopPropagation(),e.preventDefault(),g){g();return}_?(x(t,"upvote"),w(u,t,"remove","upvote")):(p(t,"upvote"),w(u,t,"add","upvote"))},className:"".concat(_?"bg-blue-600":""," ").concat(h," border-r-1"),variant:"ghost",color:_?"primary":"default",children:[(0,i.jsx)(l.JO,{icon:"majesticons:arrow-up",width:20,color:"white"}),0!==j&&(0,i.jsx)(s.E.div,{initial:{opacity:0,y:j<0?10:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:0,transition:{duration:.1}},transition:{duration:.2},children:(0,i.jsx)("span",{className:"text-base font-semibold text-white-400",children:j})},j)]}),(0,i.jsx)(r.A,{isIconOnly:!0,onClick:e=>{if(e.stopPropagation(),e.preventDefault(),g){g();return}k?(x(t,"downvote"),w(u,t,"remove","downvote")):(p(t,"downvote"),w(u,t,"add","downvote"))},className:"".concat(k?"bg-warning-400":""," ").concat(h," border-l-1"),variant:"ghost",color:k?"warning":"default",children:(0,i.jsx)(l.JO,{icon:"majesticons:arrow-down",color:k?"black":"white",width:20})})]})}},18491:function(e,t,a){a.d(t,{T:function(){return r}});var i=a(57348),l=a(67425),n=a(45155);let r=e=>{let{src:t,onClickShow:a}=e;return(0,i.jsxs)("div",{className:"absolute inset-0 bg-black/50 z-2 bg-white-400/10",onClick:e=>{e.stopPropagation(),e.preventDefault()},onMouseEnter:e=>{e.stopPropagation(),e.preventDefault()},children:[(0,i.jsx)(n.default,{src:t,alt:"NSFW",draggable:!1,className:"absolute z-0 inset-0 size-full object-cover blur-xl scale-[3]",width:640,height:640,sizes:"640px",quality:1,priority:!0}),(0,i.jsx)(l.A,{variant:"ghost",color:"danger",size:"sm",className:"p-1 font-medium z-3 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 backdrop-blur-sm",onClick:a,children:"Show"})]})}},46371:function(e,t,a){a.d(t,{P:function(){return n}});var i=a(35878),l=a(69467);async function n(e,t){let a={0:{panel_type:"generated",panel_config:{meme:t.id}}},n=await i.P.createComposedMeme({meme_id:e,panel_layout:l.WV.One,panel_config_init:a});if(!n)throw Error("Failed to create composed meme");return{newPanels:n}}},80780:function(e,t,a){a.d(t,{B:function(){return s}});var i=a(57348),l=a(45155),n=a(13881),r=a(81727);let s=e=>{let{handle:t,avatar:a,name:s,createdAt:o,publishedAt:c}=e;return(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(n.default,{href:"/u/".concat(t),children:(0,i.jsx)(l.default,{src:null!=a?a:"https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png",alt:null!=t?t:"Anonymous",width:48,height:48,className:"size-10 rounded-full bg-black-300"})}),(0,i.jsxs)("div",{className:"flex flex-1 flex-col justify-center",children:[(0,i.jsx)(n.default,{href:"/u/".concat(t),children:(0,i.jsx)("h2",{className:"text-sm font-bold",children:null!=s?s:"Anonymous"})}),(0,i.jsx)("h3",{className:"text-xs font-medium text-white-400/75",children:c?"Published ".concat((0,r.Po)(c)):"Created ".concat((0,r.Po)(o))})]})]})}},52154:function(e,t,a){a.d(t,{R:function(){return o}});var i=a(57348),l=a(92378),n=a(41223),r=a(71583),s=a(30422);let o=e=>{var t;let{prompt:a}=e;if(!a)return null;let s=a.character.replace("ai_character:",""),o=null===(t=a.aesthetic)||void 0===t?void 0:t.replace("aesthetic:","");return(0,i.jsxs)(l.w,{classNames:{base:"pb-1"},children:[(0,i.jsx)(n.u,{className:"text-lg font-semibold pb-1 z-1",children:"Generation Details"}),(0,i.jsxs)(r.G,{className:"gap-6",children:[(0,i.jsx)(c,{title:"Positive Prompt",content:a.user_positive_prompt}),(0,i.jsx)(c,{title:"Negative Prompt",content:a.user_negative_prompt}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsx)(c,{title:"Aesthetic",content:o,hideCopyButton:!0}),(0,i.jsx)(c,{title:"Character",content:s,hideCopyButton:!0}),(0,i.jsx)(c,{title:"Aspect Ratio",content:a.aspect_ratio,hideCopyButton:!0}),(0,i.jsx)(c,{title:"Seed",content:a.seed.toString()}),(0,i.jsx)(c,{title:"CFG Scale",content:a.cfg_scale.toString(),hideCopyButton:!0})]})]})]})},c=e=>{let{title:t="",content:a="",hideCopyButton:l=!1}=e;return(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsx)("p",{className:"text-xs text-white-400/50 font-medium",children:t}),(0,i.jsx)(s.Z,{hideSymbol:!0,hideCopyButton:l||!a,classNames:{base:"bg-[#27292C] min-h-[44px]",pre:"whitespace-pre-wrap max-w-full"},children:a||(0,i.jsx)("span",{className:"text-white-400/50 select-none",children:"N/A"})})]})}},18676:function(e,t,a){a.d(t,{D:function(){return d},h:function(){return u}});var i=a(57348),l=a(5070),n=a(52053),r=a(16189),s=a(15346),o=a(41973),c=a(93276);let d=e=>{var t;let{deck:a,newPosts:d=0,hideActiveState:u=!1}=e,m=(0,r.useRouter)(),h=(0,r.usePathname)(),f=(0,s.useMemo)(()=>(0,c.o4)(a.id),[a.id]),p=(0,s.useMemo)(()=>f.startsWith(h),[f,h]),x=(0,s.useMemo)(()=>p&&!u?"bg-white-400/10":"",[u,p]),g=(0,s.useCallback)(()=>{if(0===d)return m.push(f);let e=(0,c.o4)(a.id,{sort_by:o.a.Recent});m.push(e)},[a.id,f,d,m]);return(0,i.jsxs)("div",{className:"flex items-center px-1.5 justify-between rounded-md gap-6 h-8 min-h-8 cursor-pointer ".concat(x," ").concat("tap-highlight-transparent outline-none data-[focus-visible=true]:z-10 data-[focus-visible=true]:outline-2 data-[focus-visible=true]:outline-focus data-[focus-visible=true]:outline-offset-2 text-medium text-primary no-underline hover:opacity-80 active:opacity-disabled transition-opacity"),onClick:g,children:[(0,i.jsxs)("div",{className:"flex items-center gap-2 flex-1 truncate",children:[(0,i.jsx)(l.h,{size:"sm",radius:"sm",src:null!==(t=a.cover_photo)&&void 0!==t?t:"",className:"max-w-5 max-h-5 rounded-sm"}),(0,i.jsx)("span",{className:"flex-1 truncate text-sm font-base text-white-400",children:a.title})]}),d>0?(0,i.jsxs)(n.z,{size:"sm",color:"warning",classNames:{base:"text-yellow-400 bg-yellow-50 border-1 border-yellow-400/10"},children:["+",d]}):(0,i.jsx)("div",{className:"w-8"})]},a.id)},u=()=>(0,i.jsx)("div",{className:"w-full h-8 flex items-center",children:(0,i.jsx)("div",{className:"w-3/5 h-6 animate-pulse rounded-xl"})})},29365:function(e,t,a){a.d(t,{Z:function(){return n}});var i=a(57348),l=a(99957);let n=e=>{let{isOpen:t=!0,children:a,onClick:n}=e;return(0,i.jsx)("div",{className:(0,l.cn)("modal-overlay","fixed inset-0 z-50 flex size-full max-h-full min-h-0 items-start xs:items-center justify-center overflow-y-auto overflow-x-hidden","bg-white-100 px-4 py-[10vh]","transition-opacity duration-100",{"opacity-0":!t,"opacity-100":t,"pointer-events-none":!t}),onClick:n,children:a})}},98086:function(e,t,a){a.d(t,{F:function(){return w}});var i=a(57348),l=a(67425),n=a(4930),r=a(45155),s=a(13881),o=a(12465),c=a(15346),d=a(61858),u=a(29365),m=a(98470),h=a(15667),f=a(35878),p=a(93276),x=a(94787),g=a(54167);let v=e=>{let{memeId:t}=e,a=async()=>{let e=encodeURIComponent("".concat((0,g.L)()).concat((0,p.Wi)(t)));window.open("https://x.com/intent/tweet?text=".concat(e),"_blank")};return(0,i.jsxs)(l.A,{fullWidth:!0,className:"flex items-center justify-center gap-2 rounded-md bg-blue-500 px-5 py-1 text-sm",onClick:a,children:[(0,i.jsx)("p",{className:"text-lg",children:"Share on"}),(0,i.jsx)(r.default,{src:x.Z,alt:"X",className:"w-5"})]})},w=e=>{let{postId:t,memeId:a,memeUrl:x,onClose:g}=e,[w,b]=(0,c.useState)(null),[y,j]=(0,c.useState)(!1),_=async()=>{try{if(!w)throw Error("Deck ID is missing");if(!t)throw Error("Post ID is missing");j(!0),await f.P.submitPostToDeck(w,{post_id:t})}catch(e){console.error(e),(0,o.yv)("Failed to add meme to deck",{variant:"error"})}finally{g(),j(!1)}};return(0,i.jsx)(u.Z,{onClick:g,children:(0,i.jsxs)("form",{className:"relative flex w-full min-w-0 max-w-lg flex-col gap-3 rounded-xl bg-black-400 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("header",{className:"relative flex w-full items-center justify-end px-3 pt-3",children:(0,i.jsx)(l.A,{isIconOnly:!0,className:"rounded-full",variant:"light",size:"sm",onClick:g,children:(0,i.jsx)(r.default,{src:h.Z,alt:"close",className:"w-3"})})}),(0,i.jsx)("main",{className:"min-h-72 gap-7 flex flex-col items-center justify-center",children:a&&x?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h1",{className:"text-xl -mb-2",children:"Meme Posted to the Feed \uD83C\uDF89"}),(0,i.jsx)(s.default,{href:(0,p.Wi)(a),className:"size-40 md:size-52 z-40 rounded-md bg-black-100 object-contain",children:(0,i.jsx)(d.h,{imageUrl:x})}),(0,i.jsxs)("section",{className:"flex flex-col gap-5 p-3 items-center",children:[(0,i.jsx)(v,{memeId:a}),(0,i.jsxs)("div",{className:"flex w-1/2 items-center justify-center relative",children:[(0,i.jsx)("hr",{className:"w-full border-0.5 border-white-400/10"}),(0,i.jsx)("span",{className:"absolute px-2 bg-black-400 text-white-400/50",children:"or"})]}),(0,i.jsx)(m.Z,{memeId:a,selectedDeck:w,onSelectDeck:e=>{b(e)}})]})]}):(0,i.jsx)(n.c,{})}),(0,i.jsx)("footer",{className:"h-14 p-3 flex items-center justify-end",children:w&&(0,i.jsx)(l.A,{size:"sm",variant:"solid",color:"primary",isLoading:y,onClick:_,children:"Done"})})]})})}},98470:function(e,t,a){a.d(t,{Z:function(){return u}});var i=a(57348),l=a(53350),n=a(51934),r=a(5070),s=a(88036),o=a(15346),c=a(35878);let d=(0,a(74859).k)(c.P.getDecks,1e3),u=e=>{var t,a;let{memeId:c,selectedDeck:u,onSelectDeck:m,alreadySelected:h,maxW:f="max-w-64",isLoading:p=!1}=e,[x,g]=(0,o.useState)(!1),[v,w]=(0,o.useState)([]);return(0,o.useEffect)(()=>{g(!0),d({meme_id:c,start:0}).then(e=>{e&&w(e)}).finally(()=>{g(!1)})},[c]),(0,i.jsx)("div",{className:"flex gap-3 justify-between ".concat(f),children:(0,i.jsx)("div",{className:"flex gap-1 items-center flex-1",children:(0,i.jsx)(n.d,{placeholder:"Add to deck",size:"lg",radius:"md",fullWidth:!0,classNames:{selectorButton:"h-10"},multiple:!0,isLoading:x||p,onSelectionChange:e=>{var t;m(e,null!==(t=v.find(t=>t.id===e))&&void 0!==t?t:null)},selectedKey:null!=u?u:null,startContent:u?(0,i.jsx)(r.h,{className:"min-w-8",src:null!==(a=null===(t=v.find(e=>e.id===u))||void 0===t?void 0:t.cover_photo)&&void 0!==a?a:void 0,size:"sm",radius:"sm"}):(0,i.jsx)("div",{className:"size-8 min-w-8 flex items-center justify-center",children:(0,i.jsx)(l.JO,{className:"size-5 text-white-400/50",icon:"tabler:plus"})}),children:v.map(e=>{var t;return(0,i.jsx)(s.R,{value:e.id,title:e.title,isDisabled:null==h?void 0:h.some(t=>t.id===e.id),description:"by @".concat(e.by.screen_name),startContent:(0,i.jsx)(r.h,{src:null!==(t=e.cover_photo)&&void 0!==t?t:void 0,size:"sm",radius:"sm",className:"min-w-8"}),classNames:{title:"font-semibold"}},e.id)})})})})}},81254:function(e,t,a){a.d(t,{g:function(){return o}});var i=a(57348),l=a(45155),n=a(15346),r=a(55147),s=a(99957);let o=e=>{let{type:t,src:a,topText:o,bottomText:c,centerText:d,id:u="image-canvas",imageWidth:m=1024,imageHeight:h=1024,canvasWidth:f=1024,canvasHeight:p=1024,alt:x="Generated Image",progress:g=100,className:v=""}=e,w=(0,n.useRef)(new Image),b=(0,n.useRef)(null),y=(0,n.useMemo)(()=>g&&g<100&&g>0,[g]);return(0,n.useEffect)(()=>{let e=w.current,i=b.current;if(i){if(console.log("Creating canvas with",f,p),console.log("And an image with",m,h),!a&&!d){(0,r.el)({image:e,canvas:i,topText:null,bottomText:null,centerText:null,canvasWidth:1024,canvasHeight:1024,imageWidth:1024,imageHeight:1024});return}"generated"===t||"faceswap"===t?(e.onload=()=>{(0,r.el)({image:e,canvas:i,topText:o,bottomText:c,centerText:null,canvasWidth:f,canvasHeight:p,imageWidth:m,imageHeight:h})},e.src=a):"text"===t&&(e.height=h,e.width=m,(0,r.el)({image:e,canvas:i,topText:null,bottomText:null,centerText:d,canvasWidth:f,canvasHeight:p,imageWidth:m,imageHeight:h}))}},[c,p,f,d,h,m,a,o,t]),(0,i.jsx)("div",{id:u,className:"size-full transition-all flex items-center justify-center",children:y?(0,i.jsx)(l.default,{draggable:!1,priority:!0,src:a,alt:x,style:{borderRadius:"0px",filter:g<100?"blur(".concat(70/g,"px)"):"none",transition:"filter 0.5s"},className:(0,s.cn)("transition-all object-cover","w-[".concat(m,"px] h-[").concat(h,"px]"),v),width:m,height:h}):(0,i.jsx)("canvas",{ref:b,className:(0,s.cn)("size-full object-cover",v)})})}},37351:function(e,t,a){a.d(t,{J2:function(){return r},WN:function(){return s},aN:function(){return o},i4:function(){return n}});var i=a(69467),l=a(66353);let n={[i.WV.One]:1,[i.WV.TwoHorizontal]:2,[i.WV.TwoVertical]:2,[i.WV.Four]:4},r={[i.WV.One]:"grid-rows-1 h-fit w-fit",[i.WV.TwoHorizontal]:"grid-cols-2 w-full h-fit",[i.WV.TwoVertical]:"grid-rows-2 w-fit h-full",[i.WV.Four]:"grid-cols-2 grid-rows-2"};i.WV.One,i.WV.TwoHorizontal,i.WV.TwoVertical,i.WV.Four;let s={[i.WV.One]:"h-auto w-fit",[i.WV.TwoHorizontal]:"w-full h-fit",[i.WV.TwoVertical]:"w-fit h-full",[i.WV.Four]:"h-auto w-fit"},o={[i.WV.One]:l.tB.Square,[i.WV.TwoHorizontal]:l.tB.Portrait,[i.WV.TwoVertical]:l.tB.Landscape,[i.WV.Four]:l.tB.Square}},68389:function(e,t,a){a.d(t,{y:function(){return l}});var i=a(15346);let l=e=>{let{locked:t=!0}=e;(0,i.useEffect)(()=>{if(t){if(window.innerWidth>1024){let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>document.body.style.overflow=e}{let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>document.body.style.overflow=e}}},[t])}},5265:function(e,t,a){a.d(t,{M:function(){return r}});var i=a(15346),l=a(74859),n=a(76808);let r=e=>{let{feed:t,setFeed:a,hasFetched:r,setHasFetched:s,searchQuery:o,setSearchQuery:c,storeUrlParams:d=!0,fetchFn:u,deckId:m,fetchOnLoad:h=!0,pageSize:f=50,ignoreWindowScroll:p=!1,onFetchOnLoad:x}=e,{initialQuery:g,initialInterval:v,initialSortBy:w}=(0,n.x)(),[b,y]=(0,i.useState)(0),[j,_]=(0,i.useState)(!0),[k,N]=(0,i.useState)(!1),[C,P]=(0,i.useState)(v),[S,W]=(0,i.useState)(w),z=(0,i.useRef)(new AbortController),A=(0,i.useCallback)(async(e,t)=>Promise.resolve(u(e,t)).then(t=>(a(a=>t.length>0&&Number(e.start)>0?[...a,...t]:t),N(!1),s(!0),_(t.length===f),t)),[u,f,a,s]),T=(0,i.useMemo)(()=>(0,l.k)(A,1e3),[A]),I=(0,i.useCallback)(async(e,t,a)=>{var i,l,n,r,c;N(!0),s(!1);let d={search:null!==(i=e.search)&&void 0!==i?i:o,start:null!==(l=e.start)&&void 0!==l?l:b,limit:null!==(n=e.limit)&&void 0!==n?n:f,interval:null!==(r=e.interval)&&void 0!==r?r:C,sort_by:null!==(c=e.sort_by)&&void 0!==c?c:S,...m?{deck_id:m}:{}};return a?A(d,t):T(d,t)},[T,m,A,f,C,o,S,s,b]),V=(0,i.useCallback)(e=>{if(!r||!j||k)return;let t=null!=e?e:b+f;y(t),I({start:t})},[r,j,k,b,f,I]),M=(0,i.useCallback)(async()=>{let e=window.innerHeight;document.body.offsetHeight-window.scrollY<3*e&&V()},[V]),E=(0,i.useCallback)((e,t,a)=>{let i=new URL(window.location.href);e.length>0?i.searchParams.set("query",e):i.searchParams.delete("query"),t?i.searchParams.set("interval",t):i.searchParams.delete("interval"),a?i.searchParams.set("sort_by",a):i.searchParams.delete("sort_by"),window.history.pushState({},"",i.toString())},[]),D=(0,i.useCallback)(async(e,t,a)=>{let i=new AbortController;z.current.abort(),z.current=i,null==c||c(e),d&&E(e,t,a),y(0),_(!0),I({search:e,start:0,limit:f,interval:t,sort_by:a},z.current.signal)},[I,f,c,d,E]),R=(0,i.useCallback)(e=>{a([]),P(e),D(null!=o?o:"",e,S)},[D,o,S,a]),F=(0,i.useCallback)(e=>{a([]),W(e),D("",C,e)},[D,C,a]);return(0,i.useEffect)(()=>{if(!p)return window.addEventListener("scroll",M),()=>window.removeEventListener("scroll",M)},[M,p]),(0,i.useEffect)(()=>{let e=new AbortController;if(!r&&!(t.length>0)&&h&&!k)return I({search:g,start:0,limit:f,interval:v,sort_by:w},e.signal,!0).then(x),()=>{!e.signal.aborted&&k&&e.abort()}},[t.length,I,h,r,g,v,k,x,f,w]),(0,i.useEffect)(()=>(g&&(null==c||c(g)),v&&P(v),w&&W(w),()=>{a([]),null==c||c(""),s(!1)}),[v,g,w,a,s,P,c,W]),{feed:t,setFeed:a,setHasMore:_,onSearch:D,searchInterval:C,onSelectInterval:R,searchSortBy:S,onSelectSortBy:F,isFetching:k,hasMore:j,setIsFetching:N,setHasFetched:s,onReachedEnd:V}}},76808:function(e,t,a){a.d(t,{x:function(){return n}});var i=a(16189),l=a(41973);let n=()=>{var e,t,a;let n=(0,i.useSearchParams)();return{initialQuery:null!==(e=n.get("query"))&&void 0!==e?e:"",initialInterval:null!==(t=n.get("interval"))&&void 0!==t?t:l.u.Week,initialSortBy:null!==(a=n.get("sort_by"))&&void 0!==a?a:l.a.Hot}}},83815:function(e,t,a){a.d(t,{d:function(){return r}});var i=a(16189),l=a(15346),n=a(77623);let r=e=>{let{key:t,index:a,params:r}=e,s=(0,i.usePathname)(),o=(0,l.useMemo)(()=>{let e=n.P.some(e=>s.startsWith(e));if("memeId"===t&&!e)return r[t]||"";{var i;let e=null!==(i=s&&s.split("/")[a||2])&&void 0!==i?i:"";return r[t]||e}},[a,t,r,s]);return{[t]:decodeURIComponent(o)}}},56480:function(e,t,a){a.d(t,{u:function(){return l}});var i=a(15346);let l=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{up:[],down:[]},a=(0,i.useMemo)(()=>t.up,[t.up,t.up.length]),l=(0,i.useMemo)(()=>t.down,[t.down,t.down.length]);return{voteSum:(0,i.useMemo)(()=>a.length-l.length,[a,l]),hasUpvoted:(0,i.useMemo)(()=>a.some(t=>t.by===e),[a,a.length,e]),hasDownvoted:(0,i.useMemo)(()=>l.some(t=>t.by===e),[l,l.length,e])}}},13582:function(e,t,a){a.r(t),a.d(t,{AppHistoryProvider:function(){return o},useAppHistory:function(){return c}});var i=a(57348),l=a(16189),n=a(12465),r=a(15346);let s=(0,r.createContext)({}),o=e=>{let{children:t}=e,a=(0,l.usePathname)(),o=(0,l.useRouter)(),[c,d]=(0,r.useState)([]),u=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/home",t=arguments.length>1?arguments[1]:void 0,a=e;c.length>1&&(a=c[c.length-2],void 0!==t&&a.includes(t)&&(a=e)),"string"!=typeof a&&(a="/home"),o.push(a,{scroll:!1})},[c,o]);return(0,r.useEffect)(()=>{d(e=>e[e.length-1]!==a?[...e,a]:e)},[a]),(0,i.jsxs)(s.Provider,{value:{goBack:u},children:[t,(0,i.jsx)(n.wT,{dense:!0,maxSnack:3})]})},c=()=>{let e=(0,r.useContext)(s);if(void 0===e)throw Error("useFeed must be used within AppHistoryProvider");return e}},73421:function(e,t,a){a.r(t),a.d(t,{MemeModalProvider:function(){return ep},useMemeModal:function(){return ex}});var i=a(57348),l=a(16189),n=a(15346),r=a(68389),s=a(35971),o=a(35878),c=a(67425),d=a(45155),u=a(53350),m=a(81015);let h=e=>{let{id:t,saveFn:a=o.P.saveMeme,isSaved:l,variant:r="flat"}=e,[s,d]=(0,n.useState)(l),h=()=>{d(!s),a(t,s).catch(()=>{d(s)})};return(0,i.jsx)(m.e,{content:"Save to library",placement:"bottom",motionProps:{variants:{exit:{opacity:0,transition:{duration:.1,ease:"easeIn"}},enter:{opacity:1,transition:{duration:.15,ease:"easeOut"}}}},children:(0,i.jsx)(c.A,{isIconOnly:!0,size:"md",radius:"full",variant:"ghost",onClick:e=>{e.stopPropagation(),e.preventDefault(),h()},children:(0,i.jsx)(u.JO,{icon:s?"material-symbols:bookmark":"material-symbols:bookmark-outline",width:20})})})};var f=a(2406),p=a(46371),x=a(92378),g=a(41223),v=a(52053),w=a(71583),b=a(12465),y=a(18676),j=a(98470);let _=e=>{var t;let{meme:a}=e,[l,r]=(0,n.useState)(null),[s,c]=(0,n.useState)(!1),[d,u]=(0,n.useState)(null!==(t=a.appears_in)&&void 0!==t?t:[]),m=(0,n.useCallback)(async(e,t)=>{if(r(e),e&&t)try{var i;let l=null===(i=a.posts)||void 0===i?void 0:i[0];if(!e)throw Error("Deck ID is missing");if(!l)throw Error("Post ID is missing");c(!0),await o.P.submitPostToDeck(e,{post_id:l}),r(null),u(e=>[...e,t])}catch(e){console.error(e),(0,b.yv)("Failed to add meme to deck",{variant:"error"})}finally{c(!1)}},[a.posts]);return(0,i.jsxs)(x.w,{classNames:{base:"pb-1"},children:[(0,i.jsxs)(g.u,{className:"flex items-center gap-3",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Appears In"}),d.length>0&&(0,i.jsx)(v.z,{size:"sm",variant:"flat",children:d.length})]}),(0,i.jsxs)(w.G,{className:"gap-3 pt-0",children:[(0,i.jsx)("div",{className:"size-full flex flex-col gap-1.5 min-h-0 max-h-80 overflow-y-auto",children:0===d.length?(0,i.jsx)("p",{className:"text-sm text-white-400/50",children:"No decks yet"}):d.filter(e=>e.title.length>0).map(e=>(0,i.jsx)(y.D,{deck:e,hideActiveState:!0},e.id))}),a.is_creator&&(0,i.jsx)(j.Z,{maxW:"max-w-full",memeId:a.id,isLoading:s,selectedDeck:l,onSelectDeck:m,alreadySelected:d})]})]})};var k=a(37734),N=a(74859),C=a(51934),P=a(88036),S={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/plus.63a0d87f.svg",height:24,width:24,blurWidth:0,blurHeight:0},W=a(15667);let z=[],A=(0,N.k)(o.P.searchTags,1e3),T=e=>{let{tagId:t,tagName:a,minW:l="min-w-36",variant:r,onUpdateTag:s,onDeleteTag:o,onClick:c}=e,u=(0,n.useRef)(null),[m,h]=(0,n.useState)(a),[f,p]=(0,n.useState)(t),[x,g]=(0,n.useState)([]),[v,w]=(0,n.useState)(!1),[b,y]=(0,n.useState)(!1),j=async e=>{w(!0);let t=await A(e);t&&(g(t),w(!1))},_=e=>{if(e!==a)return w(!1),y(!1),g([]),null==s?void 0:s(e)},k=async()=>{g([]),w(!1),y(!0),await (null==o?void 0:o()),y(!1),h("")};return(0,i.jsx)(C.d,{ref:u,allowsCustomValue:!0,defaultInputValue:"",inputValue:m,defaultSelectedKey:"",selectedKey:f,defaultItems:z,items:x,maxLength:20,isLoading:v,isDisabled:b,className:"inline-flex w-auto max-w-0 ".concat(l),color:"default",variant:r,radius:"full",onBlur:()=>_(m),onInputChange:e=>{null!==e&&(h(e),""===e?g([]):e.length>2&&j(e))},onSelectionChange:e=>{p(e);let t=x.find(t=>t.id===e);t&&(g([]),h(t.name),_(t.name))},placeholder:"Add tag","aria-label":"Add tag",disableSelectorIconRotation:!0,selectorIcon:m.length>0?(0,i.jsx)(d.default,{src:W.Z,className:"w-2.5 opacity-75",alt:"Clear tag"}):(0,i.jsx)(d.default,{src:S,className:"w-3 opacity-75",alt:"Add tag"}),isClearable:!1,selectorButtonProps:{disableRipple:!0,onClick:()=>{m.length>0&&k()}},onKeyDown:e=>{var t,a;"Escape"===e.key?null===(t=u.current)||void 0===t||t.blur():"Enter"===e.key&&0===x.length&&(null===(a=u.current)||void 0===a||a.blur())},onClick:c,children:e=>(0,i.jsx)(P.R,{value:e.id,children:e.name},e.id)})},I=(0,N.k)(o.P.tagResource,1e3),V=e=>{let{memeId:t,tags:a,onUpdateTags:l}=e,n=a.length<10?[...a,{id:"",name:""}]:a,r=async e=>{l(a.filter(t=>t.id!==e));try{await o.P.untagResource(t,e)}catch(e){l(a)}},s=async(e,i)=>{let n=i.toLowerCase().replaceAll(" ","_").replaceAll("-","_"),r=[...a];r[e]={id:n,name:i},l(r);try{var s;await I(t,i),(null===(s=a[e])||void 0===s?void 0:s.id)&&await o.P.untagResource(t,a[e].id)}catch(e){l(a)}};return(0,i.jsx)("div",{className:"flex mb-3 gap-2 overflow-x-auto scrollbar-hide",children:n.map((e,t)=>(0,i.jsx)(T,{tagId:e.id,tagName:e.name,minW:"min-w-[124px]",variant:"faded",onUpdateTag:e=>s(t,e),onDeleteTag:()=>r(e.id)},"tag-pill-".concat(e.id,"-").concat(t)))})};var M={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/info.333102d7.svg",height:24,width:24,blurWidth:0,blurHeight:0};let E=(0,N.k)(o.P.updateMeme,1e3),D=e=>{var t;let{meme:a,setMeme:l}=e,r=(0,n.useCallback)(async e=>{a&&l({...a,tags:e})},[a,l]),s=(0,n.useCallback)(async e=>{if(a){l({...a,extracted_text:e});try{await E(a.id,{extracted_text:e})}catch(e){l(a)}}},[a,l]);return a?(0,i.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,i.jsx)(k.Y,{label:(0,i.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Extracted text"}),(0,i.jsx)(m.e,{placement:"bottom",content:(0,i.jsx)("div",{className:"w-52",children:"This is AI extracted text from the meme image. You can correct it if needed here."}),children:(0,i.jsx)(d.default,{src:M,width:19,height:19,alt:"Info"})})]}),placeholder:"This is AI extracted text from the meme image. You can correct it if needed here.",classNames:{base:"p-0 hover:outline-1 border-transparent",mainWrapper:"p-0",inputWrapper:"px-0 py-4 gap-2 bg-content1 hover:bg-content2",label:"flex px-4 text-lg !text-white-400 font-semibold",innerWrapper:"px-4",input:"text-white-400/50"},value:null!==(t=a.extracted_text)&&void 0!==t?t:"",onValueChange:s}),(0,i.jsxs)(x.w,{children:[(0,i.jsx)("header",{className:"p-4",children:(0,i.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,i.jsx)("h3",{className:"text-base font-semibold",children:"Keywords"}),(0,i.jsx)(m.e,{placement:"bottom",content:(0,i.jsx)("div",{className:"w-52",children:"The right set of keywords can help others find your meme."}),children:(0,i.jsx)(d.default,{src:M,width:16,height:16,alt:"Info"})})]})}),(0,i.jsx)(w.G,{className:"p-4 pt-0",children:(0,i.jsx)(V,{memeId:a.id,tags:a.tags,onUpdateTags:r})})]})]}):null};var R=a(80780);let F=e=>{let{meme:t,onClose:a}=e,{removeItemFromFeed:l}=(0,s.useFeed)(),[r,d]=(0,n.useState)(!1),h=(0,n.useCallback)(async()=>{var e;let a=null===(e=t.posts)||void 0===e?void 0:e[0];a&&l(a)},[t,l]),f=(0,n.useCallback)(async()=>{await o.P.deleteMeme(t.id),l(t.id)},[t.id,l]),p=(0,n.useCallback)(async()=>{d(!0);try{await h(),await f(),a(),(0,b.yv)("Meme deleted",{variant:"success",autoHideDuration:2e3})}catch(e){(0,b.yv)("Failed to delete meme",{variant:"error",autoHideDuration:2e3})}d(!1)},[h,f,a]);return(0,i.jsx)(m.e,{content:"Delete",placement:"bottom",motionProps:{variants:{exit:{opacity:0,transition:{duration:.1,ease:"easeIn"}},enter:{opacity:1,transition:{duration:.15,ease:"easeOut"}}}},children:(0,i.jsx)(c.A,{isIconOnly:!0,size:"md",radius:"full",variant:"ghost",color:"danger",isLoading:r,onClick:p,children:(0,i.jsx)(u.JO,{icon:"fluent:delete-24-regular",width:18})})})};var O=a(52154),B=a(85432),H=a(13398),U=a(13881);let L=e=>{let{tags:t,wrap:a="flex-wrap",onClickTag:l}=e;return(0,i.jsx)("div",{className:"flex gap-2 ".concat(a),children:t.map((e,t)=>(0,i.jsx)(U.default,{href:"/trending?query=".concat(e),onClick:()=>null==l?void 0:l(e),children:(0,i.jsx)(v.z,{variant:"flat",children:e.replace("tag:","")})},"tag-".concat(e,"-").concat(t)))})},J=e=>{let{meme:t}=e;return(0,i.jsxs)(B.d,{itemClasses:{subtitle:"text-sm text-white-400/50",trigger:"text-base font-semibold",indicator:"text-lg",content:"pt-0 text-small"},variant:"shadow",selectionMode:"multiple",defaultSelectedKeys:["2","3","4"],children:[t.template_data?(0,i.jsx)(H.G,{"aria-label":t.template_data.title,startContent:(0,i.jsx)(d.default,{width:48,height:48,className:"size-12 rounded-md object-cover",src:t.template_data.image_url,alt:t.template_data.title}),subtitle:t.template_data.title,classNames:{title:"font-base text-sm text-white-400/50",subtitle:"text-large font-semibold text-white-400",content:"pb-4 pt-0"},title:"Meme Template",children:(0,i.jsx)("p",{className:"text-sm",children:t.template_data.about})},"1"):(0,i.jsx)(H.G,{hideIndicator:!0,isDisabled:!0,title:"Meme template","aria-label":"No template detected",subtitle:"No template detected"},"1"),t.extracted_text?(0,i.jsx)(H.G,{title:"Extracted text",classNames:{base:"pb-2 pt-0",trigger:"pt-4 pb-2 text-base font-semibold",content:"pb-2 pt-0"},children:(0,i.jsx)("p",{className:"text-sm",children:t.extracted_text})},"2"):(0,i.jsx)(H.G,{title:"Extracted text",classNames:{base:"pb-2 pt-0",trigger:"pt-4 pb-2 text-base font-semibold",content:"pb-2 pt-0"},subtitle:"No text was extracted","aria-label":"No extracted text",hideIndicator:!0,isDisabled:!0},"2"),t.tags.length>0?(0,i.jsx)(H.G,{classNames:{content:"pb-4 pt-0"},title:"Keywords (".concat(t.tags.length,")"),children:(0,i.jsx)(L,{tags:t.tags.map(e=>{let{name:t}=e;return t})})},"3"):(0,i.jsx)(H.G,{hideIndicator:!0,isDisabled:!0,title:"Tags","aria-label":"No tags added",subtitle:"No tags added"},"3")]})},q=e=>{let{meme:t}=e;if("generated"==t.source)return(0,i.jsx)(O.R,{prompt:t.prompt});if("composed"==t.source){var a,l;let e=Object.values(null!==(l=t.panels)&&void 0!==l?l:{}).find(e=>"meme"in e.panel_config);return e?(0,i.jsx)(O.R,{prompt:null===(a=e.panel_config)||void 0===a?void 0:a.prompt}):null}return(0,i.jsx)(J,{meme:t})};var G=a(99957);let Z=e=>{let{children:t}=e;return(0,i.jsx)("aside",{id:"modal-aside",className:(0,G.cn)("max-w-full flex-1 flex flex-col gap-3 p-3","border-l border-white-400/10 bg-black-400","sm:min-w-96 md:min-h-full md:max-w-96 md:flex-none xs:h-auto"),children:t})};var K=a(98086),Y=a(71402),X=a(73492),Q=a(73139),$=a(55771),ee=a(69467),et=a(55147),ea=a(39543),ei=a(81727);let el=e=>{var t,a;let{onClose:r}=e,u=(0,l.useRouter)(),{profile:m}=(0,Y.useProfile)(),{oneOffMeme:x,setOneOffMeme:g,appendMemesToFeed:v}=(0,s.useFeed)(),[w,b]=(0,n.useState)(!1),[y,j]=(0,n.useState)(!1),[k,N]=(0,n.useState)(!1),C=(0,n.useMemo)(()=>{var e;return Number(null==x?void 0:null===(e=x.posts)||void 0===e?void 0:e.length)>0},[x]),P=(0,n.useMemo)(()=>{var e;return null!==(e=null==m?void 0:m.user.id)&&void 0!==e?e:""},[m]),S=(0,n.useCallback)(async()=>{if(!x)return;j(!0);let e=x.id,t=x;if("generated"===x.source){let a=(0,ei.uZ)(),{newPanels:i}=await (0,p.P)(a,x);if(!i)throw Error("Failed to create composed meme");let l={0:{...i[0],panel_type:"generated",panel_config:{meme:x}}},n=await $.p.getConfig(),r=(0,X.xe)(l,n),s=r.find(e=>0===e.idx);if(!s)throw Error("Failed to find first panel");let c=s.image.selectedAspectRatio,d=await (0,et.jt)(r,ee.WV.One,c),u=(0,ea.rf)(ee.WV.One,c),{canvasWidth:m,canvasHeight:h}=(0,ea.GJ)(ee.WV.One,u),f={filetype:"image/jpeg",bytes:Array.from(new Uint8Array(d)),width:m,height:h},g=await o.P.composedUpload(a,f).catch(e=>(console.error("Failed to compile composed meme",e),null));if(!g)throw Error("Failed composed upload");e=a,t={...x,id:a,url:g.url}}let a=await o.P.createPost({post_type:{meme:e}});if(!a)throw Error("Failed to create post");let i=new Date().getTime();t={...t,posts:[a.id],published_at:i,is_public:!0},j(!1),m&&(g(t),v([t],m),N(!0))},[v,x,m,g]),W=(0,n.useCallback)(()=>{x&&u.push("/studio?remix=".concat(x.id))},[x,u]);return(0,i.jsxs)(Z,{children:[x&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("header",{className:"my-2 flex flex-col gap-5",children:(0,i.jsx)(R.B,{handle:x.creator_handle,name:x.creator_name,avatar:x.creator_avatar,createdAt:x.created_at,publishedAt:x.published_at})}),(0,i.jsx)(_,{meme:x}),w?(0,i.jsx)(D,{meme:x,setMeme:g}):(0,i.jsx)(q,{meme:x}),(0,i.jsxs)("footer",{className:"flex justify-between gap-2 md:gap-3 pb-6 md:p-0",children:[w?(0,i.jsx)(F,{meme:x,onClose:r}):(0,i.jsxs)("div",{className:"flex flex-1 gap-2 md:gap-3",children:[(0,i.jsx)(f.I,{size:"md",memeId:x.id,initialVotes:x.votes,userId:P,addVoteApi:o.P.createMemeReaction,removeVoteApi:o.P.deleteMemeReaction}),(0,i.jsx)(h,{id:x.id,isSaved:null!==(a=x.is_saved)&&void 0!==a&&a})]}),x.is_creator&&w&&(0,i.jsx)(c.A,{variant:"solid",color:"primary",onClick:()=>b(!1),children:"Done"}),x.is_creator&&!w&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(c.A,{variant:"solid",onClick:()=>b(!0),children:"Edit"}),!C&&(0,i.jsx)(c.A,{variant:"solid",color:"primary",isLoading:y,onClick:S,children:"Post"})]}),x.source&&ee.FU.includes(x.source)&&!w&&C&&(0,i.jsx)(c.A,{variant:"solid",color:"primary",startContent:(0,i.jsx)(d.default,{src:Q.Z,alt:"Remix",className:"size-4"}),onClick:W,children:"Remix"})]})]}),k&&x&&(0,i.jsx)(K.F,{postId:null===(t=x.posts)||void 0===t?void 0:t[0],memeId:x.id,memeUrl:x.url,onClose:()=>N(!1)})]})};var en=a(4930),er=a(37824),es=a(13582);let eo=e=>{let{maxWidth:t="max-w-4xl",children:a}=e,{goBack:l}=(0,es.useAppHistory)();return(0,i.jsxs)("main",{className:"relative flex max-h-full flex-1 flex-col bg-black-400 md:min-h-full md:overflow-hidden md:bg-transparent lg:overflow-hidden",children:[(0,i.jsx)(er.O,{src:W.Z,alt:"Close",onClick:l}),(0,i.jsx)("div",{className:"relative flex min-h-0 min-w-0 max-w-full flex-1 items-center justify-center md:m-3",children:(0,i.jsx)("div",{className:"relative flex size-full max-h-full min-h-0 min-w-0 items-center justify-center ".concat(t),children:a})})]})};var ec=a(81254);let ed=e=>{var t,a,l,n,r,o,c,u,m,h;let{isFetching:f=!1}=e,{oneOffMeme:p}=(0,s.useFeed)();return(0,i.jsx)(eo,{children:(0,i.jsxs)("div",{className:(0,G.cn)("flex items-center justify-center","size-full max-h-full min-h-0 gap-3 overflow-hidden","px-0 lg:gap-6 lg:p-3"),children:[f&&(0,i.jsx)(en.c,{}),!f&&p&&(0,i.jsx)("div",{style:{aspectRatio:p.width/p.height},className:(0,G.cn)("w-full max-w-full min-h-0 max-h-full","lg:w-[".concat(p.width,"px] lg:h-[").concat(p.height,"px]")),children:"generated"===p.source?(0,i.jsx)(ec.g,{id:"meme-lightbox-image",type:p.source,imageWidth:null!==(l=p.width)&&void 0!==l?l:1024,imageHeight:null!==(n=p.height)&&void 0!==n?n:1024,canvasWidth:null!==(r=p.width)&&void 0!==r?r:1024,canvasHeight:null!==(o=p.height)&&void 0!==o?o:1024,src:p.url,alt:p.caption,topText:null!==(c=null===(t=p.text_overlay)||void 0===t?void 0:t.top_text)&&void 0!==c?c:null,bottomText:null!==(u=null===(a=p.text_overlay)||void 0===a?void 0:a.bottom_text)&&void 0!==u?u:null,centerText:null,className:"max-h-canvas"}):(0,i.jsx)("div",{id:"meme-lightbox-image",className:"size-full flex items-center justify-center",children:(0,i.jsx)(d.default,{style:{aspectRatio:p.width/p.height},width:null!==(m=p.width)&&void 0!==m?m:1024,height:null!==(h=p.height)&&void 0!==h?h:1024,src:p.url,alt:p.caption,className:"size-full object-contain max-h-canvas"})})})]})})},eu=e=>{let{memeId:t,onClose:a}=e;(0,r.y)({locked:!0});let{setOneOffMeme:l}=(0,s.useFeed)(),[c,d]=(0,n.useState)(!0);return(0,n.useEffect)(()=>{d(!0);let e=decodeURIComponent(t);return o.P.getMeme(e).then(e=>{if(!e)return a();l(e)}).finally(()=>d(!1)),()=>{l(null),d(!1)}},[t,a,l]),(0,n.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[a]),(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex size-full items-center justify-center bg-black-400/90 sm:overflow-y-auto md:overflow-hidden xs:overflow-y-auto",onClick:e=>{let t=e.target;t.closest("#modal-aside")||t.closest("#meme-lightbox-image")||a()},onDragOver:e=>(e.preventDefault(),e.stopPropagation(),!1),children:(0,i.jsxs)("div",{className:"flex size-full flex-1 flex-col sm:overflow-y-auto md:flex-row",children:[(0,i.jsx)(ed,{isFetching:c}),(0,i.jsx)(el,{onClose:a})]})})};var em=a(77623),eh=a(83815);let ef=(0,n.createContext)({}),ep=e=>{let{params:t,children:a}=e,{memeId:n}=(0,eh.d)({params:t,key:"memeId"}),r=(0,l.useSearchParams)().get("memeId"),s=n.length>0?n:r,{openMemeModal:o,closeMemeModal:c}=(0,em.T)();return(0,i.jsxs)(ef.Provider,{value:{onOpenMeme:o,onCloseMeme:c},children:[a,s&&(0,i.jsx)(eu,{memeId:s,onClose:c})]})},ex=()=>{let e=(0,n.useContext)(ef);if(void 0===e)throw Error("useFeed must be used within MemeModalProvider");return e}},73492:function(e,t,a){a.d(t,{eZ:function(){return u},r_:function(){return c},v2:function(){return o},xe:function(){return d}});var i=a(35878),l=a(39543),n=a(74859),r=a(99349),s=a(71046);let o=(0,n.k)(i.P.updateMemePanel,1e3),c=(0,n.k)(i.P.postMemeTextOverlay,1e3);function d(e,t){return Object.values(e).map(e=>{var a,i,n,o,c,d,u,m,h,f,p,x,g,v,w,b,y,j,_,k,N,C,P,S,W,z,A,T,I,V,M,E,D,R,F,O,B,H,U;let L="text"===e.panel_type,J="generated"===e.panel_type,q="faceswap"===e.panel_type,G=e.panel_config,Z=e.panel_config,K=e.panel_config,Y={idx:e.idx,id:e.id,type:e.panel_type,image:{...s.CJ},text:{...s.M5},faceswap:{...s.U1}};if(L&&G)return{...Y,text:{text:G.text}};if(q&&K)return{...Y,image:{...s.CJ,src:null!==(a=K.swapped_image)&&void 0!==a?a:"",selectedAspectRatio:(0,l.vO)(null!==(i=null==K?void 0:K.base_width)&&void 0!==i?i:1024,null!==(n=null==K?void 0:K.base_height)&&void 0!==n?n:1024)},faceswap:{...s.U1,baseWidth:null==K?void 0:K.base_width,baseHeight:null==K?void 0:K.base_height,baseImage:null!==(o=K.base_image)&&void 0!==o?o:"",faceImage:null!==(c=K.face_image)&&void 0!==c?c:"",swappedImage:null!==(d=K.swapped_image)&&void 0!==d?d:"",strength:null!==(u=K.strength)&&void 0!==u?u:1}};if(!J||!Z)return Y;{let e=null===(m=Z.prompt)||void 0===m?void 0:m.character,a=e&&"string"==typeof e&&null!==(W=t.characters.find(t=>t.id===e.replace("ai_character:","")))&&void 0!==W?W:s.CJ.selectedCharacter,i=null===(h=Z.prompt)||void 0===h?void 0:h.styler,n=i&&"string"==typeof i&&null!==(z=t.stylers.find(e=>e.id===i.replace("ai_image_style:","")))&&void 0!==z?z:s.CJ.selectedStyler,o=(null===(f=Z.prompt)||void 0===f?void 0:f.aesthetic)&&"string"==typeof(null===(p=Z.prompt)||void 0===p?void 0:p.aesthetic)&&null!==(A=t.aesthetics.find(e=>{var t;return e.id===(null===(t=Z.prompt)||void 0===t?void 0:t.aesthetic)}))&&void 0!==A?A:s.CJ.selectedAesthetic;return{...Y,image:{...s.CJ,src:null!==(T=null===(x=Z.meme)||void 0===x?void 0:x.url)&&void 0!==T?T:"",width:null!==(I=null===(g=Z.meme)||void 0===g?void 0:g.width)&&void 0!==I?I:1024,height:null!==(V=null===(v=Z.meme)||void 0===v?void 0:v.height)&&void 0!==V?V:1024,selectedAspectRatio:(0,l.vO)(null!==(M=null===(w=Z.meme)||void 0===w?void 0:w.width)&&void 0!==M?M:1024,null!==(E=null===(b=Z.meme)||void 0===b?void 0:b.height)&&void 0!==E?E:1024),posPrompt:null!==(D=null===(y=Z.prompt)||void 0===y?void 0:y.user_positive_prompt)&&void 0!==D?D:"",negPrompt:null!==(R=null===(j=Z.prompt)||void 0===j?void 0:j.user_negative_prompt)&&void 0!==R?R:"",guidanceScale:null!==(F=null===(_=Z.prompt)||void 0===_?void 0:_.cfg_scale)&&void 0!==F?F:2.7,seed:null!==(O=null===(k=Z.prompt)||void 0===k?void 0:k.seed)&&void 0!==O?O:(0,r.q)(),seedType:null!==(B=null===(N=Z.prompt)||void 0===N?void 0:N.seed_type)&&void 0!==B?B:"random",selectedCharacter:a,selectedStyler:n,selectedAesthetic:o,...Z.text_overlay,topText:null!==(H=null===(C=Z.text_overlay)||void 0===C?void 0:C.top_text)&&void 0!==H?H:"",bottomText:null!==(U=null===(P=Z.text_overlay)||void 0===P?void 0:P.bottom_text)&&void 0!==U?U:"",id:null===(S=Z.meme)||void 0===S?void 0:S.id}}}})}function u(e){let t={};return e.forEach(e=>{"text"===e.type?t[e.idx]={idx:e.idx,id:e.id,panel_type:"text",panel_config:{text:e.text.text},created_at:1e3*Date.now()}:t[e.idx]={idx:e.idx,id:e.id,panel_type:"generated",panel_config:{meme:{id:e.image.id,url:e.image.src,width:e.image.width,height:e.image.height},prompt:{user_positive_prompt:e.image.posPrompt,user_negative_prompt:e.image.negPrompt,cfg_scale:e.image.guidanceScale,aesthetic:e.image.selectedAesthetic,character:"ai_character:".concat(e.image.selectedCharacter.id),styler:"ai_image_style:".concat(e.image.selectedStyler.id),aspect_ratio:e.image.selectedAspectRatio},text_overlay:{top_text:e.image.topText,bottom_text:e.image.bottomText}},created_at:1e3*Date.now()}}),t}},71046:function(e,t,a){a.d(t,{CJ:function(){return r},M5:function(){return o},U1:function(){return s},ZA:function(){return c},fP:function(){return n},nv:function(){return d}});var i=a(66353),l=a(99349);let n={name:"Photorealistic",id:"photorealistic",images:null,thumbnail:"",grouping:"style"},r={id:"",src:"",prevSrc:"",width:1024,height:1024,posPrompt:"",negPrompt:"",isExpandedPrompt:!1,seed:(0,l.q)(),seedType:"random",topText:"",bottomText:"",guidanceScale:2.7,selectedAspectRatio:i.tB.Square,selectedAesthetic:null,selectedCharacter:{name:"Apu Apustaja",id:"apu_apustaja",images:null,thumbnail:"https://memedeckblob.blob.core.windows.net/ai-characters/classic-thumbnails/apu-apustaja.png",grouping:"base"},selectedStyler:n,progress:0,isGenerating:!1,isRandomizing:!1},s={faceImage:"",baseImage:"",baseWidth:void 0,baseHeight:void 0,swappedImage:"",strength:1},o={text:""},c=[{idx:0,id:"0",type:"generated",image:{...r},text:{...o},faceswap:{...s}},{idx:1,id:"1",type:"generated",image:{...r},text:{...o},faceswap:{...s}},{idx:2,id:"2",type:"generated",image:{...r},text:{...o},faceswap:{...s}},{idx:3,id:"3",type:"generated",image:{...r},text:{...o},faceswap:{...s}}],d=(e,t)=>{switch(t.action){case"reset":return e.map(e=>e.idx!==t.idx?e:{...e,image:{...e.image,...r},text:{...e.text,...o},faceswap:{...e.faceswap,...s}});case"blank-slate":return[...c];case"update-panel":return e.map(e=>{var a,i;return e.idx!==t.idx?e:{...e,id:null!==(a=t.id)&&void 0!==a?a:e.id,type:null!==(i=t.type)&&void 0!==i?i:e.type,image:{...e.image,...t.image},text:{...e.text,...t.text},faceswap:{...e.faceswap,...t.faceswap}}});case"delete":return e.filter(e=>e.idx!==t.idx);default:return console.error("Unknown action type"),e}}},55771:function(e,t,a){a.d(t,{p:function(){return r},s:function(){return l}});var i=a(54167);let l=()=>i.cm?"wss://staging-generation-api.memedeck.xyz/v1/ws":i.BB||i.j7?"wss://studio.api.memedeck.xyz/v1/ws":"ws://127.0.0.1:8079/v1/ws";class n{async getConfig(){return fetch("".concat(n.BASE_URL,"/studio/config")).then(e=>e.json())}async getRandomPrompt(){return fetch("".concat(n.BASE_URL,"/studio/random-prompt")).then(e=>e.json())}}n.BASE_URL=i.cm?"https://staging-generation-api.memedeck.xyz/v1":i.BB||i.j7?"https://studio.api.memedeck.xyz/v1":"http://127.0.0.1:8079/v1";let r=new n},69467:function(e,t,a){var i,l;a.d(t,{FU:function(){return n},WV:function(){return i},kl:function(){return r}});let n=["generated","composed"];function r(e){return!!e.tags&&e.tags.some(e=>"nsfw"===e.name)}(l=i||(i={})).One="one",l.TwoVertical="two-vertical",l.TwoHorizontal="two-horizontal",l.Four="four-square"},66353:function(e,t,a){var i,l;function n(e){return"library"===e?"generated":e}function r(e){switch(e){case"composed":case"upload":return"generated";default:return e}}a.d(t,{JY:function(){return n},fJ:function(){return r},tB:function(){return i}}),(l=i||(i={})).Square="square",l.Landscape="landscape",l.Portrait="portrait"},55147:function(e,t,a){a.d(t,{jt:function(){return g},el:function(){return f},mr:function(){return x}});var i=a(37351),l=a(69467);async function n(e){return await new Promise((t,a)=>{e.toBlob(e=>{if(!e){a(Error("Failed to create blob"));return}let i=new FileReader;i.onload=()=>{let e=i.result;t(new Uint8Array(e))},i.readAsArrayBuffer(e)},"image/jpeg")})}var r=a(39543),s=a(38857);async function o(e){let{ctx:t,url:a,x:i,y:l,paneWidth:n,paneHeight:r}=e,o=new Image;o.crossOrigin="Anonymous",o.src=a,await new Promise((e,t)=>{o.onload=e,o.onerror=t}),await (0,s.h)({ctx:t,image:o,targetWidth:n,targetHeight:r,imageWidth:o.width,imageHeight:o.height,anchorX:i,anchorY:l})}var c=a(54167);async function d(e){let{ctx:t,content:a,placement:i,x:l,y:n,maxWidth:r}=e;return new Promise(e=>{for(var s=a.split(" "),o="",d=[],u=0;u<s.length;u++){var m=o+s[u]+" ";t.measureText(m).width>r&&u>0?(d.push({text:o,y:n}),o=s[u]+" ",n+=100):o=m}if(d.push({text:o.trim(),y:n}),"bottom"===i){let e=100*d.length;d=d.map(t=>({text:t.text,y:t.y-e+100}))}if("center"===i){let e=100*d.length;d=d.map(t=>({text:t.text,y:t.y-e/2+50}))}d.forEach(e=>{(0,c.Dt)()?(t.strokeText(e.text,l,e.y),t.fillText(e.text,l,e.y)):(t.fillText(e.text,l,e.y),t.strokeText(e.text,l,e.y))}),e()})}async function u(e){return new Promise((t,a)=>{let i=new Image;i.crossOrigin="Anonymous",i.src="/memedeck:memedeck:meme-deck.os/_next/static/media/logo.650a12fc.png";let l=e.canvas.width,n=e.canvas.height,r=32;l>1024&&n>1024?r=64:(l>1024||n>1024)&&(r=48),i.onload=()=>{let a=l-r-10,s=n-r-10;e.save(),e.globalAlpha=.4,e.drawImage(i,a,s,r,r),e.restore(),t()},i.onerror=e=>{a(e)}})}let m="bold ".concat(80,"px Impact");function h(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];e.font=m,e.fillStyle=t?"white":"black",e.strokeStyle=t?"black":"white",e.lineWidth=3,e.lineJoin="round",e.textAlign="center",(0,c.Dt)()&&(e.shadowColor=t?"black":"white",e.shadowBlur=6,e.shadowOffsetX=0,e.shadowOffsetY=0)}async function f(e){let{image:t,canvas:a,topText:i,bottomText:l,centerText:n,canvasWidth:r,canvasHeight:o,imageWidth:c,imageHeight:u}=e,m=a.getContext("2d");if(!m||(t.width=c,t.height=u,a.width=r,a.height=o,n?(m.fillStyle="white",m.fillRect(0,0,a.width,a.height)):await (0,s.h)({ctx:m,image:t,targetWidth:r,targetHeight:o,imageWidth:c,imageHeight:u}),!i&&!l&&!n))return;h(m,!n);let f=a.width-40,p=a.width/2,x=a.height/2,g=a.height-64;i&&await d({ctx:m,content:i,placement:"top",x:p,y:120,maxWidth:f}),n&&await d({ctx:m,content:n,placement:"center",x:p,y:x,maxWidth:f}),l&&await d({ctx:m,content:l,placement:"bottom",x:p,y:g,maxWidth:f})}async function p(e,t,a,i,l){return new Promise(n=>{e.fillStyle="black",e.fillRect(t,a,i,l),n()})}async function x(e){let{canvas:t,studioPanels:a,studioLayout:n,paneAspectRatio:s}=e,c=t.getContext("2d");if(!c)throw Error("Failed to create canvas context");let{paneWidth:m,paneHeight:f}=(0,r.rf)(n,s),x=(0,r.rf)(n,s),{canvasWidth:g,canvasHeight:v}=(0,r.GJ)(n,x);t.width=g,t.height=v;let w=a.map(e=>"generated"===e.type||"faceswap"===e.type?e:null).filter(Boolean),b=a.map(e=>"text"===e.type?e:null).filter(Boolean);for(let e=0;e<Math.min(i.i4[n],w.length+b.length);e++){let t=w.find(t=>t.idx===e),a=b.find(t=>t.idx===e),i=0,r=0;if(n===l.WV.TwoHorizontal?(i=e%2==0?0:m,r=0):n===l.WV.TwoVertical?(i=0,r=e%2==0?0:f):n===l.WV.Four&&(i=e%2==0?0:m,r=e<2?0:f),t&&t.image.src)try{await o({ctx:c,url:t.image.src,x:i,y:r,paneWidth:m,paneHeight:f}),h(c);let e=t.image.topText,a=t.image.bottomText,l=m-40,n=i+m/2,s=r+120,u=r+f-64;e&&await d({ctx:c,content:e,placement:"top",x:n,y:s,maxWidth:l}),a&&await d({ctx:c,content:a,placement:"bottom",x:n,y:u,maxWidth:l})}catch(e){console.error("Failed to load image from meme source",e)}else if(a){c.fillStyle="white",c.fillRect(i,r,m,f),h(c,!1);let e=m-40,t=i+m/2,l=r+f/2;await d({ctx:c,content:a.text.text,placement:"center",x:t,y:l,maxWidth:e})}}n===l.WV.TwoHorizontal?await p(c,m,0,10,v):n===l.WV.TwoVertical?await p(c,0,f,g,10):n===l.WV.Four&&(await p(c,m,0,10,v),await p(c,0,f,g,10)),await u(c)}async function g(e,t,a){let i=document.createElement("canvas");return await x({canvas:i,studioPanels:e,studioLayout:t,paneAspectRatio:a}),n(i)}},39543:function(e,t,a){a.d(t,{GJ:function(){return s},rf:function(){return r},vO:function(){return o}});var i=a(69467),l=a(66353);let n={[l.tB.Square]:[1152,1152],[l.tB.Landscape]:[1152,896],[l.tB.Portrait]:[896,1152]};function r(e,t){let a=0,l=0;if(e===i.WV.One){let e=n[t];a=e[0],l=e[1]}else if(e===i.WV.TwoVertical)a=1152,l=896;else if(e===i.WV.TwoHorizontal)a=896,l=1152;else if(e===i.WV.Four)a=1152,l=1152;else throw Error("Unsupported panel layout");return{paneWidth:a,paneHeight:l}}function s(e,t){let a=0,l=0;if(e===i.WV.One&&t)a=t.paneWidth,l=t.paneHeight;else if(e===i.WV.TwoVertical)a=1152,l=1792;else if(e===i.WV.TwoHorizontal)a=1792,l=1152;else if(e===i.WV.Four)a=2304,l=2304;else throw Error("Unsupported panel layout");return{canvasWidth:a,canvasHeight:l}}function o(e,t){return 10>Math.abs(e-t)?l.tB.Square:e>t?l.tB.Landscape:l.tB.Portrait}},38857:function(e,t,a){a.d(t,{h:function(){return i}});async function i(e){let{ctx:t,image:a,targetWidth:i,targetHeight:l,imageWidth:n,imageHeight:r,anchorX:s=0,anchorY:o=0}=e;return new Promise(e=>{let c=Math.max(i/n,l/r),d=n*c,u=r*c;t.save(),t.beginPath(),t.rect(s,o,i,l),t.clip(),t.drawImage(a,s+(i-d)/2,o+(l-u)/2,d,u),t.restore(),e()})}},99349:function(e,t,a){a.d(t,{q:function(){return i}});function i(){return Math.floor(1e12*Math.random())}},73139:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/magic.8c74570a.svg",height:18,width:18,blurWidth:0,blurHeight:0}},15667:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/xmark.ac6fe3e8.svg",height:48,width:48,blurWidth:0,blurHeight:0}}}]);