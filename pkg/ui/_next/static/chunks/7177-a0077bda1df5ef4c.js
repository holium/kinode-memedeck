"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7177],{13296:function(e,t,a){a.d(t,{T:function(){return i}});var r=a(40538),n=a(74600);let i=()=>{let e=(0,n.useRouter)(),t=(0,n.usePathname)(),a=(0,n.useSearchParams)();return{openMemeModal:n=>{let i=new URLSearchParams(a.toString());i.delete("deckId"),i.delete("memeIndex");let o=encodeURIComponent(n.replace("meme:",""));i.set("memeId",o);let l=(0,r.wS)(t,i);e.push(l,{scroll:!1})}}}},74491:function(e,t,a){a.r(t),a.d(t,{FeedProvider:function(){return o},useFeed:function(){return l}});var r=a(59547),n=a(30912);let i=(0,n.createContext)(void 0),o=e=>{let{children:t}=e,[a,o]=(0,n.useState)([]),[l,s]=(0,n.useState)(!1),[c,u]=(0,n.useState)({}),[d,f]=(0,n.useState)(""),[p,m]=(0,n.useState)([]),[v,h]=(0,n.useState)(!1),[_,y]=(0,n.useState)(""),[g,w]=(0,n.useState)([]),[b,k]=(0,n.useState)(!1),[S,C]=(0,n.useState)([]),[x,D]=(0,n.useState)(!1),[M,I]=(0,n.useState)([]),[P,F]=(0,n.useState)(!1),j=(0,n.useCallback)(e=>a.find(t=>(t.post_type,t.post.id===e))||g.find(t=>t.id===e)||M.find(t=>t.id===e)||S.find(t=>t.id===e),[a,g,M,S]),T=(0,n.useCallback)((e,t,r,n)=>{let i=a.findIndex(e=>e.post.id===t),l=g.findIndex(e=>e.id===t),s=S.findIndex(e=>e.id===t),c=M.findIndex(e=>e.id===t);if(-1===i&&-1===l&&-1===s&&-1===c)return;let u=(t,a)=>{let i={...a[t]};return"add"===r?(i.reactions.push({react:n,by:e,id:":irrelevant:"+Math.random(),avatar:":irrelevant:"+Math.random(),handle:":irrelevant:"+Math.random(),name:":irrelevant:"+Math.random()}),i.reactions=i.reactions.filter(t=>t.by!==e||t.react!==("upvote"===n?"downvote":"upvote"))):i.reactions=i.reactions.filter(t=>t.by!==e),[...a.slice(0,t),i,...a.slice(t+1)]};-1!==i&&o(e=>u(i,e)),-1!==l&&w(e=>u(l,e)),-1!==s&&C(e=>u(s,e)),-1!==c&&I(e=>u(c,e))},[a,g,M,S]),U=(0,n.useCallback)((e,t)=>{o(a=>0===a.length?a:[...e.map(e=>({id:Math.random().toString(36).substring(2,15),post_type:"meme",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},reactions:[],votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()})),...a])},[]),E=(0,n.useCallback)((e,t)=>{o(a=>0===a.length?a:a.map(a=>{if("meme"in a&&a.post.id===e){let e=a.post;return{...a,post:{...e,...t}}}return a}))},[]),A=(0,n.useCallback)((e,t)=>{o(a=>0===a.length?a:[{id:Math.random().toString(36).substring(2,15),post_type:"deck",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,memes:Object.values(e.memes).map(e=>({...e,is_public:!0})),is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},reactions:[],votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()},...a])},[]),R=(0,n.useCallback)(e=>{o(t=>t.filter(t=>t.post.id!==e))},[]),L=(0,n.useCallback)(e=>{g.length>0&&w(t=>[e,...t]),S.length>0&&C(t=>[e,...t])},[g.length,S.length]);return(0,r.jsx)(i.Provider,{value:{feed:a,setFeed:o,hasFetchedFeed:l,setHasFetchedFeed:s,feedActions:c,setFeedActions:u,appendMemesToFeed:U,appendDeckToFeed:A,removeItemFromFeed:R,updateMemeInFeed:E,searchQuery:d,setSearchQuery:f,searchResults:p,setSearchResults:m,hasFetchedSearchResults:v,setHasFetchedSearchResults:h,librarySearchQuery:_,setLibrarySearchQuery:y,library:g,setLibrary:w,hasFetchedLibrary:b,setHasFetchedLibrary:k,uploads:S,setUploads:C,hasFetchedUploads:x,setHasFetchedUploads:D,saved:M,setSaved:I,hasFetchedSaved:P,setHasFetchedSaved:F,onUploadMeme:L,getItem:j,voteOnItem:T},children:t})},l=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useFeed must be used within a FeedProvider");return e}},47177:function(e,t,a){a.r(t),a.d(t,{UploadProvider:function(){return _},useUpload:function(){return y}});var r=a(59547),n=a(71904),i=a(30912);let o=e=>{let t=new FileReader;return new Promise((a,r)=>{t.onload=e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.result;if(!n){r(Error("Failed to read file"));return}a(new Uint8Array(n))},t.onerror=()=>r(t.error),t.readAsArrayBuffer(e)})};var l=a(82972);let s=e=>{let{text:t,textButton:a,onClick:n}=e;return(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t,a&&n&&(0,r.jsx)(l.A,{variant:"solid",color:"success",size:"sm",className:"text-white-400",onClick:n,children:a})]})};var c=a(58741),u=a(56582),d=a(74600),f=a(74491),p=a(1463),m=a(39992),v=a(13296);let h=(0,i.createContext)({}),_=e=>{let{children:t}=e,a=(0,d.useRouter)(),{openMemeModal:l}=(0,v.T)(),{isPostingMemes:_,setIsHovering:y}=(0,u.O)(),{onUploadMeme:g}=(0,f.useFeed)(),[w,b]=(0,i.useState)([]),[k,S]=(0,i.useState)(),[C,x]=(0,i.useState)(!1),D=(0,i.useCallback)(async(e,t)=>{try{let a=e.name.slice(0,20),i=(0,n.yv)("Uploading ".concat(a),{variant:"info",persist:!0});S(i);let c=await o(e),u="";if(void 0!==t){let a=await p.P.postDeckSubmission({deckId:t,filename:(0,m.Df)(e.name),filetype:e.type,bytes:c});if(!a)throw Error("Failed to upload");u=a.meme_id}else{let t=await p.P.postMeme({filename:(0,m.Df)(e.name),filetype:e.type,bytes:c});if(!t)throw Error("Failed to upload");u=t.id,b(e=>[t,...e]),g(t)}(0,n.sy)(k),S(void 0);let d=(0,n.yv)((0,r.jsx)(s,{text:"Successfully uploaded",textButton:"View",onClick:()=>{(0,n.sy)(d),l(u)}}),{variant:"success",autoHideDuration:3e3})}catch(e){console.error(e),(0,n.yv)("Failed to upload some files",{variant:"error"})}},[k,l,g,b]),M=(0,i.useCallback)(async e=>{try{let t=(0,m.Df)(e),a=t.slice(0,20),i=(0,n.yv)("Uploading ".concat(a),{variant:"info",persist:!0});S(i);let o=await p.P.postMeme({filename:t,filetype:"image",source_url:e});if(!o)throw Error("Failed to paste link");b(e=>[o,...e]),g(o),(0,n.sy)(k),S(void 0);let c=(0,n.yv)((0,r.jsx)(s,{text:"Successfully pasted link",textButton:"View",onClick:()=>{(0,n.sy)(c),l(o.id)}}),{variant:"success",autoHideDuration:3e3})}catch(e){console.error(e),(0,n.yv)("Failed to paste link",{variant:"error"})}},[k,l,g]),I=(0,i.useMemo)(()=>(0,c.k)(D,1e3),[D]),P=(0,i.useCallback)(async(e,t)=>{if(void 0===k){if(e.size>33554432){(0,n.yv)("Please upload files 32MB or less",{variant:"error"});return}return I(e,t)}},[I,k]),F=(0,i.useCallback)(async e=>{if(e.clipboardData){let t=e.clipboardData.items;for(let e=0;e<t.length;e++){let a=t[e];if(a.type.includes("image")){let e=a.getAsFile();e&&await P(e)}}}},[P]);(0,i.useEffect)(()=>(window.addEventListener("paste",F),()=>{window.removeEventListener("paste",F)}),[F]);let j=async e=>{if(!(e.dataTransfer.items.length>0)||!e.dataTransfer.items[0].type.includes("image"))return!1;e.preventDefault(),y(!1),x(!0);let t=e.dataTransfer.files;try{for(let e=0;e<t.length;e++){let a=t[e];a.type.includes("image")&&await P(a)}_||a.push("/library")}catch(e){console.error(e)}finally{x(!1)}};return(0,r.jsx)(h.Provider,{value:{uploads:w,setUploads:b,startUpload:P,pasteImageLink:M,isBatchUploading:C},children:(0,r.jsx)("div",{className:"flex min-h-0 w-full min-w-0 flex-1",onDragOver:e=>{e.preventDefault(),e.dataTransfer.items.length>0&&e.dataTransfer.items[0].type.includes("image")&&y(!0)},onDragLeave:()=>y(!1),onDrop:j,children:t})})},y=()=>(0,i.useContext)(h)},58741:function(e,t,a){a.d(t,{k:function(){return r}});let r=(e,t)=>{let a=null;return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return new Promise((r,i)=>{let o=async()=>{a&&clearTimeout(a);try{let t=await e(...n);r(t)}catch(e){i(e)}a=null};a&&clearTimeout(a),a=setTimeout(o,t)})}}},39992:function(e,t,a){a.d(t,{Df:function(){return n},Po:function(){return r},RL:function(){return o},eh:function(){return i}});let r=e=>{let t=new Date(e/1e6),a=Math.round((new Date().getTime()-t.getTime())/1e3),r=Math.round(a/60),n=Math.round(r/60),i=Math.round(n/24);return a<60?"".concat(a,"s ago"):r<60?"".concat(r,"m ago"):n<24?"".concat(n,"h ago"):"".concat(i," day").concat(1===i?"":"s"," ago")},n=e=>e.replace(/[^a-z0-9]/gi,"_").toLowerCase();function i(e){let t=atob(e.split(",")[1]||e),a=Array(t.length);for(let e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return new Uint8Array(a)}let o="image/*,.jpg_large,.png_large,.jpeg_large,.jpg_small,.png_small,.jpeg_small"},40538:function(e,t,a){a.d(t,{Mm:function(){return i},bb:function(){return r},s9:function(){return n},wS:function(){return o}});let r=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"view",a=encodeURIComponent(e.id.replace("deck:",""));return"view"===t?"?deckId=".concat(a):"/deck/edit/".concat(a)},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"view",a=encodeURIComponent(e.id.replace("deck:",""));return"view"===t?"?deckId=".concat(a):"/deck/edit/".concat(a)},i=(e,t)=>{let a=encodeURIComponent(e.replace("deck:",""));return"?deckId=".concat(a,"&memeIndex=").concat(t)};function o(e,t){return t.toString().length?"".concat(e,"?").concat(t.toString()):e}}}]);