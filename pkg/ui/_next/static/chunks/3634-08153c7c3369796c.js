"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3634],{65511:function(e,t,a){a.d(t,{R:function(){return r}});var l=a(91104),n=a(63137);let i=e=>{let t=new Image;return t.src=e,t.complete},r=e=>{let{src:t,alt:a,width:r,height:o,draggable:s=!0,style:c,noAnimation:d,prefetch:u=!1,initialLoader:m=!1,className:h}=e,[f,x]=(0,n.useState)(!m),p=(0,n.useRef)(null);return(0,n.useEffect)(()=>{if(t&&u&&!i(t)){let e=new Image;e.src=t,e.onload=()=>{x(!0)}}},[t,u]),(0,n.useEffect)(()=>{t&&p.current&&p.current.complete&&x(!0)},[p,t]),(0,l.jsxs)("div",{className:"relative flex size-full max-h-full min-h-0 flex-col justify-center",children:[!f&&(0,l.jsx)("div",{className:"absolute left-0 top-0 size-full animate-pulse"}),(0,l.jsx)("img",{ref:p,style:c,src:t,alt:a,width:r,height:o,draggable:s,className:"flex max-h-full min-h-0 select-none ".concat(d?"":"transition-opacity duration-300"," ").concat(f?"opacity-100":"opacity-0","  ").concat(h),onLoad:()=>x(!0)})]})}},23640:function(e,t,a){a.d(t,{O:function(){return i}});var l=a(91104),n=a(83301);let i=e=>{let{src:t,alt:a,id:i,margin:r="m-2",w:o="w-3.5",onClick:s}=e;return(0,l.jsx)("button",{id:i,className:"flex size-9 items-center justify-center rounded-full hover:bg-black-100 ".concat(r),onClick:s,children:(0,l.jsx)(n.default,{priority:!0,src:t,alt:a,className:"opacity-85 ".concat(o)})})}},95928:function(e,t,a){a.d(t,{I:function(){return d}});var l=a(91104),n=a(63137),i=a(74926),r=a(57826),o=a(82833),s=a(49566),c=a(60402);let d=e=>{let{itemId:t,initialVotes:a={up:[],down:[]},userId:d,size:u="sm",border:m="",addVoteApi:h,removeVoteApi:f,onClick:x}=e,{getItem:p,voteOnItem:g}=(0,c.useFeed)(),w=(0,n.useMemo)(()=>p(t),[p,t]),v=(0,n.useMemo)(()=>w?w.votes:a,[a,w]),b=(0,n.useMemo)(()=>v.up,[v.up,v.up.length]),y=(0,n.useMemo)(()=>v.down,[v.down,v.down.length]),j=(0,n.useMemo)(()=>b.length-y.length,[b,y]),N=(0,n.useMemo)(()=>b.some(e=>e.by===d),[b,b.length,d]),k=(0,n.useMemo)(()=>y.some(e=>e.by===d),[y,y.length,d]);return(0,l.jsxs)(i.g,{size:u,children:[(0,l.jsxs)(r.A,{isIconOnly:0===j,onClick:e=>{if(e.stopPropagation(),e.preventDefault(),x){x();return}N?(f(t,"upvote"),g(d,t,"remove","upvote")):(h(t,"upvote"),g(d,t,"add","upvote"))},className:"".concat(N?"bg-blue-600":""," ").concat(m," border-r-1"),variant:"ghost",color:N?"primary":"default",children:[(0,l.jsx)(s.JO,{icon:"majesticons:arrow-up",width:20,color:"white"}),0!==j&&(0,l.jsx)(o.E.div,{initial:{opacity:0,y:j<0?10:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:0,transition:{duration:.1}},transition:{duration:.2},children:(0,l.jsx)("span",{className:"text-base font-semibold text-white-400",children:j})},j)]}),(0,l.jsx)(r.A,{isIconOnly:!0,onClick:e=>{if(e.stopPropagation(),e.preventDefault(),x){x();return}k?(f(t,"downvote"),g(d,t,"remove","downvote")):(h(t,"downvote"),g(d,t,"add","downvote"))},className:"".concat(k?"bg-warning-400":""," ").concat(m," border-l-1"),variant:"ghost",color:k?"warning":"default",children:(0,l.jsx)(s.JO,{icon:"majesticons:arrow-down",color:k?"black":"white",width:20})})]})}},21612:function(e,t,a){a.d(t,{g:function(){return o}});var l=a(91104),n=a(83301),i=a(63137),r=a(11563);let o=e=>{let{type:t,src:a,topText:o,bottomText:s,centerText:c,id:d="image-canvas",imageWidth:u=1024,imageHeight:m=1024,canvasWidth:h=1024,canvasHeight:f=1024,alt:x="Generated Image",progress:p=100,className:g=""}=e,w=(0,i.useRef)(new Image),v=(0,i.useRef)(null),b=(0,i.useMemo)(()=>p&&p<100&&p>0,[p]);return(0,i.useEffect)(()=>{let e=w.current,l=v.current;if(l){if(!a&&!c){(0,r.el)({image:e,canvas:l,topText:null,bottomText:null,centerText:null,canvasWidth:1024,canvasHeight:1024,imageWidth:1024,imageHeight:1024});return}"generated"===t||"faceswap"===t?(e.onload=()=>{(0,r.el)({image:e,canvas:l,topText:o,bottomText:s,centerText:null,canvasWidth:h,canvasHeight:f,imageWidth:u,imageHeight:m})},e.src=a):"text"===t&&(e.height=m,e.width=u,(0,r.el)({image:e,canvas:l,topText:null,bottomText:null,centerText:c,canvasWidth:h,canvasHeight:f,imageWidth:u,imageHeight:m}))}},[s,f,h,c,m,u,a,o,t]),(0,l.jsx)("div",{id:d,className:"size-full transition-all flex items-center justify-center",children:b?(0,l.jsx)(n.default,{draggable:!1,priority:!0,src:a,alt:x,style:{borderRadius:"0px",filter:p<100?"blur(".concat(70/p,"px)"):"none",transition:"filter 0.5s"},className:"transition-all object-cover w-[".concat(u,"px] h-[").concat(m,"px] ").concat(g),width:u,height:m}):(0,l.jsx)("canvas",{ref:v,className:"w-full max-h-full object-cover ".concat(g)})})}},63234:function(e,t,a){a.d(t,{B5:function(){return o},HS:function(){return r},W$:function(){return d},WN:function(){return c},_j:function(){return i},e5:function(){return s},vO:function(){return u}});var l=a(49242),n=a(98644);let i={[l.W.One]:1,[l.W.TwoHorizontal]:2,[l.W.TwoVertical]:2,[l.W.Four]:4},r={[l.W.One]:"grid-rows-1 h-fit w-fit",[l.W.TwoHorizontal]:"grid-cols-2 w-full h-fit",[l.W.TwoVertical]:"grid-rows-2 w-fit h-full",[l.W.Four]:"grid-cols-2 grid-rows-2"},o={[l.W.One]:1,[l.W.TwoHorizontal]:.75,[l.W.TwoVertical]:1024/768,[l.W.Four]:1},s={[n.tB.Square]:[1024,1024],[n.tB.Landscape]:[1024,768],[n.tB.Portrait]:[768,1024]},c={[l.W.One]:"h-auto w-fit",[l.W.TwoHorizontal]:"w-full h-fit",[l.W.TwoVertical]:"w-fit h-full",[l.W.Four]:"h-auto w-fit"},d={[l.W.One]:n.tB.Square,[l.W.TwoHorizontal]:n.tB.Portrait,[l.W.TwoVertical]:n.tB.Landscape,[l.W.Four]:n.tB.Square},u=(e,t)=>10>Math.abs(e-t)?n.tB.Square:e>t?n.tB.Landscape:n.tB.Portrait},48751:function(e,t,a){a.r(t),a.d(t,{AppHistoryProvider:function(){return s},useAppHistory:function(){return c}});var l=a(91104),n=a(26816),i=a(36623),r=a(63137);let o=(0,r.createContext)({}),s=e=>{let{children:t}=e,a=(0,n.usePathname)(),s=(0,n.useRouter)(),[c,d]=(0,r.useState)([]),u=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/home",t=arguments.length>1?arguments[1]:void 0;console.log("goBack",{defaultRoute:e,ignoreRouteBase:t});let a=e;c.length>1&&(a=c[c.length-2],void 0!==t&&a.includes(t)&&(a=e)),"string"!=typeof a&&(a="/home"),s.push(a,{scroll:!1})},[c,s]);return(0,r.useEffect)(()=>{d(e=>e[e.length-1]!==a?[...e,a]:e)},[a]),(0,l.jsxs)(o.Provider,{value:{goBack:u},children:[t,(0,l.jsx)(i.wT,{dense:!0,maxSnack:3})]})},c=()=>(0,r.useContext)(o)},4104:function(e,t,a){a.r(t),a.d(t,{MemeModalProvider:function(){return eo},useMemeModal:function(){return es}});var l=a(91104),n=a(33968),i=a(63137);let r=()=>{(0,i.useEffect)(()=>{if(window.innerWidth>1024){let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>document.body.style.overflow=e}{let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>document.body.style.overflow=e}},[])};var o=a(26816),s=a(83301),c=a(30027),d=a(4180);let u=e=>{let{handle:t,avatar:a,name:n,lastUpdated:i}=e;return(0,l.jsxs)("div",{className:"flex items-center gap-3",children:[(0,l.jsx)(c.default,{href:"/u/".concat(t),children:(0,l.jsx)(s.default,{src:null!=a?a:"https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png",alt:null!=t?t:"Anonymous",width:48,height:48,className:"size-10 rounded-full bg-black-300"})}),(0,l.jsxs)("div",{className:"flex flex-1 flex-col justify-center",children:[(0,l.jsx)(c.default,{href:"/u/".concat(t),children:(0,l.jsx)("h2",{className:"text-sm font-bold",children:null!=n?n:"Anonymous"})}),(0,l.jsxs)("h3",{className:"text-xs font-medium text-white-400/75",children:["Updated ",(0,d.Po)(i)]})]})]})};var m=a(9698),h=a(57826),f=a(49566);let x=e=>{let{id:t,saveFn:a=n.P.saveMeme,isSaved:r,variant:o="flat"}=e,[s,c]=(0,i.useState)(r),d=()=>{c(!s),a(t,s).catch(()=>{c(s)})};return(0,l.jsx)(m.e,{content:"Save to library",placement:"bottom",motionProps:{variants:{exit:{opacity:0,transition:{duration:.1,ease:"easeIn"}},enter:{opacity:1,transition:{duration:.15,ease:"easeOut"}}}},children:(0,l.jsx)(h.A,{isIconOnly:!0,size:"md",radius:"full",variant:"ghost",onClick:e=>{e.stopPropagation(),e.preventDefault(),d()},children:(0,l.jsx)(f.JO,{icon:s?"material-symbols:bookmark":"material-symbols:bookmark-outline",width:20})})})},p=e=>{let{children:t}=e;return(0,l.jsx)("aside",{id:"modal-aside",className:"flex sm:min-w-96 max-w-full flex-1 flex-col gap-3 border-l border-white-400/10 bg-black-400 p-3 md:min-h-full md:max-w-96 md:flex-none xs:h-auto",children:t})};var g=a(95928),w=a(41116),v=a(80562),b=a(49882),y=a(65511),j=a(18159);let N=e=>{let{tags:t,wrap:a="flex-wrap",onClickTag:n}=e;return(0,l.jsx)("div",{className:"flex gap-2 ".concat(a),children:t.map((e,t)=>(0,l.jsx)(c.default,{href:"/explore?query=".concat(e),onClick:()=>null==n?void 0:n(e),children:(0,l.jsx)(j.z,{variant:"flat",children:e.replace("tag:","")})},"tag-".concat(e,"-").concat(t)))})},k=e=>{let{meme:t}=e;return(0,l.jsxs)(v.d,{itemClasses:{subtitle:"text-sm text-white-400/50",trigger:"text-base font-semibold",indicator:"text-lg",content:"pt-0 text-small"},variant:"shadow",selectionMode:"multiple",defaultSelectedKeys:["2","3","4"],children:[t.template_data?(0,l.jsx)(b.G,{"aria-label":t.template_data.title,startContent:(0,l.jsx)(y.R,{className:"size-12 rounded-md object-cover",src:t.template_data.image_url,alt:t.template_data.title}),subtitle:t.template_data.title,classNames:{title:"font-base text-sm text-white-400/50",subtitle:"text-large font-semibold text-white-400",content:"pb-4 pt-0"},title:"Meme Template",children:(0,l.jsx)("p",{className:"text-sm",children:t.template_data.about})},"1"):(0,l.jsx)(b.G,{hideIndicator:!0,isDisabled:!0,title:"Meme template","aria-label":"No template detected",subtitle:"No template detected"},"1"),t.extracted_text?(0,l.jsx)(b.G,{title:"Extracted text",classNames:{base:"pb-2 pt-0",trigger:"pt-4 pb-2 text-base font-semibold",content:"pb-2 pt-0"},children:(0,l.jsx)("p",{className:"text-sm",children:t.extracted_text})},"2"):(0,l.jsx)(b.G,{title:"Extracted text",classNames:{base:"pb-2 pt-0",trigger:"pt-4 pb-2 text-base font-semibold",content:"pb-2 pt-0"},subtitle:"No text was extracted","aria-label":"No extracted text",hideIndicator:!0,isDisabled:!0},"2"),t.tags.length>0?(0,l.jsx)(b.G,{classNames:{content:"pb-4 pt-0"},title:"Keywords (".concat(t.tags.length,")"),children:(0,l.jsx)(N,{tags:t.tags.map(e=>{let{name:t}=e;return t})})},"3"):(0,l.jsx)(b.G,{hideIndicator:!0,isDisabled:!0,title:"Tags","aria-label":"No tags added",subtitle:"No tags added"},"3")]})};var C=a(70127),W=a(54197),_=a(75161),P=a(21818);let T=e=>{let{prompt:t}=e;if(!t)return null;let a=t.styler.replace("ai_image_style:",""),n=t.character.replace("ai_character:","");return(0,l.jsxs)(C.w,{classNames:{base:"pb-1"},children:[(0,l.jsx)(W.u,{className:"text-lg font-semibold pb-1",children:"Generation Details"}),(0,l.jsxs)(_.G,{className:"gap-6",children:[(0,l.jsx)(S,{title:"Positive Prompt",content:t.user_positive_prompt}),(0,l.jsx)(S,{title:"Negative Prompt",content:t.user_negative_prompt}),(0,l.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,l.jsx)(S,{title:"Style",content:a,hideCopyButton:!0}),(0,l.jsx)(S,{title:"Character",content:n,hideCopyButton:!0}),(0,l.jsx)(S,{title:"Aspect Ratio",content:t.aspect_ratio,hideCopyButton:!0}),(0,l.jsx)(S,{title:"Seed",content:t.seed.toString()}),(0,l.jsx)(S,{title:"CFG Scale",content:t.cfg_scale.toString(),hideCopyButton:!0})]})]})]})},S=e=>{let{title:t="",content:a="",hideCopyButton:n=!1}=e;return(0,l.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,l.jsx)("p",{className:"text-xs text-white-400/50 font-medium",children:t}),(0,l.jsx)(P.Z,{hideSymbol:!0,hideCopyButton:n||!a,classNames:{base:"bg-[#27292C] min-h-[44px]",pre:"whitespace-pre-wrap max-w-full"},children:a||(0,l.jsx)("span",{className:"text-white-400/50 select-none",children:"N/A"})})]})},I=e=>{let{meme:t}=e;if("generated"==t.source)return(0,l.jsx)(T,{prompt:t.prompt});if("composed"==t.source){var a,n;let e=Object.values(null!==(n=t.panels)&&void 0!==n?n:{}).find(e=>"meme"in e.panel_config);return e?(0,l.jsx)(T,{prompt:null===(a=e.panel_config)||void 0===a?void 0:a.prompt}):null}return(0,l.jsx)(k,{meme:t})};var A=a(56399),H=a(411),M=a(41340),z=a(28563),O={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/plus.63a0d87f.svg",height:24,width:24,blurWidth:0,blurHeight:0},R=a(29125);let E=[],B=(0,R.k)(n.P.searchTags,1e3),F=e=>{let{tagId:t,tagName:a,minW:n="min-w-36",variant:r,onUpdateTag:o,onDeleteTag:c,onClick:d}=e,u=(0,i.useRef)(null),[m,h]=(0,i.useState)(a),[f,x]=(0,i.useState)(t),[p,g]=(0,i.useState)([]),[w,v]=(0,i.useState)(!1),[b,y]=(0,i.useState)(!1),j=async e=>{v(!0);let t=await B(e);t&&(g(t),v(!1))},N=e=>{if(e!==a)return v(!1),y(!1),g([]),null==o?void 0:o(e)},k=async()=>{g([]),v(!1),y(!0),await (null==c?void 0:c()),y(!1),h("")};return(0,l.jsx)(H.d,{ref:u,allowsCustomValue:!0,defaultInputValue:"",inputValue:m,defaultSelectedKey:"",selectedKey:f,defaultItems:E,items:p,maxLength:20,isLoading:w,isDisabled:b,className:"inline-flex w-auto max-w-0 ".concat(n),color:"default",variant:r,radius:"full",onBlur:()=>N(m),onInputChange:e=>{null!==e&&(h(e),""===e?g([]):e.length>2&&j(e))},onSelectionChange:e=>{x(e);let t=p.find(t=>t.id===e);t&&(g([]),h(t.name),N(t.name))},placeholder:"Add tag","aria-label":"Add tag",disableSelectorIconRotation:!0,selectorIcon:m.length>0?(0,l.jsx)(s.default,{src:z.Z,className:"w-2.5 opacity-75",alt:"Clear tag"}):(0,l.jsx)(s.default,{src:O,className:"w-3 opacity-75",alt:"Add tag"}),isClearable:!1,selectorButtonProps:{disableRipple:!0,onClick:()=>{m.length>0&&k()}},onKeyDown:e=>{var t,a;"Escape"===e.key?null===(t=u.current)||void 0===t||t.blur():"Enter"===e.key&&0===p.length&&(null===(a=u.current)||void 0===a||a.blur())},onClick:d,children:e=>(0,l.jsx)(M.R,{value:e.id,children:e.name},e.id)})},D=(0,R.k)(n.P.tagResource,1e3),V=e=>{let{memeId:t,tags:a,onUpdateTags:i}=e,r=a.length<10?[...a,{id:"",name:""}]:a,o=async e=>{i(a.filter(t=>t.id!==e));try{await n.P.untagResource(t,e)}catch(e){i(a)}},s=async(e,l)=>{let r=l.toLowerCase().replaceAll(" ","_").replaceAll("-","_"),o=[...a];o[e]={id:r,name:l},i(o);try{var s;await D(t,l),(null===(s=a[e])||void 0===s?void 0:s.id)&&await n.P.untagResource(t,a[e].id)}catch(e){i(a)}};return(0,l.jsx)("div",{className:"flex mb-3 gap-2 overflow-x-auto scrollbar-hide",children:r.map((e,t)=>(0,l.jsx)(F,{tagId:e.id,tagName:e.name,minW:"min-w-[124px]",variant:"faded",onUpdateTag:e=>s(t,e),onDeleteTag:()=>o(e.id)},"tag-pill-".concat(e.id,"-").concat(t)))})};var L={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/info.333102d7.svg",height:24,width:24,blurWidth:0,blurHeight:0};let G=(0,R.k)(n.P.updateMeme,1e3),U=e=>{var t;let{meme:a,setMeme:n,onTogglePublish:r}=e,o=(0,i.useCallback)(async e=>{a&&n({...a,tags:e})},[a,n]),c=(0,i.useCallback)(async e=>{if(a){n({...a,extracted_text:e});try{await G(a.id,{extracted_text:e})}catch(e){n(a)}}},[a,n]);return a?(0,l.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,l.jsx)(A.Y,{label:(0,l.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,l.jsx)("h3",{className:"text-lg font-semibold",children:"Extracted text"}),(0,l.jsx)(m.e,{placement:"bottom",content:(0,l.jsx)("div",{className:"w-52",children:"This is AI extracted text from the meme image. You can correct it if needed here."}),children:(0,l.jsx)(s.default,{src:L,width:19,height:19,alt:"Info"})})]}),placeholder:"This is AI extracted text from the meme image. You can correct it if needed here.",classNames:{base:"p-0 hover:outline-1 border-transparent",mainWrapper:"p-0",inputWrapper:"px-0 py-4 gap-2 bg-content1 hover:bg-content2",label:"flex px-4 text-lg !text-white-400 font-semibold",innerWrapper:"px-4",input:"text-white-400/50"},value:null!==(t=a.extracted_text)&&void 0!==t?t:"",onValueChange:c}),(0,l.jsxs)(C.w,{children:[(0,l.jsx)("header",{className:"p-4",children:(0,l.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,l.jsx)("h3",{className:"text-base font-semibold",children:"Keywords"}),(0,l.jsx)(m.e,{placement:"bottom",content:(0,l.jsx)("div",{className:"w-52",children:"The right set of keywords can help others find your meme."}),children:(0,l.jsx)(s.default,{src:L,width:16,height:16,alt:"Info"})})]})}),(0,l.jsx)(_.G,{className:"p-4 pt-0",children:(0,l.jsx)(V,{memeId:a.id,tags:a.tags,onUpdateTags:o})})]})]}):null};var q=a(60402),J=a(36623);let K=e=>{let{memeId:t,onClose:a}=e,{feed:r,setFeed:o,searchResults:s,setSearchResults:c,library:d,setLibrary:u,uploads:x,setUploads:p,saved:g,setSaved:w}=(0,q.useFeed)(),[v,b]=(0,i.useState)(!1);return(0,l.jsx)(m.e,{content:"Delete",placement:"bottom",motionProps:{variants:{exit:{opacity:0,transition:{duration:.1,ease:"easeIn"}},enter:{opacity:1,transition:{duration:.15,ease:"easeOut"}}}},children:(0,l.jsx)(h.A,{isIconOnly:!0,size:"md",radius:"full",variant:"ghost",color:"danger",isLoading:v,onClick:()=>{b(!0),n.P.deleteMeme(t).then(()=>{o(r.filter(e=>"meme"!==e.post_type||e.post.id!==t)),c(s.filter(e=>e.id!==t)),u(d.filter(e=>e.id!==t)),p(x.filter(e=>e.id!==t)),w(g.filter(e=>e.id!==t)),a(),(0,J.yv)("Meme deleted",{variant:"success",autoHideDuration:2e3})}).catch(()=>{b(!1),(0,J.yv)("Failed to delete meme",{variant:"error",autoHideDuration:2e3})})},children:(0,l.jsx)(f.JO,{icon:"fluent:delete-24-regular",width:18})})})};var Y=a(61281),Z=a(49242);let X=e=>{var t,a;let{meme:r,setMeme:c,onClose:d}=e,m=(0,o.useRouter)(),{profile:f}=(0,w.useProfile)(),{removeItemFromFeed:v,appendMemesToFeed:b}=(0,q.useFeed)(),[y,j]=(0,i.useState)(!1),[N,k]=(0,i.useState)(!1),[C,W]=(0,i.useState)(!1),_=(0,i.useMemo)(()=>{var e;return Number(null==r?void 0:null===(e=r.posts)||void 0===e?void 0:e.length)>0},[r]),P=(0,i.useCallback)(async(e,t)=>{let a=new Date().getTime(),l={...e,published_at:a,is_public:!0};c(l),b([l],t),await n.P.publishMeme(e.id)||(c(e),v(l.id))},[b,v,c]),T=(0,i.useCallback)(async(e,t)=>{let a={...e,published_at:null,is_public:!1};c(a),v(a.id),await n.P.unpublishMeme(e.id)||(c(e),b([a],t))},[b,v,c]),S=(0,i.useCallback)(e=>{r&&f&&(e?P(r,f):T(r,f))},[r,f,P,T]),A=(0,i.useCallback)(async()=>{r&&(k(!0),await n.P.createPost({post_type:{meme:r.id}}),k(!1),f&&(b([r],f),m.push("/home")))},[b,r,f,m]),H=(0,i.useCallback)(async()=>{var e;if(!r)return;let t=null===(e=r.posts)||void 0===e?void 0:e[0];t&&(W(!0),await n.P.deletePost(t),W(!1),v(r.id),m.push("/home"))},[v,r,m]),M=(0,i.useCallback)(()=>{r&&m.push("/studio?remix=".concat(r.id))},[r,m]);return(0,l.jsx)(p,{children:r&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)("header",{className:"my-2 flex flex-col gap-5",children:(0,l.jsx)(u,{handle:r.creator_handle,name:r.creator_name,avatar:r.creator_avatar,lastUpdated:r.updated_at||r.published_at||r.created_at})}),y?(0,l.jsx)(U,{meme:r,setMeme:c,onTogglePublish:S}):(0,l.jsx)(I,{meme:r}),(0,l.jsxs)("footer",{className:"flex justify-between gap-2 md:gap-3",children:[y?_?(0,l.jsx)(h.A,{variant:"solid",color:"danger",isLoading:C,onClick:H,children:"Unpublish"}):(0,l.jsx)(K,{memeId:r.id,onClose:d}):(0,l.jsxs)("div",{className:"flex flex-1 gap-2 md:gap-3",children:[(0,l.jsx)(g.I,{size:"md",itemId:r.id,initialVotes:r.votes,userId:null!==(t=null==f?void 0:f.user.id)&&void 0!==t?t:"",addVoteApi:n.P.createMemeReaction,removeVoteApi:n.P.deleteMemeReaction}),(0,l.jsx)(x,{id:r.id,isSaved:null!==(a=r.is_saved)&&void 0!==a&&a})]}),r.is_creator&&y&&(0,l.jsx)(h.A,{variant:"solid",color:"primary",onClick:()=>j(!1),children:"Done"}),r.is_creator&&!y&&(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(h.A,{variant:"solid",onClick:()=>j(!0),children:"Edit"}),!_&&(0,l.jsx)(h.A,{variant:"solid",color:"primary",isLoading:N,onClick:A,children:"Post"})]}),r.source&&Z.F.includes(r.source)&&!y&&_&&(0,l.jsx)(h.A,{variant:"solid",color:"primary",startContent:(0,l.jsx)(s.default,{src:Y.Z,alt:"Remix",className:"size-4"}),onClick:M,children:"Remix"})]})]})})};var $=a(23640),Q=a(48751);let ee=e=>{let{maxWidth:t="max-w-4xl",children:a}=e,{goBack:n}=(0,Q.useAppHistory)();return(0,l.jsxs)("main",{className:"relative flex max-h-full flex-1 flex-col bg-black-400 md:min-h-full md:overflow-hidden md:bg-transparent lg:overflow-hidden",children:[(0,l.jsx)($.O,{src:z.Z,alt:"Close",onClick:n}),(0,l.jsx)("div",{className:"relative flex min-h-0 min-w-0 max-w-full flex-1 items-center justify-center md:m-3",children:(0,l.jsx)("div",{className:"relative flex size-full max-h-full min-h-0 min-w-0 items-center justify-center ".concat(t),children:a})})]})};var et=a(21612);let ea=e=>{var t,a,n,i,r,o,c,d,u,m;let{meme:h}=e;return(0,l.jsx)(ee,{children:(0,l.jsx)("div",{className:"flex size-full max-h-full min-h-0 flex-row items-center justify-center gap-3 overflow-hidden px-0 lg:gap-6 lg:p-3",children:h&&(0,l.jsx)("div",{className:"w-full max-w-full min-h-0 max-h-full lg:w-[".concat(h.width,"px] lg:h-[").concat(h.height,"px] lg:rounded-xl border-1 border-white-400/5 bg-black-400 overflow-hidden"),children:"generated"===h.source?(0,l.jsx)(et.g,{id:"meme-lightbox-image",type:h.source,imageWidth:null!==(n=h.width)&&void 0!==n?n:1024,imageHeight:null!==(i=h.height)&&void 0!==i?i:1024,canvasWidth:null!==(r=h.width)&&void 0!==r?r:1024,canvasHeight:null!==(o=h.height)&&void 0!==o?o:1024,src:h.url,alt:h.caption,topText:null!==(c=null===(t=h.text_overlay)||void 0===t?void 0:t.top_text)&&void 0!==c?c:null,bottomText:null!==(d=null===(a=h.text_overlay)||void 0===a?void 0:a.bottom_text)&&void 0!==d?d:null,centerText:null,className:"max-h-canvas"}):(0,l.jsx)("div",{id:"meme-lightbox-image",className:"size-full flex items-center justify-center",children:(0,l.jsx)(s.default,{style:{aspectRatio:"".concat(h.width,"/").concat(h.height)},width:null!==(u=h.width)&&void 0!==u?u:1024,height:null!==(m=h.height)&&void 0!==m?m:1024,src:h.url,alt:h.caption,className:"size-full object-contain max-h-canvas"})})})})})},el=e=>{let{memeId:t,onClose:a}=e;r();let[o,s]=(0,i.useState)(null);return(0,i.useEffect)(()=>{let e=decodeURIComponent(t);n.P.getMeme(e).then(e=>{if(!e)return a();s(e)})},[t,a]),(0,i.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[a]),(0,l.jsx)("div",{className:"fixed inset-0 z-50 flex size-full items-center justify-center bg-black-400/90 sm:overflow-y-auto md:overflow-hidden xs:overflow-y-auto",onClick:e=>{let t=e.target;t.closest("#modal-aside")||t.closest("#meme-lightbox-image")||a()},onDragOver:e=>(e.preventDefault(),e.stopPropagation(),!1),children:(0,l.jsxs)("div",{className:"flex size-full flex-1 flex-col sm:overflow-y-auto md:flex-row",children:[(0,l.jsx)(ea,{meme:o}),(0,l.jsx)(X,{meme:o,setMeme:s,onClose:a})]})})};var en=a(98127),ei=a(17412);let er=(0,i.createContext)({}),eo=e=>{var t;let{children:a}=e,n=(0,o.useRouter)(),i=(0,o.usePathname)(),r=(0,o.useSearchParams)(),s=decodeURIComponent(null!==(t=r.get("memeId"))&&void 0!==t?t:""),c=new URLSearchParams(r.toString()),{openMemeModal:d}=(0,en.T)(),u=()=>{c.delete("memeId");let e=(0,ei.wS)(i,c);n.push(e,{scroll:!1})};return(0,l.jsxs)(er.Provider,{value:{onOpenMeme:d,onCloseMeme:u},children:[a,s&&(0,l.jsx)(el,{memeId:s,onClose:u})]})},es=()=>(0,i.useContext)(er)},49242:function(e,t,a){var l,n;a.d(t,{F:function(){return i},W:function(){return l}});let i=["generated","composed"];(n=l||(l={})).One="one",n.TwoVertical="two-vertical",n.TwoHorizontal="two-horizontal",n.Four="four-square"},98644:function(e,t,a){var l,n;function i(e){return"library"===e?"generated":e}function r(e){switch(e){case"composed":case"upload":return"generated";default:return e}}a.d(t,{JY:function(){return i},fJ:function(){return r},tB:function(){return l}}),(n=l||(l={})).Square="square",n.Landscape="landscape",n.Portrait="portrait"},11563:function(e,t,a){a.d(t,{jt:function(){return g},el:function(){return f},mr:function(){return p}});var l=a(49242),n=a(53433);async function i(e){return await new Promise((t,a)=>{e.toBlob(e=>{if(!e){a(Error("Failed to create blob"));return}let l=new FileReader;l.onload=()=>{let e=l.result;t(new Uint8Array(e))},l.readAsArrayBuffer(e)},"image/jpeg")})}async function r(e){return new Promise((t,a)=>{let l=new Image;l.crossOrigin="Anonymous",l.src="/memedeck:memedeck:meme-deck.os/_next/static/media/logo.650a12fc.png";let n=e.canvas.width,i=e.canvas.height,r=32;n>1024&&i>1024?r=64:(n>1024||i>1024)&&(r=48),l.onload=()=>{let a=n-r-10,o=i-r-10;e.save(),e.globalAlpha=.4,e.drawImage(l,a,o,r,r),e.restore(),t()},l.onerror=e=>{a(e)}})}var o=a(59458);let s="bold ".concat(80,"px Impact");function c(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];e.font=s,e.fillStyle=t?"white":"black",e.strokeStyle=t?"black":"white",e.lineWidth=3,e.lineJoin="round",e.textAlign="center",(0,o.Dt)()&&(e.shadowColor=t?"black":"white",e.shadowBlur=6,e.shadowOffsetX=0,e.shadowOffsetY=0)}async function d(e){let{ctx:t,content:a,placement:l,x:n,y:i,maxWidth:r}=e;return new Promise(e=>{for(var s=a.split(" "),c="",d=[],u=0;u<s.length;u++){var m=c+s[u]+" ";t.measureText(m).width>r&&u>0?(d.push({text:c,y:i}),c=s[u]+" ",i+=100):c=m}if(d.push({text:c.trim(),y:i}),"bottom"===l){let e=100*d.length;d=d.map(t=>({text:t.text,y:t.y-e+100}))}if("center"===l){let e=100*d.length;d=d.map(t=>({text:t.text,y:t.y-e/2+50}))}d.forEach(e=>{(0,o.Dt)()?(t.strokeText(e.text,n,e.y),t.fillText(e.text,n,e.y)):(t.fillText(e.text,n,e.y),t.strokeText(e.text,n,e.y))}),e()})}var u=a(67303);async function m(e){let{ctx:t,url:a,x:l,y:n,panelWidth:i,panelHeight:r}=e,o=new Image;o.crossOrigin="Anonymous",o.src=a,await new Promise((e,t)=>{o.onload=e,o.onerror=t}),await (0,u.h)({ctx:t,image:o,targetWidth:i,targetHeight:r,imageWidth:o.width,imageHeight:o.height,anchorX:l,anchorY:n})}var h=a(63234);async function f(e){let{image:t,canvas:a,topText:l,bottomText:n,centerText:i,canvasWidth:r,canvasHeight:o,imageWidth:s,imageHeight:m}=e,h=a.getContext("2d");if(!h||(t.width=s,t.height=m,a.width=r,a.height=o,i?(h.fillStyle="white",h.fillRect(0,0,a.width,a.height)):await (0,u.h)({ctx:h,image:t,targetWidth:r,targetHeight:o,imageWidth:s,imageHeight:m}),!l&&!n&&!i))return;c(h,!i);let f=a.width-40,x=a.width/2,p=a.height/2,g=a.height-64;l&&await d({ctx:h,content:l,placement:"top",x,y:120,maxWidth:f}),i&&await d({ctx:h,content:i,placement:"center",x,y:p,maxWidth:f}),n&&await d({ctx:h,content:n,placement:"bottom",x,y:g,maxWidth:f})}async function x(e,t,a,l,n){return new Promise(i=>{e.fillStyle="black",e.fillRect(t,a,l,n),i()})}async function p(e){let{canvas:t,studioPanels:a,studioLayout:i}=e,o=t.getContext("2d");if(!o)throw Error("Failed to create canvas context");if(!a[0])throw Error("Failed to find first panel");let{canvasWidth:s,canvasHeight:u}=(0,n.G)(i,a[0]),{panelWidth:f,panelHeight:p}=(0,n.H)(i,s,u);t.width=s,t.height=u;let g=a.map(e=>"generated"===e.type||"faceswap"===e.type?e:null).filter(Boolean),w=a.map(e=>"text"===e.type?e:null).filter(Boolean);for(let e=0;e<Math.min(h._j[i],g.length+w.length);e++){let t=g.find(t=>t.idx===e),a=w.find(t=>t.idx===e),n=0,r=0;if(i===l.W.TwoHorizontal?(n=e%2==0?0:f,r=0):i===l.W.TwoVertical?(n=0,r=e%2==0?0:p):i===l.W.Four&&(n=e%2==0?0:f,r=e<2?0:p),t&&t.image.src)try{await m({ctx:o,url:t.image.src,x:n,y:r,panelWidth:f,panelHeight:p}),c(o);let e=t.image.topText,a=t.image.bottomText,l=f-40,i=n+f/2,s=r+120,u=r+p-64;e&&await d({ctx:o,content:e,placement:"top",x:i,y:s,maxWidth:l}),a&&await d({ctx:o,content:a,placement:"bottom",x:i,y:u,maxWidth:l})}catch(e){console.error("Failed to load image from meme source",e)}else if(a){o.fillStyle="white",o.fillRect(n,r,f,p),c(o,!1);let e=f-40,t=n+f/2,l=r+p/2;await d({ctx:o,content:a.text.text,placement:"center",x:t,y:l,maxWidth:e})}}i===l.W.TwoHorizontal?await x(o,f,0,10,u):i===l.W.TwoVertical?await x(o,0,p,s,10):i===l.W.Four&&(await x(o,f,0,10,u),await x(o,0,p,s,10)),await r(o)}async function g(e,t){let a=document.createElement("canvas");return await p({canvas:a,studioPanels:e,studioLayout:t}),i(a)}},53433:function(e,t,a){a.d(t,{G:function(){return i},H:function(){return r}});var l=a(63234),n=a(49242);function i(e,t){let a=0,l=0;if(e===n.W.One){if("faceswap"===t.type){if(!t.faceswap.baseWidth||!t.faceswap.baseHeight)throw Error("Failed to find faceswap dimensions");a=t.faceswap.baseWidth,l=t.faceswap.baseHeight}else a=t.image.width,l=t.image.height}else if(e===n.W.TwoVertical)a=1024,l=1536;else if(e===n.W.TwoHorizontal)a=1536,l=1024;else if(e===n.W.Four)a=2048,l=2048;else throw Error("Unsupported panel layout");return{canvasWidth:a,canvasHeight:l}}function r(e,t,a){let i=0,r=0;if(e===n.W.One){let e=(0,l.vO)(t,a),n=l.e5[e];i=n[0],r=n[1]}else if(e===n.W.TwoVertical)i=1024,r=768;else if(e===n.W.TwoHorizontal)i=768,r=1024;else if(e===n.W.Four)i=1024,r=1024;else throw Error("Unsupported panel layout");return{panelWidth:i,panelHeight:r}}},67303:function(e,t,a){a.d(t,{h:function(){return l}});async function l(e){let{ctx:t,image:a,targetWidth:l,targetHeight:n,imageWidth:i,imageHeight:r,anchorX:o=0,anchorY:s=0}=e;return new Promise(e=>{let c=Math.max(l/i,n/r),d=i*c,u=r*c;t.save(),t.beginPath(),t.rect(o,s,l,n),t.clip(),t.drawImage(a,o+(l-d)/2,s+(n-u)/2,d,u),t.restore(),e()})}},61281:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/magic.8c74570a.svg",height:18,width:18,blurWidth:0,blurHeight:0}}}]);