(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9650],{36399:function(e,t,l){Promise.resolve().then(l.bind(l,36665))},36665:function(e,t,l){"use strict";l.r(t),l.d(t,{default:function(){return ep}});var a=l(59547),r=l(30912),s=l(56582),i=l(60044);let n=()=>i.cm?"wss://staging-api.memedeck.xyz/v1/generation/ws":i.BB||i.j7?"wss://api.memedeck.xyz/v1/generation/ws":"ws://127.0.0.1:8080/v1/generation/ws";class o{async getConfig(){return fetch("".concat(o.BASE_URL,"/generation/config")).then(e=>e.json())}async getRandomPrompt(){return fetch("".concat(o.BASE_URL,"/generation/prompt")).then(e=>e.json())}}o.BASE_URL=i.cm?"https://staging-api.memedeck.xyz/v1":i.BB||i.j7?"https://api.memedeck.xyz/v1":"http://127.0.0.1:8080/v1";let c=new o,d=()=>{let[e,t]=(0,r.useState)(null),[l,a]=(0,r.useState)(null),{profile:i}=(0,s.O)(),o=(0,r.useCallback)(()=>{if(!i)return;let e=new WebSocket("".concat(n(),"/").concat(i.user.id));return e.onopen=()=>{console.log("Connected to server")},e.onclose=()=>{console.log("Disconnected from server"),setTimeout(()=>{console.warn("we were disconnected, trying to reconnect"),o()},2e3)},t(e),e},[i]);return(0,r.useEffect)(()=>{c.getConfig().then(a)},[]),(0,r.useEffect)(()=>{let e=o();return()=>{e&&e.close()}},[o]),{socket:e,config:l}};var u=l(15361),m=l(93037),x=l(54024),p=l(82972),h=l(80437),f=l(7502),g=l(93078),b=l(7692),w=l(69919),v=l(62350),y=l(89204),j=l(92519),_=l(81926),k=l(54897),N=l(74948),C=l(74653),S=l(41917),A=l(6987),z=l(41175),D=l(54939),P=l(99854),E=l(40123),T=l(94925);let O={base:(0,T.cn)("inline-flex flex-col m-0 p-2 max-w-[100%] items-center justify-center","w-full cursor-pointer rounded-lg 3 !border-medium border-default-100","data-[selected=true]:border-primary bg-black-300 hover:border-white-400/10"),label:"inline-flex flex-col items-center",labelWrapper:"m-0 gap-1 min-w-0 max-w-full",description:"truncate text-center text-white-400/90 max-w-full",wrapper:"hidden"};var R=l(67887);let I=e=>{let{character:t}=e;return"normal"===t.id?(0,a.jsx)("div",{className:"min-h-full size-[62px] lg:size-[80px] flex items-center justify-center",children:(0,a.jsx)(g.JO,{icon:"ph:empty",className:"text-white-400/75",width:"32"})}):(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(R.h,{src:t.avatar,alt:t.name,size:"lg",radius:"none",classNames:{base:"min-w-full min-h-full w-[62px] h-[62px] lg:w-[80px] lg:h-[80px]",img:"object-cover size-full",name:"hidden"}})})},M=()=>(0,a.jsx)("div",{className:"absolute inset-0 min-h-full size-full",style:{background:"hsl(var(--nextui-primary) / var(--nextui-primary-opacity, 0.25))"}}),L=e=>{let{style:t,characters:l,selectedCharacterId:s,setSelectedCharacter:i}=e,n=l.map(e=>({...e,avatar:function(e,t){if("normal"===t)return;let l=e.replace(/[_\s]/g,"-"),a=t.replace(/[_\s]/g,"-");return"https://memedeckblob.blob.core.windows.net/ai-characters/".concat(l,"-").concat(a,".png")}(null!=t?t:"",e.id)})),o=(0,r.useCallback)(e=>{let t=l.find(t=>t.id===e);t&&i(t)},[l,i]);return(0,a.jsx)(N.X,{classNames:{wrapper:"grid grid-cols-4 gap-2",label:"text-white-400 font-medium text-small"},defaultValue:s,label:"Character",orientation:"horizontal",value:s,onValueChange:e=>o(e),children:n.sort((e,t)=>"normal"===e.id?1:"normal"===t.id?-1:0).map(e=>{let t=s===e.id;return(0,a.jsxs)(C.J,{classNames:{base:(0,T.cn)("m-0 p-0 min-w-full max-w-full overflow-hidden","cursor-pointer rounded-lg 3 !border-medium border-default-100","data-[selected=true]:border-primary bg-black-400 hover:border-white-400/10"),label:"min-w-full max-w-full",labelWrapper:"m-0 gap-1 min-w-full max-w-full items-center",wrapper:"hidden"},value:e.id,children:[(0,a.jsx)(I,{character:e}),t&&(0,a.jsx)(M,{})]},e.id)})})},J=e=>{let{topText:t,bottomText:l,isGenerateDisabled:r,setTopText:s,setBottomText:i,onClickGenerate:n}=e;return(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)(P.Y,{classNames:{input:"placeholder:text-white-400/25",inputWrapper:"!bg-black-400 rounded-lg"},fullWidth:!0,label:"Top text",placeholder:"Add top text",value:t,onValueChange:s,maxLength:120,onKeyDown:e=>{"Enter"!==e.key||r||(e.preventDefault(),n())}},"desktop-top-text-overlay"),(0,a.jsx)(P.Y,{classNames:{input:"placeholder:text-white-400/25",inputWrapper:"!bg-black-400 rounded-lg"},fullWidth:!0,label:"Bottom text",placeholder:"Add bottom text",value:l,onValueChange:i,maxLength:120,onKeyDown:e=>{"Enter"!==e.key||r||(e.preventDefault(),n())}},"desktop-bottom-text-overlay")]})};var W=l(1463),F=l(74491);function U(){return Math.floor(1e12*Math.random())}let G=(0,r.createContext)({}),V=e=>{let{profile:t,socket:l,config:s,children:i}=e,{appendMemesToFeed:n}=(0,F.useFeed)(),o=(0,r.useMemo)(()=>({posPrompt:"",negPrompt:"",isExpandedPrompt:!1,seed:U(),seedType:"random",topText:"",bottomText:"",guidanceScale:2.7,selectedAspectRatio:"landscape",selectedCharacter:s.characters[0],selectedStyler:s.stylers[0]}),[s.characters,s.stylers]),[d,u]=(0,r.useState)(""),[m,x]=(0,r.useState)(""),[p,h]=(0,r.useState)(!1),[f,g]=(0,r.useState)(U()),[b,w]=(0,r.useState)("random"),[v,y]=(0,r.useState)(""),[j,_]=(0,r.useState)(""),[k,N]=(0,r.useState)(2.7),[C,S]=(0,r.useState)(s.characters[0]),[A,z]=(0,r.useState)(s.stylers[0]),[D,P]=(0,r.useState)("landscape"),[E,T]=(0,r.useState)(),[O,R]=(0,r.useState)(),[I,M]=(0,r.useState)(0),[L,J]=(0,r.useState)([]),[V,B]=(0,r.useState)(!1),[H,Z]=(0,r.useState)(!1),[Y,q]=(0,r.useState)(!1),[K,Q]=(0,r.useState)(!1),[X,$]=(0,r.useState)(!1),[ee,et]=(0,r.useState)(!1),el=(0,r.useCallback)(()=>{u(o.posPrompt),x(o.negPrompt),h(o.isExpandedPrompt),g(o.seed),w(o.seedType),y(o.topText),_(o.bottomText),N(o.guidanceScale),P(o.selectedAspectRatio),S(o.selectedCharacter),z(o.selectedStyler)},[o]),ea=(0,r.useCallback)(async()=>{Z(!0);let e=await c.getRandomPrompt();u(e.user_positive_prompt),x(e.user_negative_prompt),g(U()),w("random"),y(""),_(""),N(e.cfg_scale),P(e.aspect_ratio);let t=s.characters.find(t=>t.id===e.character.replace("ai_character:",""));S(null!=t?t:o.selectedCharacter);let l=s.stylers.find(t=>t.id===e.styler.replace("ai_image_style:",""));z(null!=l?l:o.selectedStyler),Z(!1)},[s.characters,s.stylers,o.selectedCharacter,o.selectedStyler]),er=(0,r.useCallback)(()=>{h(e=>(localStorage.setItem("isExpandedPrompt",JSON.stringify(!e)),!e))},[]),es=(0,r.useCallback)(function(e){var t,l,a,r;let i=!(arguments.length>1)||void 0===arguments[1]||arguments[1];if(T(e),R(e.url),!i)return;let n=e.text_overlay;n&&(y(null!==(t=n.top_text)&&void 0!==t?t:""),_(null!==(l=n.bottom_text)&&void 0!==l?l:""));let o=e.prompt;if(o){u(null!==(a=o.user_positive_prompt)&&void 0!==a?a:""),x(null!==(r=o.user_negative_prompt)&&void 0!==r?r:""),N(o.cfg_scale),P(o.aspect_ratio);let e=s.characters.find(e=>e.id===o.character.replace("ai_character:",""));S(null!=e?e:s.characters[0]);let t=s.stylers.find(e=>e.id===o.styler.replace("ai_image_style:",""));z(null!=t?t:s.stylers[0])}},[s.characters,s.stylers]),ei=(0,r.useCallback)(async()=>{M(0),E&&(Q(!0),await W.P.deleteMeme(E.id),J(e=>{let t=e.findIndex(e=>e.id===E.id);return -1===t?e:(e[t+1]?es(e[t+1]):e[t-1]&&es(e[t-1]),[...e.slice(0,t),...e.slice(t+1)])}),Q(!1))},[E,es]),en=(0,r.useCallback)(()=>{let e={workflow:p?"prompt_expansion":"basic",quality:"fast",user_id:t.user.id,positive_prompt:d||"",negative_prompt:m||"",seed:f||0,top_text:v||"",bottom_text:j||"",aspect_ratio:D,character:(null==C?void 0:C.id)?{id:null==C?void 0:C.id,strength_model:1}:null,styler:(null==A?void 0:A.id)?{id:null==A?void 0:A.id,strength_model:1}:null,cfg_scale:k};console.log("Generating image with data:",e),B(!0),R(void 0),l.send(JSON.stringify({kind:"generate_image",data:e}))},[j,k,p,m,d,t.user.id,f,D,null==C?void 0:C.id,null==A?void 0:A.id,l,v]),eo=(0,r.useCallback)(async()=>{if(O)try{if($(!0),!E)throw Error("Failed to post meme");let e=E;if(v||j){let l={top_text:v,bottom_text:j,top_text_size:"md",bottom_text_size:"md",additional_config:null};await W.P.postMemeTextOverlay(E.id,l),e={...E,text_overlay:{...l,by:t.user.id,created_at:1e6*Date.now(),updated_at:1e6*Date.now()}}}await W.P.createPost({post_type:{meme:E.id}}),T(e),n([e],t),et(!0)}catch(e){console.error("Failed to post meme:",e)}finally{$(!1)}},[O,E,v,j,n,t]);return(0,r.useEffect)(()=>{l.onmessage=e=>{if("image_generating"===(e=JSON.parse(e.data)).type||"image_generating"===e.kind){let t=e.data,l=new Uint8Array(t),a=new Blob([l],{type:"image/jpeg"}),r=new FileReader;r.onloadend=()=>{R(r.result),M(e.progress)},r.readAsDataURL(a)}else if("meme_created"===e.type){let l=e.data,a=new Uint8Array(l),r=new Blob([a],{type:"image/jpeg"}),s=new FileReader;s.onloadend=()=>{let l=s.result;R(l);let a={top_text:v,bottom_text:j,top_text_size:"md",bottom_text_size:"md",additional_config:null};(v||j)&&W.P.postMemeTextOverlay(e.id,a);let r={id:e.id,url:l,prompt:{...e.prompt_config,styler:e.prompt_config.styler.id,character:e.prompt_config.character.id,user_positive_prompt:e.prompt_config.positive_prompt,user_negative_prompt:e.prompt_config.negative_prompt},text_overlay:{...a,by:t.user.id,created_at:1e6*Date.now(),updated_at:1e6*Date.now()},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()};M(100),B(!1),"random"===b&&g(U()),J(e=>[r,...e]),es(r,!1)},s.readAsDataURL(r)}}},[j,es,t.user.id,b,l,v]),(0,r.useEffect)(()=>{W.P.getLibrary({is_generated:!0,start:0,limit:10}).then(e=>{let t=e.filter(e=>e.is_creator);J(t),es(t[0])})},[es]),(0,r.useEffect)(()=>{let e=localStorage.getItem("isExpandedPrompt");e&&h(JSON.parse(e))},[]),(0,a.jsx)(G.Provider,{value:{config:s,posPrompt:d,negPrompt:m,isExpandedPrompt:p,seed:f,seedType:b,topText:v,bottomText:j,guidanceScale:k,selectedAspectRatio:D,selectedCharacter:C,selectedStyler:A,isGenerating:V,isRandomizing:H,isHistoryOpen:Y,isDeleting:K,isPosting:X,isPostModalOpen:ee,history:L,srcPreview:O,progress:I,meme:E,setPosPrompt:u,setNegPrompt:x,toggleIsExpandedPrompt:er,setSeed:g,setSeedType:w,setTopText:y,setBottomText:_,setGuidanceScale:N,setSelectedAspectRatio:P,setSelectedCharacter:S,setSelectedStyler:z,setHistory:J,setIsHistoryOpen:q,setIsPostModalOpen:et,setSrcPreview:R,setMeme:T,onClickResetPromptSettings:el,onClickRandomPrompt:ea,onClickHistory:es,onClickClear:ei,onClickGenerate:en,onClickPost:eo},children:i})},B=()=>(0,r.useContext)(G),H=e=>{let{isDisabled:t}=e,{posPrompt:l,setPosPrompt:r,onClickGenerate:s}=B();return(0,a.jsx)(E.Y,{classNames:{input:"placeholder:text-white-400/25"},fullWidth:!0,label:"Prompt",endContent:(0,a.jsx)(p.A,{isIconOnly:!0,isDisabled:!l,style:{display:l?"flex":"none"},size:"sm",radius:"full",variant:"light",className:"absolute top-1 right-1",onClick:()=>r(""),children:(0,a.jsx)(g.JO,{icon:"ic:baseline-clear",width:16,className:"text-white-400"})}),autoFocus:!0,isMultiline:!0,isRequired:!0,placeholder:"Describe the meme you want to generate",value:l,onValueChange:r,onKeyDown:e=>{"Enter"!==e.key||t||(e.preventDefault(),s())}},"desktop-prompt")},Z={square:"icon-park-twotone:square-small",landscape:"icon-park-twotone:rectangle-small",portrait:"icon-park-twotone:rectangle-small"},Y=e=>{let{isMobile:t}=e,{config:l,posPrompt:s,negPrompt:i,seed:n,seedType:o,topText:c,bottomText:d,guidanceScale:u,selectedAspectRatio:m,selectedCharacter:x,selectedStyler:h,isGenerating:f,isRandomizing:b,isExpandedPrompt:w,setNegPrompt:v,toggleIsExpandedPrompt:y,setSeed:T,setSeedType:R,setTopText:I,setBottomText:M,setGuidanceScale:W,setSelectedAspectRatio:F,setSelectedCharacter:G,setSelectedStyler:V,onClickRandomPrompt:Y,onClickResetPromptSettings:q,onClickGenerate:K}=B(),Q=!s||!x||!h,X=(0,r.useCallback)(e=>{let t=l.stylers.find(t=>t.id===e);t&&V(t)},[l.stylers,V]);return(0,a.jsxs)("div",{className:"flex flex-1 flex-col gap-4 w-full",children:[(0,a.jsx)(j.g,{"aria-label":"styler selector",label:"Style",placeholder:"No additional styler",selectedKeys:h?[h.id]:[],size:"md",onChange:e=>X(e.target.value),children:l.stylers.map(e=>(0,a.jsx)(_.R,{className:"flex flex-row items-center gap-2",children:e.name},e.id))}),(0,a.jsx)(L,{style:null==h?void 0:h.id,characters:l.characters,selectedCharacterId:null==x?void 0:x.id,setSelectedCharacter:G}),!t&&(0,a.jsx)(H,{isDisabled:Q}),(0,a.jsx)("div",{className:"flex flex-row gap-2 justify-start",children:(0,a.jsx)(k.i,{color:"warning",classNames:{thumb:"bg-white-400",label:"text-white-400/60"},onValueChange:y,isSelected:w,size:"sm",children:"Expand details in your prompt with AI."})}),(0,a.jsx)(N.X,{classNames:{wrapper:"flex-nowrap gap-2",label:"text-white-400 font-medium text-small"},defaultValue:"square",label:"Aspect Ratio",orientation:"horizontal",value:m,onValueChange:e=>F(e),children:l.quality&&Object.entries(l.quality.quality).sort((e,t)=>{let[l]=e,[a]=t;return l.localeCompare(a)}).map(e=>{let[t]=e;return(0,a.jsxs)(C.J,{classNames:O,value:t,children:[(0,a.jsx)("div",{className:"w-full flex justify-center",children:(0,a.jsx)(g.JO,{icon:Z[t],className:"portrait"===t?"rotate-90":"",width:40})}),(0,a.jsx)("p",{className:"text-sm text-white-400/90 text-center",children:t.charAt(0).toUpperCase()+t.slice(1)})]},t)})}),(0,a.jsxs)(S.d,{variant:"shadow",className:"border-default-200 dark:border-default-100",children:[(0,a.jsx)(A.G,{classNames:{title:"text-base",content:"pt-0 pb-4 flex flex-col gap-6"},"aria-label":"Text",title:"Text",subtitle:"Add text to your image",children:(0,a.jsx)(J,{topText:c,bottomText:d,isGenerateDisabled:Q,setTopText:I,setBottomText:M,onClickGenerate:K})},"1"),(0,a.jsxs)(A.G,{classNames:{title:"text-base",content:"pt-0 pb-4 flex flex-col gap-6"},"aria-label":"Advanced",title:"Advanced",children:[(0,a.jsxs)("div",{className:"flex flex-col gap-2 px-0",children:[(0,a.jsx)(z.L,{size:"md",step:.1,color:"foreground",label:(0,a.jsxs)("div",{className:"flex flex-row gap-1.5 items-center",children:[(0,a.jsxs)("p",{className:"text-white-400 font-medium text-small",children:["Guidance"," "]}),(0,a.jsx)("p",{className:"text-default-500 font-normal text-tiny",children:"(cfg_scale)"})]}),showSteps:!0,maxValue:3,minValue:1.5,value:u,onChange:e=>W(e),className:"max-w-md"}),(0,a.jsx)("p",{className:"text-default-500 font-normal text-small",children:"How close the AI follows the prompt, lower is more creative."})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsxs)("div",{className:"inline-flex flex-row gap-2 justify-between",children:[(0,a.jsx)("label",{className:"text-white-400 font-medium text-small",children:"Seed"}),(0,a.jsxs)(D.g,{children:[(0,a.jsx)(p.A,{size:"sm",className:"h-5 px-0",color:"warning",isDisabled:!0,variant:"fixed"===o?"solid":"bordered",onClick:()=>{R("fixed")},children:"Fixed"}),(0,a.jsx)(p.A,{size:"sm",className:"h-5 px-0",color:"warning",variant:"random"===o?"solid":"bordered",onClick:()=>{T(U()),R("random")},children:"Random"})]})]}),(0,a.jsx)(P.Y,{fullWidth:!0,type:"number",label:null,classNames:{input:"placeholder:text-white-400/30",inputWrapper:"!bg-black-400 rounded-lg"},value:n.toString(),onValueChange:e=>{let t=parseInt(e);isNaN(t)||T(t)}})]}),!t&&(0,a.jsx)(E.Y,{className:"px-0",classNames:{input:"placeholder:text-white-400/30",inputWrapper:"!bg-black-400 rounded-lg"},fullWidth:!0,label:"Negative prompt",labelPlacement:"outside",placeholder:"What do you want the image NOT to look like? E.g. no cats",value:i,onValueChange:v,onKeyDown:e=>{"Enter"!==e.key||Q||(e.preventDefault(),K())}},"desktop-negative-prompt")]},"2")]}),!t&&(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsxs)("div",{className:"flex gap-3",children:[(0,a.jsx)(p.A,{className:"flex-1 text-md h-12",variant:"solid",size:"md",startContent:(0,a.jsx)(g.JO,{icon:"ic:baseline-refresh",width:20}),onClick:q,children:(0,a.jsx)("h1",{children:"Reset"})},"desktop-clear"),(0,a.jsx)(p.A,{className:"flex-1 text-md h-12",variant:"solid",size:"md",startContent:(0,a.jsx)(g.JO,{icon:"ion:dice-sharp",width:20}),isLoading:b,onClick:Y,children:(0,a.jsx)("h1",{children:"Random"})},"desktop-lucky")]}),(0,a.jsx)(p.A,{fullWidth:!0,className:"text-lg h-12",variant:"shadow",color:"primary",size:"md",isLoading:f,isDisabled:Q,onClick:K,children:(0,a.jsx)("h1",{children:"Generate"})},"desktop-generate")]})]})};var q=l(94576),K=l(67002),Q=l(74078);let X=e=>{let{history:t,selectedImage:l,isHistoryOpen:r,onClickHistory:s}=e;return(0,a.jsx)(f.E.div,{className:"absolute inset-y-0 bg-black-0 hidden lg:flex",initial:{right:"-230px",width:"0px"},animate:{right:r?0:"-230px",width:"230px"},exit:{right:"-230px",width:"0px"},transition:{duration:.3,transitionProperty:"width"},children:(0,a.jsxs)("div",{className:"size-full flex-none flex-col gap-4 flex border-l-1 border-black-100 overflow-hidden",children:[(0,a.jsx)("p",{className:"mx-3 mt-3 text-white-400/80 text-sm",children:"History"}),0===t.length&&(0,a.jsx)("p",{className:"mx-3 text-white-400/50 text-sm",children:"No images generated yet"}),(0,a.jsx)("div",{className:"flex-1 min-h-0",children:(0,a.jsx)(q.ZP,{children:e=>{let{height:r,width:i}=e;return(0,a.jsx)(K.ZP,{rowHeight:160,rowCount:t.length,width:i,height:r,rowRenderer:e=>{var r,i,n,o;let{index:c,key:d,style:u}=e,m=t[c].id===(null==l?void 0:l.id);return(0,a.jsx)("div",{style:u,className:"min-h-40 max-h-40 px-3 pb-3 w-[230px] cursor-pointer",onClick:()=>s(t[c]),children:(0,a.jsx)("div",{className:"size-full relative bg-white-400/10 rounded-md border-2 overflow-hidden ".concat(m?"border-blue-500":"border-white-400/10"),children:(0,a.jsx)(Q.g,{src:t[c].url,topText:null!==(n=null===(r=t[c].text_overlay)||void 0===r?void 0:r.top_text)&&void 0!==n?n:null,bottomText:null!==(o=null===(i=t[c].text_overlay)||void 0===i?void 0:i.bottom_text)&&void 0!==o?o:null,alt:"Generated meme ".concat(t[c].id)})})},d)}})}})})]})})};var $=l(74600),ee=l(79886),et=l(29619),el=l(24449),ea=l(69208),er=l(33838),es=l(39992),ei=l(94663);let en=e=>{let{meme:t,base64Image:l,onCancel:r}=e,i=(0,$.useRouter)(),{profile:n}=(0,s.O)(),o=async()=>{if(!l)return;let e=(0,es.eh)(l);await navigator.clipboard.write([new ClipboardItem({"image/png":new Blob([e],{type:"image/png"})})]);let t=encodeURIComponent("ctrl+v to paste meme");window.open("https://twitter.com/intent/tweet?text=".concat(t),"_blank")};return(0,a.jsx)(ea.Z,{onClick:r,children:(0,a.jsxs)("form",{className:"relative flex w-full min-w-0 max-w-lg flex-col gap-3 rounded-xl bg-black-400 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,a.jsxs)("header",{className:"relative flex w-full items-center justify-between px-3 pt-3",children:[(0,a.jsx)("div",{className:"flex items-center",children:n&&(0,a.jsx)(et.z,{className:"cursor-pointer",name:"",onClick:()=>{i.push("/u/".concat(null==n?void 0:n.user.twitter_handle)),r()},avatarProps:{src:n.twitter_profile.profile_image_url_https,size:"sm"}})}),(0,a.jsx)(p.A,{isIconOnly:!0,className:"rounded-full",variant:"light",size:"sm",onClick:r,children:(0,a.jsx)(u.default,{src:w.Z,alt:"close",className:"w-3"})})]}),(0,a.jsx)("main",{className:"min-h-72 gap-7 flex flex-col items-center justify-center",children:t?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("h1",{className:"text-xl -mb-2",children:"Meme Posted to the Feed!"}),(0,a.jsx)(ee.default,{href:"/library?memeId=".concat(t.id),className:"size-40 z-40 rounded-md bg-black-100 object-contain",children:(0,a.jsx)(ei.k,{meme:t})}),(0,a.jsx)("div",{className:"flex gap-3 w-full justify-center",children:(0,a.jsxs)(p.A,{className:"flex items-center justify-center gap-2 rounded-2xl bg-blue-500 px-5 py-1 text-sm",onClick:o,children:[(0,a.jsx)(u.default,{src:er.Z,alt:"X",className:"w-5"}),(0,a.jsx)("p",{className:"text-lg",children:"Share"})]})})]}):(0,a.jsx)(el.c,{})}),(0,a.jsx)("footer",{className:"h-11"})]})})};var eo=l(50653),ec=l(88942),ed=l(91543);let eu=e=>{let{progress:t,isGenerating:l,base64:r,topText:s,bottomText:i}=e;return(0,a.jsx)(ec.w,{className:"bg-black-400 size-full rounded-2xl overflow-hidden transition-all",children:(0,a.jsxs)(eo.M,{children:[l&&!r&&(0,a.jsx)(f.E.div,{className:"size-full flex items-center justify-center backdrop-blur-lg ",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(ed.X,{className:"size-full opacity-50"})}),r&&(0,a.jsx)(f.E.div,{className:"size-full max-h-full flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,a.jsx)(Q.g,{src:r,progress:t,topText:s,bottomText:i})})]})})},em=e=>{let{posPrompt:t,topText:l,bottomText:r,selectedCharacter:s,selectedStyler:i,base64:n,progress:o,isGenerating:c,isDeleting:d,isPosting:u,setPosPrompt:m,onClickClear:x,onClickPost:h,onClickGenerate:f}=e,b=!t||!s||!i,w=!u&&Number(null==n?void 0:n.length)>0;return(0,a.jsxs)("div",{className:"flex flex-col size-full items-center transition-all",children:[(0,a.jsx)("div",{className:"size-full min-h-0 flex-1 overflow-hidden p-4 md:p-6 flex items-center justify-center",children:(0,a.jsx)(eu,{base64:n,progress:o,isGenerating:c,topText:l,bottomText:r})}),(0,a.jsxs)("footer",{className:"relative flex flex-col w-full items-center justify-center border-t border-white-400/10",children:[(n||c)&&(0,a.jsxs)("div",{className:"flex w-full gap-3 items-center justify-end border-b border-white-400/10 p-4 md:p-6",children:[(0,a.jsx)(p.A,{radius:"full",variant:"solid",color:"default",isDisabled:!w,isLoading:d,onClick:x,children:"Delete"}),(0,a.jsx)(p.A,{radius:"full",variant:"solid",color:"primary",isDisabled:!w,isLoading:u,onClick:h,children:"Post meme"})]}),(0,a.jsxs)("div",{className:"w-full border-black-100 gap-3 flex lg:hidden p-4 pb-12 md:p-6",children:[(0,a.jsx)(E.Y,{classNames:{base:"flex-1",input:"placeholder:text-white-400/25"},fullWidth:!0,label:"Prompt",isMultiline:!0,isRequired:!0,placeholder:"Describe the meme you want to generate",value:t,onValueChange:m,onKeyDown:e=>{"Enter"!==e.key||b||(e.preventDefault(),f())}},"mobile-prompt"),(0,a.jsx)(p.A,{isIconOnly:!0,className:"text-md",variant:"solid",color:"primary",radius:"full",isLoading:c,isDisabled:b,onClick:f,children:(0,a.jsx)(g.JO,{icon:"ic:baseline-send",width:24})},"mobile-generate")]})]})]})},ex=()=>{let{goBack:e}=(0,y.useAppHistory)(),{posPrompt:t,topText:l,bottomText:r,selectedCharacter:s,selectedStyler:i,isGenerating:n,srcPreview:o,progress:c,history:d,meme:j,isPosting:_,isPostModalOpen:k,isHistoryOpen:N,isDeleting:C,setIsHistoryOpen:S,setPosPrompt:A,onClickGenerate:z,onClickHistory:D,onClickClear:P,onClickPost:E,setIsPostModalOpen:T}=B();return(0,a.jsxs)("div",{className:"fixed z-50 flex flex-col items-center justify-between h-screen overflow-y-auto bg-black-0 inset-x-0 min-h-screen max-h-screen t-0",children:[(0,a.jsx)("header",{className:"flex w-full flex-col justify-center gap-4 min-h-16 max-h-16 px-3 lg:flex-row lg:justify-between border-b-1 border-black-100",children:(0,a.jsxs)("div",{className:"flex flex-row w-full items-center gap-2 justify-between",children:[(0,a.jsxs)("div",{className:"flex flex-row items-center text-large font-medium select-none",children:[(0,a.jsx)(v.O,{src:w.Z,alt:"Close",margin:"m-0 mr-1",onClick:e}),(0,a.jsx)(u.default,{priority:!0,src:b.Z,alt:"Meme Deck",className:"hidden h-10 w-auto lg:block mr-1",draggable:!1}),(0,a.jsx)("h1",{className:"text-stone-300 text-xl",children:"Studio"})]}),(0,a.jsxs)("div",{className:"flex flex-row items-center gap-3",children:[(0,a.jsxs)(m.j,{children:[(0,a.jsx)(x.b,{children:(0,a.jsx)(p.A,{isIconOnly:!0,className:"flex lg:hidden",radius:"full",size:"sm",variant:"flat",children:(0,a.jsx)(g.JO,{icon:"solar:menu-dots-bold",width:24})})}),(0,a.jsx)(h.g,{className:"fle-col flex max-h-[50vh] w-[320px] justify-start gap-3 overflow-scroll p-4",children:(0,a.jsx)(Y,{isMobile:!0})})]}),(0,a.jsx)(p.A,{radius:"full",variant:"light",className:"hidden lg:flex",isIconOnly:!0,onClick:()=>S(e=>!e),children:(0,a.jsx)(g.JO,{icon:"ic:round-history",width:24,className:"text-white-400/75"})})]})]})}),(0,a.jsxs)("main",{className:"flex flex-row size-full min-h-0 overflow-hidden",children:[(0,a.jsx)("div",{className:"hidden p-3 w-96 max-h-full min-h-0 overflow-y-auto flex-none flex-col gap-4 lg:flex border-r-1 border-black-100",children:(0,a.jsx)(Y,{})}),(0,a.jsxs)(f.E.div,{className:"relative flex flex-row flex-1",children:[(0,a.jsx)(f.E.div,{initial:{width:"100%"},animate:{width:N?"calc(100% - 230px)":"100%"},exit:{width:"100%"},transition:{duration:.3,transitionProperty:"width"},className:"min-w-full lg:min-w-0",children:(0,a.jsx)(em,{posPrompt:t,topText:l,bottomText:r,selectedCharacter:s,selectedStyler:i,base64:o,progress:c,isGenerating:n,isDeleting:C,isPosting:_,setPosPrompt:A,onClickClear:P,onClickPost:E,onClickGenerate:z})}),(0,a.jsx)(X,{history:d,selectedImage:j,isHistoryOpen:N,onClickHistory:D})]}),k&&(0,a.jsx)(en,{meme:j,base64Image:o,onCancel:()=>T(!1)})]})]})};function ep(){let{profile:e}=(0,s.O)(),{socket:t,config:l}=d();return e&&t&&l&&window.localStorage?(0,a.jsx)(V,{profile:e,socket:t,config:l,children:(0,a.jsx)(ex,{})}):null}},94663:function(e,t,l){"use strict";l.d(t,{k:function(){return i}});var a=l(59547),r=l(15361),s=l(74078);let i=e=>{var t,l,i,n,o;let{meme:c}=e;return(0,a.jsxs)("div",{className:"relative size-full select-none overflow-hidden rounded-xl bg-white-400/10",children:[(0,a.jsx)(r.default,{className:"absolute z-0 inset-0 object-cover blur-lg scale-110 size-full",src:c.url,alt:"Meme blur",width:400,height:400,loading:"eager"}),(0,a.jsx)(s.g,{src:c.url,alt:(null!==(i=c.tags)&&void 0!==i?i:["Meme"]).join(", "),topText:null!==(n=null===(t=c.text_overlay)||void 0===t?void 0:t.top_text)&&void 0!==n?n:null,bottomText:null!==(o=null===(l=c.text_overlay)||void 0===l?void 0:l.bottom_text)&&void 0!==o?o:null,width:640,height:640,className:"z-[1]"})]})}},62350:function(e,t,l){"use strict";l.d(t,{O:function(){return s}});var a=l(59547),r=l(15361);let s=e=>{let{src:t,alt:l,id:s,margin:i="m-2",onClick:n}=e;return(0,a.jsx)("button",{id:s,className:"flex size-9 items-center justify-center rounded-full hover:bg-black-100 ".concat(i),onClick:n,children:(0,a.jsx)(r.default,{priority:!0,src:t,alt:l,className:"w-3.5 opacity-85 xs:w-4"})})}},69208:function(e,t,l){"use strict";l.d(t,{Z:function(){return r}});var a=l(59547);let r=e=>{let{children:t,onClick:l}=e;return(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex size-full max-h-full min-h-0 items-start xs:items-center justify-center overflow-y-auto overflow-x-hidden bg-white-100 px-4 py-[10vh]",onClick:l,children:t})}},74078:function(e,t,l){"use strict";l.d(t,{g:function(){return u}});var a=l(59547),r=l(30912),s=l(15361),i=l(60044);let n="bold ".concat(80,"px Impact"),o="white",c="black";function d(e,t,l,a,r,s){for(var n=t.split(" "),d="",u=[],m=0;m<n.length;m++){var x=d+n[m]+" ";e.measureText(x).width>r&&m>0?(u.push({text:d,y:a}),d=n[m]+" ",a+=100):d=x}if(u.push({text:d.trim(),y:a}),"bottom"===s){let e=100*u.length;u=u.map(t=>({text:t.text,y:t.y-e+100}))}u.forEach(t=>{(0,i.Dt)()?(e.fillStyle=o,e.shadowColor=c,e.shadowBlur=6,e.shadowOffsetX=0,e.shadowOffsetY=0,e.strokeText(t.text,l,t.y),e.fillText(t.text,l,t.y)):(e.fillText(t.text,l,t.y),e.strokeText(t.text,l,t.y))})}let u=e=>{let{src:t,topText:l,bottomText:i,id:u="image-canvas",width:m=768,height:x=768,alt:p="Generated Image",progress:h=100,className:f=""}=e,g=(0,r.useRef)(new Image),b=(0,r.useRef)(null),w=null===l&&null===i;return(0,r.useEffect)(()=>{let e=g.current,a=b.current;a&&(e.onload=()=>{!function(e,t,l,a){let r=t.getContext("2d");if(!r||(t.width=e.width,t.height=e.height,r.drawImage(e,0,0),!l&&!a))return;r.font=n,r.fillStyle=o,r.strokeStyle=c,r.lineWidth=3,r.lineJoin="round",r.textAlign="center";let s=e.width-40,i=e.width/2,u=e.height-64;l&&d(r,l,i,120,s,"top"),a&&d(r,a,i,u,s,"bottom")}(e,a,l,i)},e.src=t)},[i,t,l]),(0,a.jsx)("div",{id:u,className:"size-full flex items-center justify-center",children:h&&h<100&&h>0||w?(0,a.jsx)(s.default,{draggable:!1,priority:!0,src:t,alt:p,style:{borderRadius:"0px",filter:h<100?"blur(".concat(100/h,"px)"):"none",transition:"filter 0.5s"},className:"transition-all object-contain rounded-2xl size-full ".concat(f),width:m,height:x}):(0,a.jsx)("canvas",{ref:b,className:"w-full max-h-full object-contain ".concat(f)})})}},89204:function(e,t,l){"use strict";l.r(t),l.d(t,{AppHistoryProvider:function(){return n},useAppHistory:function(){return o}});var a=l(59547),r=l(74600),s=l(30912);let i=(0,s.createContext)({}),n=e=>{let{children:t}=e,l=(0,r.usePathname)(),n=(0,r.useRouter)(),[o,c]=(0,s.useState)([]),d=(0,s.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/home",t=arguments.length>1?arguments[1]:void 0;console.log("goBack",{defaultRoute:e,ignoreRouteBase:t});let l=e;o.length>1&&(l=o[o.length-2],void 0!==t&&l.includes(t)&&(l=e)),"string"!=typeof l&&(l="/home"),n.push(l,{scroll:!1})},[o,n]);return(0,s.useEffect)(()=>{c(e=>e[e.length-1]!==l?[...e,l]:e)},[l]),(0,a.jsx)(i.Provider,{value:{goBack:d},children:t})},o=()=>(0,s.useContext)(i)},74491:function(e,t,l){"use strict";l.r(t),l.d(t,{FeedProvider:function(){return i},useFeed:function(){return n}});var a=l(59547),r=l(30912);let s=(0,r.createContext)(void 0),i=e=>{let{children:t}=e,[l,i]=(0,r.useState)([]),[n,o]=(0,r.useState)(!1),[c,d]=(0,r.useState)({}),[u,m]=(0,r.useState)(""),[x,p]=(0,r.useState)([]),[h,f]=(0,r.useState)(!1),[g,b]=(0,r.useState)(""),[w,v]=(0,r.useState)([]),[y,j]=(0,r.useState)(!1),[_,k]=(0,r.useState)([]),[N,C]=(0,r.useState)(!1),[S,A]=(0,r.useState)([]),[z,D]=(0,r.useState)(!1),P=(0,r.useCallback)(e=>l.find(t=>(t.post_type,t.post.id===e))||w.find(t=>t.id===e)||S.find(t=>t.id===e)||_.find(t=>t.id===e),[l,w,S,_]),E=(0,r.useCallback)((e,t,a,r)=>{let s=l.findIndex(e=>e.post.id===t),n=w.findIndex(e=>e.id===t),o=_.findIndex(e=>e.id===t),c=S.findIndex(e=>e.id===t);if(-1===s&&-1===n&&-1===o&&-1===c)return;let d=(t,l)=>{let s={...l[t]};return"add"===a?(s.reactions.push({react:r,by:e,id:":irrelevant:"+Math.random(),avatar:":irrelevant:"+Math.random(),handle:":irrelevant:"+Math.random(),name:":irrelevant:"+Math.random()}),s.reactions=s.reactions.filter(t=>t.by!==e||t.react!==("upvote"===r?"downvote":"upvote"))):s.reactions=s.reactions.filter(t=>t.by!==e),[...l.slice(0,t),s,...l.slice(t+1)]};-1!==s&&i(e=>d(s,e)),-1!==n&&v(e=>d(n,e)),-1!==o&&k(e=>d(o,e)),-1!==c&&A(e=>d(c,e))},[l,w,S,_]),T=(0,r.useCallback)((e,t)=>{i(l=>0===l.length?l:[...e.map(e=>({id:Math.random().toString(36).substring(2,15),post_type:"meme",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},reactions:[],votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()})),...l])},[]),O=(0,r.useCallback)((e,t)=>{i(l=>0===l.length?l:l.map(l=>{if("meme"in l&&l.post.id===e){let e=l.post;return{...l,post:{...e,...t}}}return l}))},[]),R=(0,r.useCallback)((e,t)=>{i(l=>0===l.length?l:[{id:Math.random().toString(36).substring(2,15),post_type:"deck",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,memes:Object.values(e.memes).map(e=>({...e,is_public:!0})),is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},reactions:[],votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()},...l])},[]),I=(0,r.useCallback)(e=>{i(t=>t.filter(t=>t.post.id!==e))},[]),M=(0,r.useCallback)(e=>{w.length>0&&v(t=>[e,...t]),_.length>0&&k(t=>[e,...t])},[w.length,_.length]);return(0,a.jsx)(s.Provider,{value:{feed:l,setFeed:i,hasFetchedFeed:n,setHasFetchedFeed:o,feedActions:c,setFeedActions:d,appendMemesToFeed:T,appendDeckToFeed:R,removeItemFromFeed:I,updateMemeInFeed:O,searchQuery:u,setSearchQuery:m,searchResults:x,setSearchResults:p,hasFetchedSearchResults:h,setHasFetchedSearchResults:f,librarySearchQuery:g,setLibrarySearchQuery:b,library:w,setLibrary:v,hasFetchedLibrary:y,setHasFetchedLibrary:j,uploads:_,setUploads:k,hasFetchedUploads:N,setHasFetchedUploads:C,saved:S,setSaved:A,hasFetchedSaved:z,setHasFetchedSaved:D,onUploadMeme:M,getItem:P,voteOnItem:E},children:t})},n=()=>{let e=(0,r.useContext)(s);if(void 0===e)throw Error("useFeed must be used within a FeedProvider");return e}},39992:function(e,t,l){"use strict";l.d(t,{Df:function(){return r},Po:function(){return a},RL:function(){return i},eh:function(){return s}});let a=e=>{let t=new Date(e/1e6),l=Math.round((new Date().getTime()-t.getTime())/1e3),a=Math.round(l/60),r=Math.round(a/60),s=Math.round(r/24);return l<60?"".concat(l,"s ago"):a<60?"".concat(a,"m ago"):r<24?"".concat(r,"h ago"):"".concat(s," day").concat(1===s?"":"s"," ago")},r=e=>e.replace(/[^a-z0-9]/gi,"_").toLowerCase();function s(e){let t=atob(e.split(",")[1]||e),l=Array(t.length);for(let e=0;e<t.length;e++)l[e]=t.charCodeAt(e);return new Uint8Array(l)}let i="image/*,.jpg_large,.png_large,.jpeg_large,.jpg_small,.png_small,.jpeg_small"},33838:function(e,t){"use strict";t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/x.493d8304.png",height:45,width:41,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAQAAACfDS2NAAAAeElEQVR42h3JIQoCURiF0dtUEOwmMQlGnSKuYbAIbsFucAViGMFgE0b3YdRueUuxyH+/p8zEwxGLvGaMkCcUYkvy/dOJISlmkrz3hTMvStRw4IobNfr1lLtZHHm48tztljzZ+eqTpShIMQr5wJtaXsY0hL59Nl79AU07Rc3uyJI/AAAAAElFTkSuQmCC",blurWidth:7,blurHeight:8}},69919:function(e,t){"use strict";t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/xmark.ac6fe3e8.svg",height:48,width:48,blurWidth:0,blurHeight:0}},7692:function(e,t){"use strict";t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/logo-wide.572ec4d3.svg",height:256,width:702,blurWidth:0,blurHeight:0}}},function(e){e.O(0,[2290,2972,9886,8651,2974,545,7957,8735,5399,7603,5078,7714,7930,3957,1744],function(){return e(e.s=36399)}),_N_E=e.O()}]);