"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8970],{39886:function(e,t,a){a.d(t,{o:function(){return r}});var n=a(7590),i=a(33238),o=a(62247);let r=()=>(0,n.jsxs)("span",{className:(0,o.cn)("hidden sm:flex","items-center absolute bottom-0.5 text-white-400/35 text-[9px]"),children:["Pssst. Use"," ",(0,n.jsx)(i.C,{keys:["tab"],className:"bg-transparent opacity-50"})," and"," ",(0,n.jsx)(i.C,{keys:["up","down"],className:"bg-transparent opacity-50"})," ","keys to autocomplete."]})},9899:function(e,t,a){a.d(t,{Z:function(){return o}});var n=a(7590),i=a(62247);let o=e=>{let{isOpen:t=!0,children:a,onClick:o}=e;return(0,n.jsx)("div",{className:(0,i.cn)("modal-overlay","fixed inset-0 z-50 flex size-full max-h-full min-h-0 items-start xs:items-center justify-center overflow-y-auto overflow-x-hidden","bg-white-100 px-4 py-[10vh]","transition-opacity duration-100",{"opacity-0":!t,"opacity-100":t,"pointer-events-none":!t}),onClick:o,children:a})}},56597:function(e,t,a){a.d(t,{B:function(){return l}});var n=a(7590),i=a(27613),o=a(22566),r=a(62247);let l=e=>{let{keepMemeDeck:t=!1,keepStudio:a=!1}=e;return(0,n.jsxs)("div",{className:"flex items-center h-8 min-h-8",children:[(0,n.jsx)(i.default,{priority:!0,src:o.Z,alt:"Meme Deck",className:(0,r.cn)("h-8 w-auto xl:block",t?"":"hidden"),draggable:!1}),(0,n.jsx)("h1",{className:(0,r.cn)("text-stone-300 text-lg sm:block",a?"":"hidden"),children:"Studio"})]})}},33358:function(e,t,a){a.d(t,{a:function(){return g}});var n=a(7590),i=a(77848),o=a(40774),r=a(9769),l=a(81662),c=a(10015),s=a(73109),d=a(34239),p=a(62247);let u={[s.By.WAITING]:"Waiting in queue...",[s.By.STARTED]:"Running...",[s.By.COMPLETED]:"Completed"},m=e=>{let{index:t}=e,{activeJobStatus:a,panels:i,contest:r}=(0,d.C)(),s=i[t];if(!s)return null;let{src:m}=s.local;return(0,n.jsx)(o.E.div,{className:"absolute bottom-10 w-full flex items-center justify-center",initial:{opacity:0,scale:.85},animate:{opacity:m?0:1,scale:m?.9:1,transition:{duration:.3}},exit:{opacity:0,scale:.9},children:(0,n.jsx)(l.w,{shadow:"none",className:(0,p.cn)("h-12 w-48 text-sm mx-3 flex flex-row justify-center items-center gap-2 p-2 rounded-xl border-2",r?"border-violet-400":"border-orange-400"),children:(0,n.jsx)(c.M,{mode:"wait",children:(0,n.jsx)(o.E.h2,{className:(0,p.cn)("truncate select-none",r?"text-violet-400":"text-orange-400"),initial:{opacity:0,x:20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.2},children:u[a]},a)})})})};var f=a(16275);let g=e=>{var t;let{index:a,hideborder:l=!1}=e,{activePanelIdx:c,panels:s,selectedLayout:u,paneDimensions:g,contest:h,onClickPane:_}=(0,d.C)(),y=s[a],v=c===a;if(!y)return console.error("Panel not found for index",a),null;let{src:w,progress:x,isGenerating:b}=y.local,k=y.panel_config.image,{top_text:A,bottom_text:S}=null!==(t=y.panel_config.text_overlay)&&void 0!==t?t:{},E=f.WN[u];return(0,n.jsxs)("div",{style:{aspectRatio:g.paneWidth/g.paneHeight},className:(0,p.cn)(E,"relative flex-1 overflow-hidden mx-auto my-0 bg-black-400",l?"border-none":"border-3",v?h?"border-violet-400":"border-orange-400":"border-transparent"),onClick:()=>_(a),children:[b&&!w&&(0,n.jsx)(o.E.div,{className:"size-full flex items-center justify-center backdrop-blur-lg",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},children:(0,n.jsx)(i.X,{className:"size-full opacity-50"})}),b&&(0,n.jsx)(m,{index:a}),(0,n.jsx)(o.E.div,{className:"size-full max-h-full flex items-center justify-center",initial:{opacity:0},animate:{opacity:1},children:(0,n.jsx)(r.g,{type:y.panel_type,src:w||k.source_url,topText:null!=A?A:"",progress:b?x:100,bottomText:null!=S?S:"",centerText:y.panel_config.text,imageWidth:k.width,imageHeight:k.height,canvasWidth:g.paneWidth,canvasHeight:g.paneHeight},w)})]})}},64405:function(e,t,a){a.d(t,{Z:function(){return l}});var n=a(7590),i=a(82581),o=a(18095),r=a(34239);let l=e=>{var t;let{isMobile:a=!1,isSmall:l=!1}=e,{activePanel:c,activePanelIdx:s,dispatchPanelAction:d}=(0,r.C)(),p=null==c?void 0:null===(t=c.panel_config.prompt)||void 0===t?void 0:t.aesthetic,u=(0,i.useCallback)(e=>{var t,a;d({idx:s,action:"update-panel",panel_config:{prompt:{aesthetic:null!==(t=null==e?void 0:e.id)&&void 0!==t?t:null}}}),localStorage.setItem("selectedAesthetic",null!==(a=null==e?void 0:e.id)&&void 0!==a?a:"")},[s,d]);return(0,n.jsx)(o.d,{aestheticId:p,onSelect:u,isMobile:a,isSmall:l,hideDescription:l,isDisabled:!c})}},79604:function(e,t,a){a.d(t,{U:function(){return l}});var n=a(7590),i=a(82581),o=a(49682),r=a(34239);let l=e=>{var t,a;let{isSmall:l=!1}=e,{activePanel:c,activePanelIdx:s,dispatchPanelAction:d}=(0,r.C)(),p=(0,i.useCallback)(e=>{e&&(d({idx:s,action:"update-panel",panel_config:{prompt:{character:e.id}}}),localStorage.setItem("selectedCharacter",e.id))},[s,d]);return(0,n.jsx)(o.z,{characterId:null!==(a=null==c?void 0:null===(t=c.panel_config.prompt)||void 0===t?void 0:t.character)&&void 0!==a?a:"",onSelect:p,showClearButton:!1,isSmall:l,isDisabled:!c})}},15992:function(e,t,a){a.d(t,{f:function(){return c}});var n=a(82581);let i=["actor","alien","archaeologist","artist","athlete","astronaut","Batman","biologist","Captain America","chef","chemist","cowboy","Darth Vader in Star Wars","detective","doctor","engineer","firefighter","ghost","Harry Potter","historian","homeless person","Indiana Jones","Ironman","James Bond 007","journalist","John Wick","mathematician","millionaire","Morphius in The Matrix","model in a fashion show","musician","navy seal","ninja","nurse","paramedic","Patrick Bateman in American Psycho","philosopher","physicist","pilot","pirate","police officer","politician","psychologist","robot","samurai","scientist","Sherlock Holmes","Shrek","sociologist","Spiderman","spy","student","Superman","superhero","supervillain","teacher","The Hulk","The Joker","The Terminator","Thor","Tony Montana in Scarface","Vampire","Vito Corleone in The Godfather","Viking","werewolf","Winny the Pooh","Wolverine","writer","Yoda","zombie"],o=["boxing","computer hacking","cooking a gourmet meal","dancing ballet","dancing hip-hop","defusing a bomb","fighting fires","flying a plane","meditating","navigating treacherous terrain","performing surgery","playing chess","playing guitar","running a marathon","singing","solving a mystery","working out in the gym","writing a novel"],r=["3-star michelin restaurant","abandoned warehouse","ancient temple","arid desert","burning building","corporate office","deep canyon","dense forest","flooded area","haunted house","library","medieval castle","outer space","remote island","snowy mountain range","space station","stormy sea","urban cityscape"],l=["in a state of confusion","in a state of panic","in a state of rage","in a state of zen","in euphoria","in the dead of night","laughing uncontrollably","crying uncontrollably","under extreme pressure","wearing a blindfold","wearing a suit and tie","wearing a suit of armor","while being cheered on by a crowd","while being pursued by wild animals","while multitasking","in the middle of a hurricane"];function c(e,t,a){let[c,s]=(0,n.useState)(0),d=(0,n.useMemo)(()=>(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100,t=[];for(let a=0;a<e;a++){let e=Math.floor(Math.random()*i.length),a=i[e],n=Math.floor(Math.random()*o.length),c=o[n],s=Math.floor(Math.random()*r.length),d=r[s],p=Math.floor(Math.random()*l.length),u=l[p];t.push("As ".concat(a," ").concat(c," in a ").concat(d," ").concat(u))}return t})(),[]);return{suggestion:(0,n.useMemo)(()=>d[c],[d,c]),onKeyDown:(0,n.useCallback)(n=>{let i=""===e.trim();"Enter"!==n.key||n.shiftKey?"Tab"===n.key&&i?(n.preventDefault(),t(d[c])):"ArrowUp"===n.key&&i?(n.preventDefault(),s((c-1+d.length)%d.length)):"ArrowDown"===n.key&&i&&(n.preventDefault(),s((c+1)%d.length)):(n.preventDefault(),i?t(d[c]):a())},[a,t,c,d,e])}}},41245:function(e,t,a){a.d(t,{s:function(){return m}});var n=a(7590),i=a(15866),o=a(72655),r=a(82581),l=a(92782);let c=()=>l.cm?"wss://staging-generation-api.memedeck.xyz/v2/ws":l.BB||l.j7?"wss://studio.api.memedeck.xyz/v2/ws":"ws://127.0.0.1:8079/v2/ws";var s=a(3333),d=a(32701);let p=()=>(0,n.jsxs)("div",{className:"flex items-center gap-3",children:[(0,n.jsx)(i.c,{size:"sm",color:"white"}),"Connecting to server"]}),u=(0,d.D)(()=>{(0,o.yv)((0,n.jsx)(p,{}),{key:"reconnect",variant:"warning",hideIconVariant:!0,preventDuplicate:!0,persist:!0})},1e3),m=e=>{let{showToast:t=!1}=e,{data:a}=(0,s.iS)(),[n,i]=(0,r.useState)(null),l=(0,r.useRef)(!1),d=(0,r.useCallback)(()=>{if(!a)return;let e=new WebSocket("".concat(c(),"/").concat(a.id));return e.onopen=()=>{console.log("Connected to server"),(0,o.sy)()},e.onclose=()=>{!0!==l.current&&(console.warn("Disconnected from server"),setTimeout(()=>{d()},2e3),t&&u())},i(e),e},[a,t]);return(0,r.useEffect)(()=>{let e=d();return l.current=!1,()=>{e&&e.close(),l.current=!0,(0,o.sy)()}},[d]),{socket:n}}},85183:function(e,t,a){a.d(t,{CG:function(){return o},TL:function(){return i}});var n=a(24580);let i=n.I0.withTypes(),o=n.v9.withTypes();n.oR.withTypes()},73109:function(e,t,a){a.d(t,{By:function(){return o},u2:function(){return c}});var n,i,o,r,l=a(82581);(n=o||(o={})).WAITING="waiting",n.STARTED="started",n.COMPLETED="ended",(i=r||(r={})).DeserializationError="DeserializationError",i.SerializationError="SerializationError",i.DatabaseError="DatabaseError",i.ImageUploadError="ImageUploadError",i.ImageGenerationError="ImageGenerationError",i.InvalidRequestError="InvalidRequestError",i.AuthenticationError="AuthenticationError",i.NotFoundError="NotFoundError",i.InternalServerError="InternalServerError",i.WebSocketError="WebSocketError";let c=(0,l.createContext)({})},34239:function(e,t,a){a.d(t,{L:function(){return w},C:function(){return x}});var n=a(7590),i=a(72655),o=a(82581),r=a(3333),l=a(85183),c=a(8413);let s=(e,t)=>{switch(t.action){case"new-project":return(0,c.$W)(t.layout);case"update-panel":{var a,n,i,o,r,l,s,d;let{idx:p,...u}=t,m=e[p];m||(console.warn("Panel not found, creating default panel"),m=(0,c.jt)(p));let f=null!==(l=u.panel_type)&&void 0!==l?l:m.panel_type,g={idx:p,in:m.in,id:null!==(s=u.id)&&void 0!==s?s:m.id,panel_type:f,panel_config:{image:{...m.panel_config.image,...null===(a=u.panel_config)||void 0===a?void 0:a.image},prompt:{...m.panel_config.prompt,...null===(n=u.panel_config)||void 0===n?void 0:n.prompt},text_overlay:{...m.panel_config.text_overlay,...null===(i=u.panel_config)||void 0===i?void 0:i.text_overlay},text:null!==(d=null===(o=u.panel_config)||void 0===o?void 0:o.text)&&void 0!==d?d:m.panel_config.text,faceswap:{...m.panel_config.faceswap,...null===(r=u.panel_config)||void 0===r?void 0:r.faceswap}},local:{...m.local,...u.local}};return{...e,[p]:g}}default:return console.error("Unknown action type"),e}};var d=a(73109);function p(e){return Object.values(e).map(e=>{if("image"===e.panel_type)return{index:e.idx,panel_type:"image",panel_config:{image:e.panel_config.image.id}};if("faceswap"===e.panel_type){let t=e.panel_config;return{index:e.idx,panel_type:"faceswap",panel_config:{faceswap:t.faceswap}}}return"text"===e.panel_type?{index:e.idx,panel_type:"text",meme_text:e.panel_config.text,panel_config:{}}:{index:e.idx,panel_type:e.panel_type,panel_config:{}}})}var u=a(16275),m=a(97032),f=a(79738),g=a(89065),h=a(22890),_=a(32701),y=a(92782),v=a(7922);let w=e=>{var t;let{profile:a,socket:w,config:x,history:b,queryParams:k,isGeneratingFromFeed:A,children:S}=e,E=(0,l.TL)(),[j]=(0,r.rj)(),[C,{isLoading:R}]=(0,r.ey)(),[F]=(0,r.yo)(),[M]=(0,r.gF)(),[W]=(0,r.jn)(),[N]=(0,r.KV)(),[O]=(0,r.lR)(),[I]=(0,r.xY)(),[T]=(0,r.GJ)(),[D]=(0,r.Mf)(),[P]=(0,r.ns)(),B=(0,o.useMemo)(()=>(0,_.k)(T,500),[T]),G=(0,o.useMemo)(()=>(0,_.k)(D,500),[D]),[L,z]=(0,o.useState)(null),[U,H]=(0,o.useState)(null),[J,q]=(0,o.useState)(null),[V,K]=(0,o.useState)(null),[Z,$]=(0,o.useState)(0),[Q,X]=(0,o.useState)(d.By.WAITING),[Y,ee]=(0,o.useState)("generate"),[et,ea]=(0,o.useState)(f.L.One),[en,ei]=(0,o.useState)(!1),[eo,er]=(0,o.useState)(!1),[el,ec]=(0,o.useState)(!1),[es,ed]=(0,o.useState)(!1),[ep,eu]=(0,o.useState)(!1),[em,ef]=(0,o.useState)(!1),eg=(0,o.useRef)(!1),[eh,e_]=(0,o.useReducer)(s,(0,c.$W)(et)),ey=(0,o.useMemo)(()=>eh[0],[eh]),ev=(0,o.useMemo)(()=>eh[Z],[eh,Z]),ew=(0,o.useMemo)(()=>{var e;let t=null!==(e=ey.local.selectedAspectRatio)&&void 0!==e?e:m.t.Square;return(0,h.rf)(et,t)},[ey.local.selectedAspectRatio,et]),ex=(0,o.useMemo)(()=>(0,h.vO)(ew.paneWidth,ew.paneHeight),[ew.paneHeight,ew.paneWidth]),eb=(0,o.useMemo)(()=>(0,h.GJ)(et,ew),[et,ew]),ek=(0,o.useMemo)(()=>eb.canvasWidth/eb.canvasHeight,[eb]),eA=(0,o.useMemo)(()=>{var e,t;return null!==(t=null==ev?void 0:null===(e=ev.panel_config.prompt)||void 0===e?void 0:e.user_positive_prompt)&&void 0!==t?t:""},[null==ev?void 0:null===(t=ev.panel_config.prompt)||void 0===t?void 0:t.user_positive_prompt]),eS=(0,o.useMemo)(()=>Object.values(eh).slice(0,u.i4[et]).some(e=>"text"===e.panel_type?""===e.panel_config.text:"image"!==e.panel_type&&"faceswap"!==e.panel_type||""===e.local.src||e.local.isGenerating),[eh,et]),eE=(0,o.useMemo)(()=>Object.values(eh).some(e=>e.local.isGenerating),[eh]),ej=(0,o.useCallback)(e=>{if(z(e),!A){let t=new URL(window.location.href);t.searchParams.set("meme",e.replace("meme:","")),window.history.replaceState({},"",t.toString())}},[A]),eC=(0,o.useCallback)(()=>{let e=localStorage.getItem("isExpandedPrompt");e&&e_({action:"update-panel",idx:Z,local:{isExpandedPrompt:JSON.parse(e)}});let t=localStorage.getItem("selectedAesthetic");t&&e_({action:"update-panel",idx:Z,panel_config:{prompt:{aesthetic:"object"==typeof t?JSON.parse(t).id:t}}});let a=localStorage.getItem("selectedCharacter");a&&e_({action:"update-panel",idx:Z,panel_config:{prompt:{character:"object"==typeof a?JSON.parse(a).id:a}}})},[Z]),eR=(0,o.useCallback)((e,t,a)=>{if(e_({action:"update-panel",idx:e,panel_config:{text:a}}),!L)throw Error("Failed to find composed meme id");return B({meme_id:L,panel_id:t,panel_type:"text",panel_config:{text:a}})},[L,B]),eF=(0,o.useCallback)((e,t,a)=>{var n,i,o,r;if(e_({action:"update-panel",idx:e,panel_config:{text_overlay:{[t]:a}}}),!L)throw Error("Failed to find composed meme id");let l=eh[e];if(!l)throw Error("Failed to find active panel");let c="top_text"===t,s={top_text:a,bottom_text:null!==(o=null===(n=l.panel_config.text_overlay)||void 0===n?void 0:n.bottom_text)&&void 0!==o?o:""},d={top_text:null!==(r=null===(i=l.panel_config.text_overlay)||void 0===i?void 0:i.top_text)&&void 0!==r?r:"",bottom_text:a};G({panel_idx:e,meme_id:L,...{top_text_size:"md",bottom_text_size:"md",additional_config:null,...c?s:d}})},[L,eh,G]),eM=(0,o.useCallback)(async e=>{ej(e.id),e.posts&&e.posts.length>0?q(e.posts[0]):q(null),e.contest?K(e.contest):K(null),ea(e.panel_layout);let t=e.panels,a=(0,c.$W)(e.panel_layout);t&&Object.values(t).filter(Boolean).length>0?a=(0,c.xe)(t):console.log("Empty project, loading in default panels");let n=a[0];$(0),"text"===n.panel_type?ee("text"):"faceswap"===n.panel_type?ee("faceswap"):ee("generate"),e_({action:"new-project",layout:et}),Object.values(a).map(e=>{e_({idx:e.idx,id:e.id,action:"update-panel",panel_type:e.panel_type,panel_config:e.panel_config,local:e.local})}),eu(!1)},[et,ej]),eW=(0,o.useCallback)(async e=>{var t,a,n;if(!L)throw Error("Failed to find composed meme id");let{data:i}=await O({meme_id:L,index:Z,image_id:e.id,panel_type:"image",panel_config:{}}),o=null==i?void 0:i[0],r=null==o?void 0:o.panel_config;if(!o||!r)throw Error("Failed to post meme panel");let l=(0,h.vO)(null!==(t=r.image.width)&&void 0!==t?t:1,null!==(a=r.image.height)&&void 0!==a?a:1),c=null!==(n=r.image.source_url)&&void 0!==n?n:r.image.url;e_({action:"update-panel",idx:Z,panel_type:"image",panel_config:r,local:{src:c,prevSrc:c,selectedAspectRatio:l}})},[Z,L,O]),eN=(0,o.useCallback)(e=>{var t;if(e===Z)return;$(e);let a=eh[e];if(!a)throw Error("Failed to find active panel");ee("image"===(t=a.panel_type)?"generate":t)},[Z,eh]),eO=(0,o.useCallback)(e=>{ee(e),e_({action:"update-panel",idx:Z,panel_type:function(e){switch(e){case"library":case"generate":return"image";default:return e}}(e)})},[Z]),eI=(0,o.useCallback)(async e=>{q(null),$(0),ed(!0);let t=f.L.One,a=(0,c.$W)(f.L.One);e.panels&&e.panel_layout&&(t=e.panel_layout,a=e.panels);try{let{data:n}=await I({...e.contest_id?{contest_id:e.contest_id}:{},panel_layout:t,panels:p(a)});if(!n)return null;eM(n);let i=new URL(window.location.href);i.searchParams.delete("remix"),window.history.replaceState({},"",i.toString())}catch(e){throw(0,i.yv)("Failed to remix meme",{variant:"error"}),Error("Failed to init panels server side")}finally{ed(!1)}},[eM,I]),eT=(0,o.useCallback)(async e=>{let{data:t}=await P(e);if(t){K(t),q(null),$(0),ed(!0);try{let{data:t}=await I({contest_id:e,panel_layout:f.L.One,panels:p((0,c.$W)(f.L.One))});if(!t)return null;eM(t);let a=new URL(window.location.href);a.searchParams.delete("contestId"),window.history.replaceState({},"",a.toString())}catch(e){(0,i.yv)("Failed to init contest meme",{variant:"error"})}finally{ed(!1)}}},[P,eM,I]),eD=(0,o.useCallback)(async e=>{if(e===et)return;let t={};if(e===f.L.TwoVertical)t={selectedAspectRatio:m.t.Portrait};else if(e===f.L.TwoHorizontal)t={selectedAspectRatio:m.t.Portrait};else if(e===f.L.Four)t={selectedAspectRatio:m.t.Square};else{let e=null==ev?void 0:ev.local.selectedAspectRatio;t={selectedAspectRatio:null!=e?e:m.t.Square}}let a=u.i4[e],n=(0,c.$W)(e);for(let e in eh)n[e]=eh[e];if(Object.values(n).map(e=>{e_({action:"update-panel",idx:e.idx,panel_type:e.panel_type,panel_config:e.panel_config,local:t})}),ea(e),!L)throw Error("Failed to find composed meme id");N({meme_id:L,panel_layout:e,panels:p(n).slice(0,a)})},[null==ev?void 0:ev.local.selectedAspectRatio,L,eh,et,N]),eP=(0,o.useCallback)(async(e,t)=>{ed(!0);try{let{data:a}=await I({panel_layout:et,panels:p((0,c.$W)(et))});if(!a)throw Error("Failed to init panels server side");let n=null==a?void 0:a.panels;if(e&&"string"==typeof e){let t=n[0].panel_config.prompt;t&&(t.character=e)}if(t&&"string"==typeof t){let e=n[0].panel_config.prompt;e&&(e.aesthetic=t)}A||e_({action:"new-project",layout:et}),Object.values(n).map(a=>{e_({action:"update-panel",idx:a.idx,id:a.id,panel_config:{prompt:{character:e,aesthetic:t}}})}),eM(a)}catch(e){console.error("Failed to create new project",e)}finally{eu(!1),ed(!1)}},[A,eM,I,et]),eB=(0,o.useCallback)(async e=>{var t,a;q(null),e_({action:"new-project",layout:et}),(null==e?void 0:null===(t=e.image)||void 0===t?void 0:t.prompt)&&e_({action:"update-panel",idx:0,panel_config:{prompt:null==e?void 0:null===(a=e.image)||void 0===a?void 0:a.prompt}})},[et]),eG=(0,o.useCallback)(async e=>{let t=x.characters.find(t=>t.id===e);if(t)console.log("Found character",t);else throw Error("Failed to find character");e_({action:"update-panel",idx:0,panel_config:{prompt:{character:e}}}),await eP(e);let a=new URL(window.location.href);a.searchParams.delete("character"),window.history.replaceState({},"",a.toString())},[x.characters,eP]),eL=(0,o.useCallback)(async e=>{if(eg.current)return;eg.current=!0;let{remixMemeId:t,memeId:a,characterId:n,contestId:i}=k,o=async t=>{let a;let n=e.find(e=>e.id.replace("meme:","")===t);if(n)a=n;else{let{data:e}=await j(t);a=e}if(!a)throw Error("Failed to find matching meme for query param");return a},r=async()=>{e[0]?await eM(e[0]):await eP()};try{if(t){let e=await o(t);eI(e)}else if(i)eT(i);else if(a){let e=await o(a);eM(e)}else A?eB():r()}catch(e){console.error(e),r()}n&&eG(n)},[j,A,eM,eP,eB,eG,eT,eI,k]),ez=(0,o.useCallback)(e=>{let t=e.findIndex(e=>e.id===L);return -1===t?e[0]:t>0?e[t-1]:t<e.length-1?e[t+1]:e[0]},[L]),eU=(0,o.useCallback)(async()=>{if(L)try{let e=1===b.length;if(await C(L),e)eP();else{let e=ez(b);eM(e)}}catch(e){(0,i.yv)("Failed to delete meme",{variant:"error"})}},[L,C,ez,b,eM,eP]),eH=(0,o.useCallback)(async()=>{if(J)try{er(!0),await W(J),q(null)}catch(e){(0,i.yv)("Failed to delete post",{variant:"error"})}finally{er(!1)}},[W,J]),eJ=(0,o.useCallback)(async(e,t)=>{let a=u.i4[e];try{ec(!0),e_({action:"new-project",layout:e}),Object.values(t).slice(0,a).map(e=>{var t;e_({action:"update-panel",...e,panel_type:e.panel_type,panel_config:e.panel_config,local:{...null!==(t=e.local)&&void 0!==t?t:{},isGenerating:!1}})});let{data:n}=await I({panel_layout:e,panels:p(t),contest_id:null==V?void 0:V.id});if(!n)throw Error("Failed to init panels server side");eM(n),q(null)}catch(e){(0,i.yv)("Failed to duplicate post",{variant:"error"})}finally{ec(!1)}},[null==V?void 0:V.id,eM,I]),eq=(0,o.useCallback)((e,t,a,n)=>{var i;if(!w)return;if(!L)throw Error("Failed to find composed meme id");let o={kind:"generate_faceswap",data:{faceswap_strength:eh[e].panel_config.faceswap.faceswap_strength,face_image:t,base_image:a,base_width:n.width,base_height:n.height,panel_idx:e,meme_id:L}};console.log("Generating faceswap",o),e_({idx:e,action:"update-panel",panel_type:"faceswap",panel_config:{prompt:{seed:0},text:""},local:{prevSrc:null===(i=eh[e])||void 0===i?void 0:i.local.src,src:void 0,isGenerating:!0}}),w.send(JSON.stringify(o))},[L,eh,w]),eV=(0,o.useCallback)((e,t)=>{var n;if(!w)return;let i=t.panel_config.prompt;if(!i)throw Error("Failed to find prompt");let o="fixed"===i.seed_type?i.seed:(0,v.qb)(),r=null===(n=i.character)||void 0===n?void 0:n.replace("ai_character:",""),l=i.aesthetic;try{l=JSON.parse(l||"error").id}catch(e){}let c={meme_id:A?null:L,panel_idx:A?null:e,contest_id:null==V?void 0:V.id,allowed_to_auto_post:!V,post_to_deck_ids:A?["feed"]:void 0,workflow:"flux_character_gen",do_prompt_expansion:t.local.isExpandedPrompt,user_id:a.id,positive_prompt:eA,negative_prompt:i.user_negative_prompt,seed:o,aspect_ratio:et!==f.L.One?u.aN[et]:t.local.selectedAspectRatio,character:i.character?{id:r,strength_model:1}:null,steps:6,aesthetic:l,cfg_scale:i.cfg_scale};e_({idx:e,action:"update-panel",panel_type:"image",panel_config:{image:{width:ew.paneWidth,height:ew.paneHeight},prompt:{seed:o},text:"",faceswap:{face_image:void 0,base_image:void 0,faceswap_strength:1}},local:{isGenerating:!0,src:void 0,prevSrc:t.local.src}}),X(d.By.WAITING);let s={kind:"flux_generate_image",data:c};console.log("sending payload",s),w.send(JSON.stringify(s))},[L,V,A,ew.paneHeight,ew.paneWidth,a.id,eA,et,w]),eK=(0,o.useCallback)(e=>{e_({idx:Z,action:"update-panel",panel_config:{prompt:{user_positive_prompt:e}}})},[Z,e_]),eZ=(0,o.useCallback)(async(e,t,a)=>{try{ei(!0);let n=[];if(a&&"string"==typeof a){let e=a.split(",")[1];n=(0,v.RG)(e)}else{let t=await (0,g.jt)(e,et,(0,h.vO)(ew.paneWidth,ew.paneHeight));n=Array.from(new Uint8Array(t))}let{data:i}=await M({meme_id:t,bytes:n,deck_ids:["deck:feed"]});if(!i||!i.meme)throw Error("Failed to post meme");q(i.id),H(i.meme.url),ef(!0)}catch(e){console.error("Failed to compile composed meme",e)}finally{ei(!1)}},[ew.paneHeight,ew.paneWidth,M,et]),e$=(0,o.useCallback)(()=>{Object.values(eh).forEach(e=>{e_({action:"update-panel",idx:e.idx,local:{progress:0,isGenerating:!1}})})},[eh]),eQ=(0,o.useCallback)(async e=>{if(!L)throw Error("Failed to post composed meme");eZ(eh,L,e)},[L,eh,eZ]),eX=(0,o.useCallback)(async()=>{if(!V)throw Error("Failed to find contest");if(!L)throw Error("Failed to post composed meme");try{ei(!0);let e=await (0,g.jt)(eh,et,(0,h.vO)(ew.paneWidth,ew.paneHeight)),{data:t}=await M({meme_id:L,bytes:Array.from(new Uint8Array(e)),deck_ids:["deck:feed"]});if(!t||!t.meme)throw Error("Failed to post composed meme");q(t.id),H(t.meme.url)}catch(e){console.error("Failed to compile composed meme",e)}finally{ei(!1)}},[L,V,ew.paneHeight,ew.paneWidth,eh,M,et]),eY=(0,o.useCallback)(async()=>{if(!V)throw Error("Failed to find contest");if(!J)throw Error("Failed to post composed meme");try{er(!0),await F({contestId:V.id,entryId:J}),q(null)}catch(e){console.error("Failed to compile composed meme",e)}finally{er(!1)}},[V,F,J]);return(0,o.useEffect)(()=>{w&&(w.onmessage=e=>{let t=Object.values(eh).find(e=>e.local.isGenerating);if(!t){console.error("Failed to find generating panel");return}if(y.BB||console.log("Socket message",JSON.parse(e.data)),"started"===(e=JSON.parse(e.data)).status&&X(d.By.STARTED),"faceswap_generated"===e.type){console.log("Faceswap generated",e);let a=new Blob([new Uint8Array(e.data)],{type:"image/jpeg"}),n=new FileReader;n.onloadend=()=>{let a=n.result;e_({idx:t.idx,action:"update-panel",panel_type:"faceswap",panel_config:{image:{width:e.dimensions[0],height:e.dimensions[1]},faceswap:{base_width:e.dimensions[0],base_height:e.dimensions[1]}},local:{selectedAspectRatio:(0,h.vO)(e.dimensions[0],e.dimensions[1]),src:a,progress:100,isGenerating:!1}})},n.readAsDataURL(a)}else if("image_generating"===e.kind){let a=new Blob([new Uint8Array(e.data)],{type:"image/jpeg"}),n=new FileReader;n.onloadend=()=>{let a=n.result;e_({idx:t.idx,action:"update-panel",local:{src:a,progress:e.progress}}),A&&100===e.progress&&ei(!0)},n.readAsDataURL(a)}else if("image_created"===e.type&&A){let t=e.post;if(!t)throw Error("Failed to find post");let a={...t,is_creator:!0};E(r.vK.util.updateQueryData("getPosts",{deck_id:"feed"},e=>e?[a,...e]:[a])),E(r.vK.util.updateQueryData("getDecksNewPosts",void 0,e=>{t.appears_in.map(e=>e.id).forEach(t=>{let a=e[t];a&&(e[t]=a+1)})})),ei(!1),eB(t)}else if("image_generated"===e.kind||"meme_created"===e.type){let a=new Blob([new Uint8Array(e.data)],{type:"image/jpeg"}),n=new FileReader;n.onloadend=async()=>{let a=e.id,i=n.result;if(!t)throw Error("Failed to find active panel");e_({idx:t.idx,action:"update-panel",panel_type:"image",panel_config:{image:{id:a}},local:{src:i,prevSrc:i,progress:100,isGenerating:!1}})},n.readAsDataURL(a)}else"same_prompt"===e.kind&&e_({idx:t.idx,action:"update-panel",local:{src:t.local.prevSrc,progress:100,isGenerating:!1}})})},[E,A,eB,eh,w]),(0,o.useEffect)(()=>{eC()},[eC]),(0,o.useEffect)(()=>{b&&eL(b)},[b,eL]),(0,n.jsx)(d.u2.Provider,{value:{panels:eh,activePanel:ev,activePanelIdx:Z,activeJobStatus:Q,selectedTab:Y,selectedLayout:et,promptValue:eA,onChangePromptValue:eK,postId:J,composedMemeId:L,composedMemeUrl:U,contest:V,isPostDisabled:eS,isPosting:en,isUnpublishing:eo,isDeleting:R,isDuplicating:el,isCreatingProject:es,isPostModalOpen:em,isSidebarMenuOpen:ep,isGenerateDisabled:eE,canvasDimensions:eb,canvasAspectRatio:ek,paneDimensions:ew,paneAspectRatio:ex,toggleIsSidebarMenuOpen:()=>eu(e=>!e),onChangeTextPanel:eR,onChangeTextOverlay:eF,onClosePostModal:()=>ef(!1),onClickHistory:eM,onClickLibrary:eW,onClickPane:eN,onClickTab:eO,onSelectPanelLayout:eD,onClickNewProject:eP,onClickDelete:eU,onClickUnpublish:eH,onClickDuplicateProject:eJ,onClickGenerate:eV,onClickFaceswap:eq,onClickPublish:eQ,onClickCancelPublish:e$,onClickSubmitToContest:eX,onClickUnsubmitFromContest:eY,dispatchPanelAction:e_},children:S})},x=()=>{let e=(0,o.useContext)(d.u2);if(void 0===e)throw Error("useStudio must be used within StudioProvider");return e}},8413:function(e,t,a){a.d(t,{$W:function(){return u},jt:function(){return p},xe:function(){return m}});var n=a(16275),i=a(97032),o=a(79738),r=a(22890);let l={id:"",by:{},caption:"",extracted_text:"",filename:"",filetype:"",height:1152,width:1152,source:"generated",source_url:"",url:"",prompt:null,is_nsfw:!1,created_at:"",updated_at:""},c={aspect_ratio:i.t.Square,cfg_scale:10,character:"ai_character:pepe",id:"image_prompt:default",negative_prompt:"",positive_prompt:"",quality:"fast",seed:378254695419,styler:"ai_image_style:photorealistic",user_negative_prompt:"",user_positive_prompt:"",workflow:"workflow:combined",additional_config:{},aesthetic:null,seed_type:"random",user:"",start_ts:"",end_ts:""},s={top_text:"",bottom_text:"",top_text_size:"md",bottom_text_size:"md",additional_config:null,by:"",created_at:0,updated_at:0},d={panel_idx:0,meme_id:"",base_height:1152,base_image:"",base_width:1152,face_image:"",faceswap_strength:.5};function p(e){return{idx:e,id:e.toString(),in:"",panel_type:"image",panel_config:{image:l,prompt:c,text:"",text_overlay:s,faceswap:d},local:{src:"",prevSrc:"",selectedAspectRatio:i.t.Square,isExpandedPrompt:!1,progress:0,isGenerating:!1}}}function u(e){let t=n.i4[e],a={};for(let e=0;e<t;e++){let t=p(e);a[t.idx]=t}return a}function m(e){let t=u(o.L.One);return Object.values(e).reduce((e,a)=>{let n=a.panel_config.image,o="",l=i.t.Square;return n&&(o=n.source_url&&n.source_url.length>0?n.source_url:n.url,l=(0,r.vO)(n.width,n.height)),e[a.idx]={id:a.id,idx:a.idx,in:a.in,panel_type:a.panel_type,panel_config:{...t[0].panel_config,...a.panel_config},local:{selectedAspectRatio:l,isExpandedPrompt:!1,progress:0,src:o,prevSrc:o,isGenerating:!1}},e},{})}},7922:function(e,t,a){function n(){return Math.floor(1e12*Math.random())}function i(e){return e.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")}function o(e){let t=atob(e),a=t.length,n=new Uint8Array(new ArrayBuffer(a));for(let e=0;e<a;e++)n[e]=t.charCodeAt(e);return Array.from(n)}a.d(t,{RG:function(){return o},pw:function(){return i},qb:function(){return n}})},62300:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/search.3dc28276.svg",height:18,width:18,blurWidth:0,blurHeight:0}},12173:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/x.493d8304.png",height:45,width:41,blurDataURL:"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAMAAAAC2hU0AAAALVBMVEVMaXH+/v79/f3+/v79/f38/Pz8/Pz8/Pz9/f39/f39/f36+vr4+Pj9/f38/PwKLxeaAAAAD3RSTlMAS48j05o6aYO9pxgSs1uR71/vAAAACXBIWXMAABYlAAAWJQFJUiTwAAAANElEQVR4nBXBiRHAIAwEsT0/2AbSf7sZJJYcfNGR94SgzaYAt9w89pmAmso8KJyezXK40g8cqQDpZl1e6QAAAABJRU5ErkJggg==",blurWidth:7,blurHeight:8}},22566:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/logo-wide.572ec4d3.svg",height:256,width:702,blurWidth:0,blurHeight:0}}}]);