"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3214],{80951:function(e,t,a){a.d(t,{R:function(){return r}});var i=a(57348),l=a(15346);let n=e=>{let t=new Image;return t.src=e,t.complete},r=e=>{let{src:t,alt:a,width:r,height:o,draggable:s=!0,style:c,noAnimation:d,prefetch:u=!1,initialLoader:m=!1,className:h}=e,[p,f]=(0,l.useState)(!m),x=(0,l.useRef)(null);return(0,l.useEffect)(()=>{if(t&&u&&!n(t)){let e=new Image;e.src=t,e.onload=()=>{f(!0)}}},[t,u]),(0,l.useEffect)(()=>{t&&x.current&&x.current.complete&&f(!0)},[x,t]),(0,i.jsxs)("div",{className:"relative flex size-full max-h-full min-h-0 flex-col justify-center",children:[!p&&(0,i.jsx)("div",{className:"absolute left-0 top-0 size-full animate-pulse"}),(0,i.jsx)("img",{ref:x,style:c,src:t,alt:a,width:r,height:o,draggable:s,className:"flex max-h-full min-h-0 select-none ".concat(d?"":"transition-opacity duration-300"," ").concat(p?"opacity-100":"opacity-0","  ").concat(h),onLoad:()=>f(!0)})]})}},61858:function(e,t,a){a.d(t,{h:function(){return o}});var i=a(57348),l=a(45155),n=a(15346),r=a(18491);let o=e=>{let{imageUrl:t,priorityLoadImage:a,alt:o="Meme",isNsfw:s}=e,[c,d]=(0,n.useState)(s);return(0,i.jsxs)("div",{className:"relative size-full select-none overflow-hidden rounded-xl bg-white-400/10",children:[(0,i.jsx)(l.default,{draggable:!1,className:"absolute z-1 inset-0 size-full object-contain ".concat(c?"blur-xl":""),src:t,alt:o,width:640,height:640,sizes:"640px",quality:100,priority:!s&&a}),c&&(0,i.jsx)(r.T,{src:t,onClickShow:()=>d(!1)})]})}},37824:function(e,t,a){a.d(t,{O:function(){return n}});var i=a(57348),l=a(45155);let n=e=>{let{src:t,alt:a,id:n,margin:r="m-2",w:o="w-3.5",onClick:s}=e;return(0,i.jsx)("button",{id:n,className:"flex size-9 items-center justify-center rounded-full hover:bg-black-100 ".concat(r),onClick:s,children:(0,i.jsx)(l.default,{priority:!0,src:t,alt:a,className:"opacity-85 ".concat(o)})})}},2406:function(e,t,a){a.d(t,{I:function(){return d}});var i=a(57348),l=a(53350),n=a(26151),r=a(67425),o=a(87840),s=a(15346),c=a(35971);let d=e=>{let{itemId:t,initialVotes:a={up:[],down:[]},userId:d,size:u="sm",border:m="",readOnly:h=!1,addVoteApi:p,removeVoteApi:f,onClick:x}=e,{getItem:g,voteOnItem:v}=(0,c.useFeed)(),w=(0,s.useMemo)(()=>g(t),[g,t]),b=(0,s.useMemo)(()=>w?w.votes:a,[a,w]),y=(0,s.useMemo)(()=>b.up,[b.up,b.up.length]),j=(0,s.useMemo)(()=>b.down,[b.down,b.down.length]),_=(0,s.useMemo)(()=>y.length-j.length,[y,j]),k=(0,s.useMemo)(()=>y.some(e=>e.by===d),[y,y.length,d]),N=(0,s.useMemo)(()=>j.some(e=>e.by===d),[j,j.length,d]);return(0,i.jsxs)(n.g,{size:u,isDisabled:h,children:[(0,i.jsxs)(r.A,{isIconOnly:0===_,onClick:e=>{if(e.stopPropagation(),e.preventDefault(),x){x();return}k?(f(t,"upvote"),v(d,t,"remove","upvote")):(p(t,"upvote"),v(d,t,"add","upvote"))},className:"".concat(k?"bg-blue-600":""," ").concat(m," border-r-1"),variant:"ghost",color:k?"primary":"default",children:[(0,i.jsx)(l.JO,{icon:"majesticons:arrow-up",width:20,color:"white"}),0!==_&&(0,i.jsx)(o.E.div,{initial:{opacity:0,y:_<0?10:-10},animate:{opacity:1,y:0},exit:{opacity:0,y:0,transition:{duration:.1}},transition:{duration:.2},children:(0,i.jsx)("span",{className:"text-base font-semibold text-white-400",children:_})},_)]}),(0,i.jsx)(r.A,{isIconOnly:!0,onClick:e=>{if(e.stopPropagation(),e.preventDefault(),x){x();return}N?(f(t,"downvote"),v(d,t,"remove","downvote")):(p(t,"downvote"),v(d,t,"add","downvote"))},className:"".concat(N?"bg-warning-400":""," ").concat(m," border-l-1"),variant:"ghost",color:N?"warning":"default",children:(0,i.jsx)(l.JO,{icon:"majesticons:arrow-down",color:N?"black":"white",width:20})})]})}},30355:function(e,t,a){a.d(t,{B:function(){return o}});var i=a(57348),l=a(45155),n=a(13881),r=a(81727);let o=e=>{let{handle:t,avatar:a,name:o,createdAt:s,publishedAt:c}=e;return(0,i.jsxs)("div",{className:"flex items-center gap-3",children:[(0,i.jsx)(n.default,{href:"/u/".concat(t),children:(0,i.jsx)(l.default,{src:null!=a?a:"https://abs.twimg.com/sticky/default_profile_images/default_profile_normal.png",alt:null!=t?t:"Anonymous",width:48,height:48,className:"size-10 rounded-full bg-black-300"})}),(0,i.jsxs)("div",{className:"flex flex-1 flex-col justify-center",children:[(0,i.jsx)(n.default,{href:"/u/".concat(t),children:(0,i.jsx)("h2",{className:"text-sm font-bold",children:null!=o?o:"Anonymous"})}),(0,i.jsx)("h3",{className:"text-xs font-medium text-white-400/75",children:c?"Published ".concat((0,r.Po)(c)):"Created ".concat((0,r.Po)(s))})]})]})}},58422:function(e,t,a){a.d(t,{R:function(){return s}});var i=a(57348),l=a(92378),n=a(41223),r=a(71583),o=a(30422);let s=e=>{var t;let{prompt:a}=e;if(!a)return null;a.styler.replace("ai_image_style:","");let o=a.character.replace("ai_character:",""),s=null===(t=a.aesthetic)||void 0===t?void 0:t.replace("aesthetic:","");return(0,i.jsxs)(l.w,{classNames:{base:"pb-1"},children:[(0,i.jsx)(n.u,{className:"text-lg font-semibold pb-1",children:"Generation Details"}),(0,i.jsxs)(r.G,{className:"gap-6",children:[(0,i.jsx)(c,{title:"Positive Prompt",content:a.user_positive_prompt}),(0,i.jsx)(c,{title:"Negative Prompt",content:a.user_negative_prompt}),(0,i.jsxs)("div",{className:"grid grid-cols-2 gap-3",children:[(0,i.jsx)(c,{title:"Aesthetic",content:s,hideCopyButton:!0}),(0,i.jsx)(c,{title:"Character",content:o,hideCopyButton:!0}),(0,i.jsx)(c,{title:"Aspect Ratio",content:a.aspect_ratio,hideCopyButton:!0}),(0,i.jsx)(c,{title:"Seed",content:a.seed.toString()}),(0,i.jsx)(c,{title:"CFG Scale",content:a.cfg_scale.toString(),hideCopyButton:!0})]})]})]})},c=e=>{let{title:t="",content:a="",hideCopyButton:l=!1}=e;return(0,i.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,i.jsx)("p",{className:"text-xs text-white-400/50 font-medium",children:t}),(0,i.jsx)(o.Z,{hideSymbol:!0,hideCopyButton:l||!a,classNames:{base:"bg-[#27292C] min-h-[44px]",pre:"whitespace-pre-wrap max-w-full"},children:a||(0,i.jsx)("span",{className:"text-white-400/50 select-none",children:"N/A"})})]})}},13214:function(e,t,a){a.d(t,{k:function(){return er}});var i=a(57348),l=a(15346);let n=()=>{(0,l.useEffect)(()=>{if(window.innerWidth>1024){let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>document.body.style.overflow=e}{let e=window.getComputedStyle(document.body).overflow;return document.body.style.overflow="hidden",()=>document.body.style.overflow=e}},[])};var r=a(35878),o=a(67425),s=a(45155),c=a(16189),d=a(53350),u=a(81015);let m=e=>{let{id:t,saveFn:a=r.P.saveMeme,isSaved:n,variant:s="flat"}=e,[c,m]=(0,l.useState)(n),h=()=>{m(!c),a(t,c).catch(()=>{m(c)})};return(0,i.jsx)(u.e,{content:"Save to library",placement:"bottom",motionProps:{variants:{exit:{opacity:0,transition:{duration:.1,ease:"easeIn"}},enter:{opacity:1,transition:{duration:.15,ease:"easeOut"}}}},children:(0,i.jsx)(o.A,{isIconOnly:!0,size:"md",radius:"full",variant:"ghost",onClick:e=>{e.stopPropagation(),e.preventDefault(),h()},children:(0,i.jsx)(d.JO,{icon:c?"material-symbols:bookmark":"material-symbols:bookmark-outline",width:20})})})};var h=a(2406),p=a(37734),f=a(92378),x=a(71583),g=a(74859),v=a(51934),w=a(88036),b={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/plus.63a0d87f.svg",height:24,width:24,blurWidth:0,blurHeight:0},y=a(15667);let j=[],_=(0,g.k)(r.P.searchTags,1e3),k=e=>{let{tagId:t,tagName:a,minW:n="min-w-36",variant:r,onUpdateTag:o,onDeleteTag:c,onClick:d}=e,u=(0,l.useRef)(null),[m,h]=(0,l.useState)(a),[p,f]=(0,l.useState)(t),[x,g]=(0,l.useState)([]),[k,N]=(0,l.useState)(!1),[C,P]=(0,l.useState)(!1),W=async e=>{N(!0);let t=await _(e);t&&(g(t),N(!1))},S=e=>{if(e!==a)return N(!1),P(!1),g([]),null==o?void 0:o(e)},z=async()=>{g([]),N(!1),P(!0),await (null==c?void 0:c()),P(!1),h("")};return(0,i.jsx)(v.d,{ref:u,allowsCustomValue:!0,defaultInputValue:"",inputValue:m,defaultSelectedKey:"",selectedKey:p,defaultItems:j,items:x,maxLength:20,isLoading:k,isDisabled:C,className:"inline-flex w-auto max-w-0 ".concat(n),color:"default",variant:r,radius:"full",onBlur:()=>S(m),onInputChange:e=>{null!==e&&(h(e),""===e?g([]):e.length>2&&W(e))},onSelectionChange:e=>{f(e);let t=x.find(t=>t.id===e);t&&(g([]),h(t.name),S(t.name))},placeholder:"Add tag","aria-label":"Add tag",disableSelectorIconRotation:!0,selectorIcon:m.length>0?(0,i.jsx)(s.default,{src:y.Z,className:"w-2.5 opacity-75",alt:"Clear tag"}):(0,i.jsx)(s.default,{src:b,className:"w-3 opacity-75",alt:"Add tag"}),isClearable:!1,selectorButtonProps:{disableRipple:!0,onClick:()=>{m.length>0&&z()}},onKeyDown:e=>{var t,a;"Escape"===e.key?null===(t=u.current)||void 0===t||t.blur():"Enter"===e.key&&0===x.length&&(null===(a=u.current)||void 0===a||a.blur())},onClick:d,children:e=>(0,i.jsx)(w.R,{value:e.id,children:e.name},e.id)})},N=(0,g.k)(r.P.tagResource,1e3),C=e=>{let{memeId:t,tags:a,onUpdateTags:l}=e,n=a.length<10?[...a,{id:"",name:""}]:a,o=async e=>{l(a.filter(t=>t.id!==e));try{await r.P.untagResource(t,e)}catch(e){l(a)}},s=async(e,i)=>{let n=i.toLowerCase().replaceAll(" ","_").replaceAll("-","_"),o=[...a];o[e]={id:n,name:i},l(o);try{var s;await N(t,i),(null===(s=a[e])||void 0===s?void 0:s.id)&&await r.P.untagResource(t,a[e].id)}catch(e){l(a)}};return(0,i.jsx)("div",{className:"flex mb-3 gap-2 overflow-x-auto scrollbar-hide",children:n.map((e,t)=>(0,i.jsx)(k,{tagId:e.id,tagName:e.name,minW:"min-w-[124px]",variant:"faded",onUpdateTag:e=>s(t,e),onDeleteTag:()=>o(e.id)},"tag-pill-".concat(e.id,"-").concat(t)))})};var P={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/info.333102d7.svg",height:24,width:24,blurWidth:0,blurHeight:0};let W=(0,g.k)(r.P.updateMeme,1e3),S=e=>{var t;let{meme:a,setMeme:n}=e,r=(0,l.useCallback)(async e=>{a&&n({...a,tags:e})},[a,n]),o=(0,l.useCallback)(async e=>{if(a){n({...a,extracted_text:e});try{await W(a.id,{extracted_text:e})}catch(e){n(a)}}},[a,n]);return a?(0,i.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,i.jsx)(p.Y,{label:(0,i.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,i.jsx)("h3",{className:"text-lg font-semibold",children:"Extracted text"}),(0,i.jsx)(u.e,{placement:"bottom",content:(0,i.jsx)("div",{className:"w-52",children:"This is AI extracted text from the meme image. You can correct it if needed here."}),children:(0,i.jsx)(s.default,{src:P,width:19,height:19,alt:"Info"})})]}),placeholder:"This is AI extracted text from the meme image. You can correct it if needed here.",classNames:{base:"p-0 hover:outline-1 border-transparent",mainWrapper:"p-0",inputWrapper:"px-0 py-4 gap-2 bg-content1 hover:bg-content2",label:"flex px-4 text-lg !text-white-400 font-semibold",innerWrapper:"px-4",input:"text-white-400/50"},value:null!==(t=a.extracted_text)&&void 0!==t?t:"",onValueChange:o}),(0,i.jsxs)(f.w,{children:[(0,i.jsx)("header",{className:"p-4",children:(0,i.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,i.jsx)("h3",{className:"text-base font-semibold",children:"Keywords"}),(0,i.jsx)(u.e,{placement:"bottom",content:(0,i.jsx)("div",{className:"w-52",children:"The right set of keywords can help others find your meme."}),children:(0,i.jsx)(s.default,{src:P,width:16,height:16,alt:"Info"})})]})}),(0,i.jsx)(x.G,{className:"p-4 pt-0",children:(0,i.jsx)(C,{memeId:a.id,tags:a.tags,onUpdateTags:r})})]})]}):null};var z=a(46371),T=a(30355),V=a(12465),A=a(35971);let I=e=>{let{meme:t,onClose:a}=e,{removeItemFromFeed:n}=(0,A.useFeed)(),[s,c]=(0,l.useState)(!1),m=(0,l.useCallback)(async()=>{var e;let a=null===(e=t.posts)||void 0===e?void 0:e[0];a&&n(a)},[t,n]),h=(0,l.useCallback)(async()=>{await r.P.deleteMeme(t.id),n(t.id)},[t.id,n]),p=(0,l.useCallback)(async()=>{c(!0);try{await m(),await h(),a(),(0,V.yv)("Meme deleted",{variant:"success",autoHideDuration:2e3})}catch(e){(0,V.yv)("Failed to delete meme",{variant:"error",autoHideDuration:2e3})}c(!1)},[m,h,a]);return(0,i.jsx)(u.e,{content:"Delete",placement:"bottom",motionProps:{variants:{exit:{opacity:0,transition:{duration:.1,ease:"easeIn"}},enter:{opacity:1,transition:{duration:.15,ease:"easeOut"}}}},children:(0,i.jsx)(o.A,{isIconOnly:!0,size:"md",radius:"full",variant:"ghost",color:"danger",isLoading:s,onClick:p,children:(0,i.jsx)(d.JO,{icon:"fluent:delete-24-regular",width:18})})})};var E=a(58422),R=a(85432),F=a(13398),O=a(80951),B=a(52053),D=a(13881);let H=e=>{let{tags:t,wrap:a="flex-wrap",onClickTag:l}=e;return(0,i.jsx)("div",{className:"flex gap-2 ".concat(a),children:t.map((e,t)=>(0,i.jsx)(D.default,{href:"/trending?query=".concat(e),onClick:()=>null==l?void 0:l(e),children:(0,i.jsx)(B.z,{variant:"flat",children:e.replace("tag:","")})},"tag-".concat(e,"-").concat(t)))})},M=e=>{let{meme:t}=e;return(0,i.jsxs)(R.d,{itemClasses:{subtitle:"text-sm text-white-400/50",trigger:"text-base font-semibold",indicator:"text-lg",content:"pt-0 text-small"},variant:"shadow",selectionMode:"multiple",defaultSelectedKeys:["2","3","4"],children:[t.template_data?(0,i.jsx)(F.G,{"aria-label":t.template_data.title,startContent:(0,i.jsx)(O.R,{className:"size-12 rounded-md object-cover",src:t.template_data.image_url,alt:t.template_data.title}),subtitle:t.template_data.title,classNames:{title:"font-base text-sm text-white-400/50",subtitle:"text-large font-semibold text-white-400",content:"pb-4 pt-0"},title:"Meme Template",children:(0,i.jsx)("p",{className:"text-sm",children:t.template_data.about})},"1"):(0,i.jsx)(F.G,{hideIndicator:!0,isDisabled:!0,title:"Meme template","aria-label":"No template detected",subtitle:"No template detected"},"1"),t.extracted_text?(0,i.jsx)(F.G,{title:"Extracted text",classNames:{base:"pb-2 pt-0",trigger:"pt-4 pb-2 text-base font-semibold",content:"pb-2 pt-0"},children:(0,i.jsx)("p",{className:"text-sm",children:t.extracted_text})},"2"):(0,i.jsx)(F.G,{title:"Extracted text",classNames:{base:"pb-2 pt-0",trigger:"pt-4 pb-2 text-base font-semibold",content:"pb-2 pt-0"},subtitle:"No text was extracted","aria-label":"No extracted text",hideIndicator:!0,isDisabled:!0},"2"),t.tags.length>0?(0,i.jsx)(F.G,{classNames:{content:"pb-4 pt-0"},title:"Keywords (".concat(t.tags.length,")"),children:(0,i.jsx)(H,{tags:t.tags.map(e=>{let{name:t}=e;return t})})},"3"):(0,i.jsx)(F.G,{hideIndicator:!0,isDisabled:!0,title:"Tags","aria-label":"No tags added",subtitle:"No tags added"},"3")]})},U=e=>{let{meme:t}=e;if("generated"==t.source)return(0,i.jsx)(E.R,{prompt:t.prompt});if("composed"==t.source){var a,l;let e=Object.values(null!==(l=t.panels)&&void 0!==l?l:{}).find(e=>"meme"in e.panel_config);return e?(0,i.jsx)(E.R,{prompt:null===(a=e.panel_config)||void 0===a?void 0:a.prompt}):null}return(0,i.jsx)(M,{meme:t})},L=e=>{let{children:t}=e;return(0,i.jsx)("aside",{id:"modal-aside",className:"flex sm:min-w-96 max-w-full flex-1 flex-col gap-3 border-l border-white-400/10 bg-black-400 p-3 md:min-h-full md:max-w-96 md:flex-none xs:h-auto",children:t})};var G=a(59754),J=a(71402),q=a(73492),Z=a(73139),K=a(55771),Y=a(69467),X=a(55147),$=a(39543),Q=a(81727);let ee=e=>{var t,a,n;let{meme:d,setMeme:u,onClose:p}=e,f=(0,c.useRouter)(),{profile:x}=(0,J.useProfile)(),{removeItemFromFeed:g,appendMemesToFeed:v}=(0,A.useFeed)(),[w,b]=(0,l.useState)(!1),[y,j]=(0,l.useState)(!1),[_,k]=(0,l.useState)(!1),[N,C]=(0,l.useState)(!1),P=(0,l.useMemo)(()=>{var e;return Number(null==d?void 0:null===(e=d.posts)||void 0===e?void 0:e.length)>0},[d]),W=(0,l.useCallback)(async()=>{if(!d)return;j(!0);let e=d.id,t=d;if("generated"===d.source){let a=(0,Q.uZ)(),{newPanels:i}=await (0,z.P)(a,d);if(!i)throw Error("Failed to create composed meme");let l={0:{...i[0],panel_type:"generated",panel_config:{meme:d}}},n=await K.p.getConfig(),o=(0,q.xe)(l,n),s=await (0,X.jt)(o,Y.WV.One),c=o.find(e=>0===e.idx);if(!c)throw Error("Failed to find first panel");let{canvasWidth:u,canvasHeight:m}=(0,$.G)(Y.WV.One,c),h={filetype:"image/jpeg",bytes:Array.from(new Uint8Array(s)),width:u,height:m},p=await r.P.composedUpload(a,h).catch(e=>(console.error("Failed to compile composed meme",e),null));if(!p)throw Error("Failed composed upload");e=a,t={...d,id:a,url:p.url}}let a=await r.P.createPost({post_type:{meme:e}});if(!a)throw Error("Failed to create post");let i=new Date().getTime();t={...t,posts:[a.id],published_at:i,is_public:!0},j(!1),x&&(u(t),v([t],x),C(!0))},[v,d,x,u]),V=(0,l.useCallback)(()=>{d&&f.push("/studio?remix=".concat(d.id))},[d,f]);return(0,i.jsxs)(L,{children:[d&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("header",{className:"my-2 flex flex-col gap-5",children:(0,i.jsx)(T.B,{handle:d.creator_handle,name:d.creator_name,avatar:d.creator_avatar,createdAt:d.created_at,publishedAt:d.published_at})}),w?(0,i.jsx)(S,{meme:d,setMeme:u}):(0,i.jsx)(U,{meme:d}),(0,i.jsxs)("footer",{className:"flex justify-between gap-2 md:gap-3",children:[w?(0,i.jsx)(I,{meme:d,onClose:p}):(0,i.jsxs)("div",{className:"flex flex-1 gap-2 md:gap-3",children:[(0,i.jsx)(h.I,{size:"md",itemId:d.id,initialVotes:d.votes,userId:null!==(a=null==x?void 0:x.user.id)&&void 0!==a?a:"",addVoteApi:r.P.createMemeReaction,removeVoteApi:r.P.deleteMemeReaction}),(0,i.jsx)(m,{id:d.id,isSaved:null!==(n=d.is_saved)&&void 0!==n&&n})]}),d.is_creator&&w&&(0,i.jsx)(o.A,{variant:"solid",color:"primary",onClick:()=>b(!1),children:"Done"}),d.is_creator&&!w&&(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.A,{variant:"solid",onClick:()=>b(!0),children:"Edit"}),!P&&(0,i.jsx)(o.A,{variant:"solid",color:"primary",isLoading:y,onClick:W,children:"Post"})]}),d.source&&Y.FU.includes(d.source)&&!w&&P&&(0,i.jsx)(o.A,{variant:"solid",color:"primary",startContent:(0,i.jsx)(s.default,{src:Z.Z,alt:"Remix",className:"size-4"}),onClick:V,children:"Remix"})]})]}),N&&d&&(0,i.jsx)(G.F,{postId:null===(t=d.posts)||void 0===t?void 0:t[0],memeId:d.id,memeUrl:d.url,onClose:()=>C(!1)})]})};var et=a(37824),ea=a(13582);let ei=e=>{let{maxWidth:t="max-w-4xl",children:a}=e,{goBack:l}=(0,ea.useAppHistory)();return(0,i.jsxs)("main",{className:"relative flex max-h-full flex-1 flex-col bg-black-400 md:min-h-full md:overflow-hidden md:bg-transparent lg:overflow-hidden",children:[(0,i.jsx)(et.O,{src:y.Z,alt:"Close",onClick:l}),(0,i.jsx)("div",{className:"relative flex min-h-0 min-w-0 max-w-full flex-1 items-center justify-center md:m-3",children:(0,i.jsx)("div",{className:"relative flex size-full max-h-full min-h-0 min-w-0 items-center justify-center ".concat(t),children:a})})]})};var el=a(81254);let en=e=>{var t,a,l,n,r,o,c,d,u,m;let{meme:h}=e;return(0,i.jsx)(ei,{children:(0,i.jsx)("div",{className:"flex size-full max-h-full min-h-0 flex-row items-center justify-center gap-3 overflow-hidden px-0 lg:gap-6 lg:p-3",children:h&&(0,i.jsx)("div",{className:"w-full max-w-full min-h-0 max-h-full lg:w-[".concat(h.width,"px] lg:h-[").concat(h.height,"px] lg:rounded-xl border-1 border-white-400/5 bg-black-400 overflow-hidden"),children:"generated"===h.source?(0,i.jsx)(el.g,{id:"meme-lightbox-image",type:h.source,imageWidth:null!==(l=h.width)&&void 0!==l?l:1024,imageHeight:null!==(n=h.height)&&void 0!==n?n:1024,canvasWidth:null!==(r=h.width)&&void 0!==r?r:1024,canvasHeight:null!==(o=h.height)&&void 0!==o?o:1024,src:h.url,alt:h.caption,topText:null!==(c=null===(t=h.text_overlay)||void 0===t?void 0:t.top_text)&&void 0!==c?c:null,bottomText:null!==(d=null===(a=h.text_overlay)||void 0===a?void 0:a.bottom_text)&&void 0!==d?d:null,centerText:null,className:"max-h-canvas"}):(0,i.jsx)("div",{id:"meme-lightbox-image",className:"size-full flex items-center justify-center",children:(0,i.jsx)(s.default,{style:{aspectRatio:"".concat(h.width,"/").concat(h.height)},width:null!==(u=h.width)&&void 0!==u?u:1024,height:null!==(m=h.height)&&void 0!==m?m:1024,src:h.url,alt:h.caption,className:"size-full object-contain max-h-canvas"})})})})})},er=e=>{let{memeId:t,onClose:a}=e;n();let[o,s]=(0,l.useState)(null);return(0,l.useEffect)(()=>{let e=decodeURIComponent(t);r.P.getMeme(e).then(e=>{if(!e)return a();s(e)})},[t,a]),(0,l.useEffect)(()=>{let e=e=>{"Escape"===e.key&&a()};return window.addEventListener("keydown",e),()=>{window.removeEventListener("keydown",e)}},[a]),(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex size-full items-center justify-center bg-black-400/90 sm:overflow-y-auto md:overflow-hidden xs:overflow-y-auto",onClick:e=>{let t=e.target;t.closest("#modal-aside")||t.closest("#meme-lightbox-image")||a()},onDragOver:e=>(e.preventDefault(),e.stopPropagation(),!1),children:(0,i.jsxs)("div",{className:"flex size-full flex-1 flex-col sm:overflow-y-auto md:flex-row",children:[(0,i.jsx)(en,{meme:o}),(0,i.jsx)(ee,{meme:o,setMeme:s,onClose:a})]})})}},18491:function(e,t,a){a.d(t,{T:function(){return r}});var i=a(57348),l=a(67425),n=a(45155);let r=e=>{let{src:t,onClickShow:a}=e;return(0,i.jsxs)("div",{className:"absolute inset-0 bg-black/50 z-2 bg-white-400/10",onClick:e=>{e.stopPropagation(),e.preventDefault()},onMouseEnter:e=>{e.stopPropagation(),e.preventDefault()},children:[(0,i.jsx)(n.default,{src:t,alt:"NSFW",draggable:!1,className:"absolute z-0 inset-0 size-full object-cover blur-xl scale-[3]",width:640,height:640,sizes:"640px",quality:1,priority:!0}),(0,i.jsx)(l.A,{variant:"ghost",color:"danger",size:"sm",className:"p-1 font-medium z-3 absolute top-1/2 left-1/2 -translate-x-1/2 -translate-y-1/2 backdrop-blur-sm",onClick:a,children:"Show"})]})}},46371:function(e,t,a){a.d(t,{P:function(){return n}});var i=a(35878),l=a(69467);async function n(e,t){let a={0:{panel_type:"generated",panel_config:{meme:t.id}}},n=await i.P.createComposedMeme({meme_id:e,panel_layout:l.WV.One,panel_config_init:a});if(!n)throw Error("Failed to create composed meme");return{newPanels:n}}},59754:function(e,t,a){a.d(t,{F:function(){return P}});var i=a(57348),l=a(90226),n=a(67425),r=a(4930),o=a(45155),s=a(13881),c=a(16189),d=a(12465),u=a(15346),m=a(61858);let h=e=>{let{children:t,onClick:a}=e;return(0,i.jsx)("div",{className:"fixed inset-0 z-50 flex size-full max-h-full min-h-0 items-start xs:items-center justify-center overflow-y-auto overflow-x-hidden bg-white-100 px-4 py-[10vh]",onClick:a,children:t})};var p=a(53350),f=a(51934),x=a(5070),g=a(88036),v=a(35878);let w=(0,a(74859).k)(v.P.getDecks,1e3),b=e=>{var t,a;let{memeId:l,selectedDeck:n,onSelectDeck:r}=e,[o,s]=(0,u.useState)(!1),[c,d]=(0,u.useState)([]);return(0,u.useEffect)(()=>{s(!0),w({meme_id:l,start:0}).then(e=>{e&&d(e)}).finally(()=>{s(!1)})},[l]),(0,i.jsx)("div",{className:"flex gap-3 justify-between max-w-64",children:(0,i.jsx)("div",{className:"flex gap-1 items-center flex-1",children:(0,i.jsx)(f.d,{placeholder:"Save to deck",size:"lg",radius:"md",fullWidth:!0,classNames:{selectorButton:"h-10"},multiple:!0,isLoading:o,onSelectionChange:e=>{r(e)},selectedKey:null!=n?n:null,startContent:n?(0,i.jsx)(x.h,{className:"min-w-8",src:null!==(a=null===(t=c.find(e=>e.id===n))||void 0===t?void 0:t.cover_photo)&&void 0!==a?a:void 0,size:"sm",radius:"sm"}):(0,i.jsx)("div",{className:"size-8 min-w-8 flex items-center justify-center",children:(0,i.jsx)(p.JO,{className:"size-5 text-white-400/50",icon:"tabler:plus"})}),children:c.map(e=>{var t;return(0,i.jsx)(g.R,{value:e.id,title:e.title,description:"by @".concat(e.by.screen_name),startContent:(0,i.jsx)(x.h,{src:null!==(t=e.cover_photo)&&void 0!==t?t:void 0,size:"sm",radius:"sm",className:"min-w-8"}),classNames:{title:"font-semibold"}},e.id)})})})})};var y=a(71402),j=a(15667),_=a(93276),k=a(94787),N=a(54167);let C=e=>{let{memeId:t}=e,a=async()=>{let e=encodeURIComponent("".concat((0,N.L)()).concat((0,_.Wi)(t)));window.open("https://twitter.com/intent/tweet?text=".concat(e),"_blank")};return(0,i.jsxs)(n.A,{fullWidth:!0,className:"flex items-center justify-center gap-2 rounded-md bg-blue-500 px-5 py-1 text-sm",onClick:a,children:[(0,i.jsx)("p",{className:"text-lg",children:"Share on"}),(0,i.jsx)(o.default,{src:k.Z,alt:"X",className:"w-5"})]})},P=e=>{let{postId:t,memeId:a,memeUrl:p,onClose:f}=e,x=(0,c.useRouter)(),{profile:g}=(0,y.useProfile)(),[w,k]=(0,u.useState)(null),[N,P]=(0,u.useState)(!1),W=async()=>{try{if(!w)throw Error("Deck ID is missing");if(!t)throw Error("Post ID is missing");P(!0),await v.P.submitPostToDeck(w,{post_id:t})}catch(e){console.error(e),(0,d.yv)("Failed to add meme to deck",{variant:"error"})}finally{f(),P(!1)}};return(0,i.jsx)(h,{onClick:f,children:(0,i.jsxs)("form",{className:"relative flex w-full min-w-0 max-w-lg flex-col gap-3 rounded-xl bg-black-400 shadow-2xl",onClick:e=>e.stopPropagation(),children:[(0,i.jsxs)("header",{className:"relative flex w-full items-center justify-between px-3 pt-3",children:[(0,i.jsx)("div",{className:"flex items-center",children:g&&(0,i.jsx)(l.z,{className:"cursor-pointer",name:"",onClick:()=>{x.push("/u/".concat(null==g?void 0:g.user.twitter_handle)),f()},avatarProps:{src:g.twitter_profile.profile_image_url_https,size:"sm"}})}),(0,i.jsx)(n.A,{isIconOnly:!0,className:"rounded-full",variant:"light",size:"sm",onClick:f,children:(0,i.jsx)(o.default,{src:j.Z,alt:"close",className:"w-3"})})]}),(0,i.jsx)("main",{className:"min-h-72 gap-7 flex flex-col items-center justify-center",children:a&&p?(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)("h1",{className:"text-xl -mb-2",children:"Meme Posted to the Feed \uD83C\uDF89"}),(0,i.jsx)(s.default,{href:(0,_.Wi)(a),className:"size-40 md:size-52 z-40 rounded-md bg-black-100 object-contain",children:(0,i.jsx)(m.h,{imageUrl:p})}),(0,i.jsxs)("section",{className:"flex flex-col gap-5 p-3 items-center",children:[(0,i.jsx)(C,{memeId:a}),(0,i.jsxs)("div",{className:"flex w-1/2 items-center justify-center relative",children:[(0,i.jsx)("hr",{className:"w-full border-0.5 border-white-400/10"}),(0,i.jsx)("span",{className:"absolute px-2 bg-black-400 text-white-400/50",children:"or"})]}),(0,i.jsx)(b,{memeId:a,selectedDeck:w,onSelectDeck:e=>{k(e)}})]})]}):(0,i.jsx)(r.c,{})}),(0,i.jsx)("footer",{className:"h-14 p-3 flex items-center justify-end",children:w&&(0,i.jsx)(n.A,{size:"sm",variant:"solid",color:"primary",isLoading:N,onClick:W,children:"Done"})})]})})}},81254:function(e,t,a){a.d(t,{g:function(){return o}});var i=a(57348),l=a(45155),n=a(15346),r=a(55147);let o=e=>{let{type:t,src:a,topText:o,bottomText:s,centerText:c,id:d="image-canvas",imageWidth:u=1024,imageHeight:m=1024,canvasWidth:h=1024,canvasHeight:p=1024,alt:f="Generated Image",progress:x=100,className:g=""}=e,v=(0,n.useRef)(new Image),w=(0,n.useRef)(null),b=(0,n.useMemo)(()=>x&&x<100&&x>0,[x]);return(0,n.useEffect)(()=>{let e=v.current,i=w.current;if(i){if(!a&&!c){(0,r.el)({image:e,canvas:i,topText:null,bottomText:null,centerText:null,canvasWidth:1024,canvasHeight:1024,imageWidth:1024,imageHeight:1024});return}"generated"===t||"faceswap"===t?(e.onload=()=>{(0,r.el)({image:e,canvas:i,topText:o,bottomText:s,centerText:null,canvasWidth:h,canvasHeight:p,imageWidth:u,imageHeight:m})},e.src=a):"text"===t&&(e.height=m,e.width=u,(0,r.el)({image:e,canvas:i,topText:null,bottomText:null,centerText:c,canvasWidth:h,canvasHeight:p,imageWidth:u,imageHeight:m}))}},[s,p,h,c,m,u,a,o,t]),(0,i.jsx)("div",{id:d,className:"size-full transition-all flex items-center justify-center",children:b?(0,i.jsx)(l.default,{draggable:!1,priority:!0,src:a,alt:f,style:{borderRadius:"0px",filter:x<100?"blur(".concat(70/x,"px)"):"none",transition:"filter 0.5s"},className:"transition-all object-cover w-[".concat(u,"px] h-[").concat(m,"px] ").concat(g),width:u,height:m}):(0,i.jsx)("canvas",{ref:w,className:"w-full max-h-full object-cover ".concat(g)})})}},67733:function(e,t,a){a.d(t,{B5:function(){return o},HS:function(){return r},W$:function(){return d},WN:function(){return c},_j:function(){return n},e5:function(){return s},vO:function(){return u}});var i=a(69467),l=a(66353);let n={[i.WV.One]:1,[i.WV.TwoHorizontal]:2,[i.WV.TwoVertical]:2,[i.WV.Four]:4},r={[i.WV.One]:"grid-rows-1 h-fit w-fit",[i.WV.TwoHorizontal]:"grid-cols-2 w-full h-fit",[i.WV.TwoVertical]:"grid-rows-2 w-fit h-full",[i.WV.Four]:"grid-cols-2 grid-rows-2"},o={[i.WV.One]:1,[i.WV.TwoHorizontal]:.75,[i.WV.TwoVertical]:1024/768,[i.WV.Four]:1},s={[l.tB.Square]:[1024,1024],[l.tB.Landscape]:[1024,768],[l.tB.Portrait]:[768,1024]},c={[i.WV.One]:"h-auto w-fit",[i.WV.TwoHorizontal]:"w-full h-fit",[i.WV.TwoVertical]:"w-fit h-full",[i.WV.Four]:"h-auto w-fit"},d={[i.WV.One]:l.tB.Square,[i.WV.TwoHorizontal]:l.tB.Portrait,[i.WV.TwoVertical]:l.tB.Landscape,[i.WV.Four]:l.tB.Square},u=(e,t)=>10>Math.abs(e-t)?l.tB.Square:e>t?l.tB.Landscape:l.tB.Portrait},13582:function(e,t,a){a.r(t),a.d(t,{AppHistoryProvider:function(){return s},useAppHistory:function(){return c}});var i=a(57348),l=a(16189),n=a(12465),r=a(15346);let o=(0,r.createContext)({}),s=e=>{let{children:t}=e,a=(0,l.usePathname)(),s=(0,l.useRouter)(),[c,d]=(0,r.useState)([]),u=(0,r.useCallback)(function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/home",t=arguments.length>1?arguments[1]:void 0,a=e;c.length>1&&(a=c[c.length-2],void 0!==t&&a.includes(t)&&(a=e)),"string"!=typeof a&&(a="/home"),s.push(a,{scroll:!1})},[c,s]);return(0,r.useEffect)(()=>{d(e=>e[e.length-1]!==a?[...e,a]:e)},[a]),(0,i.jsxs)(o.Provider,{value:{goBack:u},children:[t,(0,i.jsx)(n.wT,{dense:!0,maxSnack:3})]})},c=()=>{let e=(0,r.useContext)(o);if(void 0===e)throw Error("useFeed must be used within AppHistoryProvider");return e}},73492:function(e,t,a){a.d(t,{eZ:function(){return d},r_:function(){return s},v2:function(){return o},xe:function(){return c}});var i=a(67733),l=a(35878),n=a(74859),r=a(71046);let o=(0,n.k)(l.P.updateMemePanel,1e3),s=(0,n.k)(l.P.postMemeTextOverlay,1e3);function c(e,t){return Object.values(e).map(e=>{var a,l,n,o,s,c,d,u,m,h,p,f,x,g,v,w,b,y,j,_,k,N,C,P,W,S,z,T,V,A,I,E,R,F,O;let B="text"===e.panel_type,D="generated"===e.panel_type,H="faceswap"===e.panel_type,M=e.panel_config,U=e.panel_config,L=e.panel_config,G={idx:e.idx,id:e.id,type:e.panel_type,image:{...r.CJ},text:{...r.M5},faceswap:{...r.U1}};if(B&&M)return{...G,text:{text:M.text}};if(H&&L)return{...G,image:{...r.CJ,src:null!==(a=L.swapped_image)&&void 0!==a?a:"",selectedAspectRatio:(0,i.vO)(null!==(l=null==L?void 0:L.base_width)&&void 0!==l?l:1024,null!==(n=null==L?void 0:L.base_height)&&void 0!==n?n:1024)},faceswap:{...r.U1,baseWidth:null==L?void 0:L.base_width,baseHeight:null==L?void 0:L.base_height,baseImage:null!==(o=L.base_image)&&void 0!==o?o:"",faceImage:null!==(s=L.face_image)&&void 0!==s?s:"",swappedImage:null!==(c=L.swapped_image)&&void 0!==c?c:"",strength:null!==(d=L.strength)&&void 0!==d?d:1}};if(!D||!U)return G;{let e=null===(u=U.prompt)||void 0===u?void 0:u.character,a=e&&"string"==typeof e&&null!==(C=t.characters.find(t=>t.id===e.replace("ai_character:","")))&&void 0!==C?C:r.CJ.selectedCharacter,l=null===(m=U.prompt)||void 0===m?void 0:m.styler,n=l&&"string"==typeof l&&null!==(P=t.stylers.find(e=>e.id===l.replace("ai_image_style:","")))&&void 0!==P?P:r.CJ.selectedStyler,o=(null===(h=U.prompt)||void 0===h?void 0:h.aesthetic)&&"string"==typeof(null===(p=U.prompt)||void 0===p?void 0:p.aesthetic)&&null!==(W=t.aesthetics.find(e=>{var t;return e.id===(null===(t=U.prompt)||void 0===t?void 0:t.aesthetic)}))&&void 0!==W?W:r.CJ.selectedAesthetic;return{...G,image:{...r.CJ,src:null!==(S=null===(f=U.meme)||void 0===f?void 0:f.url)&&void 0!==S?S:"",width:null!==(z=null===(x=U.meme)||void 0===x?void 0:x.width)&&void 0!==z?z:1024,height:null!==(T=null===(g=U.meme)||void 0===g?void 0:g.height)&&void 0!==T?T:1024,selectedAspectRatio:(0,i.vO)(null!==(V=null===(v=U.meme)||void 0===v?void 0:v.width)&&void 0!==V?V:1024,null!==(A=null===(w=U.meme)||void 0===w?void 0:w.height)&&void 0!==A?A:1024),posPrompt:null!==(I=null===(b=U.prompt)||void 0===b?void 0:b.user_positive_prompt)&&void 0!==I?I:"",negPrompt:null!==(E=null===(y=U.prompt)||void 0===y?void 0:y.user_negative_prompt)&&void 0!==E?E:"",guidanceScale:null!==(R=null===(j=U.prompt)||void 0===j?void 0:j.cfg_scale)&&void 0!==R?R:2.7,selectedCharacter:a,selectedStyler:n,selectedAesthetic:o,...U.text_overlay,topText:null!==(F=null===(_=U.text_overlay)||void 0===_?void 0:_.top_text)&&void 0!==F?F:"",bottomText:null!==(O=null===(k=U.text_overlay)||void 0===k?void 0:k.bottom_text)&&void 0!==O?O:"",id:null===(N=U.meme)||void 0===N?void 0:N.id}}}})}function d(e){let t={};return e.forEach(e=>{"text"===e.type?t[e.idx]={idx:e.idx,id:e.id,panel_type:"text",panel_config:{text:e.text.text},created_at:1e3*Date.now()}:t[e.idx]={idx:e.idx,id:e.id,panel_type:"generated",panel_config:{meme:{id:e.image.id,url:e.image.src,width:e.image.width,height:e.image.height},prompt:{user_positive_prompt:e.image.posPrompt,user_negative_prompt:e.image.negPrompt,cfg_scale:e.image.guidanceScale,aesthetic:e.image.selectedAesthetic,character:"ai_character:".concat(e.image.selectedCharacter.id),styler:"ai_image_style:".concat(e.image.selectedStyler.id),aspect_ratio:e.image.selectedAspectRatio},text_overlay:{top_text:e.image.topText,bottom_text:e.image.bottomText}},created_at:1e3*Date.now()}}),t}},71046:function(e,t,a){a.d(t,{CJ:function(){return n},M5:function(){return o},U1:function(){return r},ZA:function(){return s},fP:function(){return l},nv:function(){return c}});var i=a(99349);let l={name:"Photorealistic",id:"photorealistic",images:null},n={id:"",src:"",prevSrc:"",width:1024,height:1024,posPrompt:"",negPrompt:"",isExpandedPrompt:!1,seed:(0,i.q)(),seedType:"random",topText:"",bottomText:"",guidanceScale:2.7,selectedAspectRatio:"square",selectedAesthetic:null,selectedCharacter:{name:"Apu Apustaja",id:"apu_apustaja",images:{"hand-drawn":"https://memedeckblob.blob.core.windows.net/ai-characters/hand-drawn-apu-apustaja.png",photorealistic:"https://memedeckblob.blob.core.windows.net/ai-characters/photorealistic-apu-apustaja.png","ms-paint":"https://memedeckblob.blob.core.windows.net/ai-characters/ms-paint-apu-apustaja.png","pixel-art":"https://memedeckblob.blob.core.windows.net/ai-characters/pixel-art-apu-apustaja.png",cinematic:"https://memedeckblob.blob.core.windows.net/ai-characters/cinematic-apu-apustaja.png"}},selectedStyler:l,progress:0,isGenerating:!1,isRandomizing:!1},r={faceImage:"",baseImage:"",baseWidth:void 0,baseHeight:void 0,swappedImage:"",strength:1},o={text:""},s=[{idx:0,id:"0",type:"generated",image:{...n},text:{...o},faceswap:{...r}},{idx:1,id:"1",type:"generated",image:{...n},text:{...o},faceswap:{...r}},{idx:2,id:"2",type:"generated",image:{...n},text:{...o},faceswap:{...r}},{idx:3,id:"3",type:"generated",image:{...n},text:{...o},faceswap:{...r}}],c=(e,t)=>{switch(t.action){case"reset":return e.map(e=>e.idx!==t.idx?e:{...e,image:{...e.image,...n},text:{...e.text,...o},faceswap:{...e.faceswap,...r}});case"blank-slate":return[...s];case"update-panel":return e.map(e=>{var a,i;return e.idx!==t.idx?e:{...e,id:null!==(a=t.id)&&void 0!==a?a:e.id,type:null!==(i=t.type)&&void 0!==i?i:e.type,image:{...e.image,...t.image},text:{...e.text,...t.text},faceswap:{...e.faceswap,...t.faceswap}}});case"delete":return e.filter(e=>e.idx!==t.idx);default:return console.error("Unknown action type"),e}}},55771:function(e,t,a){a.d(t,{p:function(){return r},s:function(){return l}});var i=a(54167);let l=()=>i.cm?"wss://staging-api.memedeck.xyz/v1/generation/ws":i.BB||i.j7?"wss://api.memedeck.xyz/v1/generation/ws":"ws://127.0.0.1:8080/v1/generation/ws";class n{async getConfig(){return fetch("".concat(n.BASE_URL,"/generation/config")).then(e=>e.json())}async getRandomPrompt(){return fetch("".concat(n.BASE_URL,"/generation/prompt")).then(e=>e.json())}}n.BASE_URL=i.cm?"https://staging-api.memedeck.xyz/v1":i.BB||i.j7?"https://api.memedeck.xyz/v1":"http://127.0.0.1:8080/v1";let r=new n},69467:function(e,t,a){var i,l;a.d(t,{FU:function(){return n},WV:function(){return i},kl:function(){return r}});let n=["generated","composed"];function r(e){return!!e.tags&&e.tags.some(e=>"nsfw"===e.name)}(l=i||(i={})).One="one",l.TwoVertical="two-vertical",l.TwoHorizontal="two-horizontal",l.Four="four-square"},66353:function(e,t,a){var i,l;function n(e){return"library"===e?"generated":e}function r(e){switch(e){case"composed":case"upload":return"generated";default:return e}}a.d(t,{JY:function(){return n},fJ:function(){return r},tB:function(){return i}}),(l=i||(i={})).Square="square",l.Landscape="landscape",l.Portrait="portrait"},55147:function(e,t,a){a.d(t,{jt:function(){return g},el:function(){return p},mr:function(){return x}});var i=a(67733),l=a(69467);async function n(e){return await new Promise((t,a)=>{e.toBlob(e=>{if(!e){a(Error("Failed to create blob"));return}let i=new FileReader;i.onload=()=>{let e=i.result;t(new Uint8Array(e))},i.readAsArrayBuffer(e)},"image/jpeg")})}var r=a(39543),o=a(38857);async function s(e){let{ctx:t,url:a,x:i,y:l,panelWidth:n,panelHeight:r}=e,s=new Image;s.crossOrigin="Anonymous",s.src=a,await new Promise((e,t)=>{s.onload=e,s.onerror=t}),await (0,o.h)({ctx:t,image:s,targetWidth:n,targetHeight:r,imageWidth:s.width,imageHeight:s.height,anchorX:i,anchorY:l})}var c=a(54167);async function d(e){let{ctx:t,content:a,placement:i,x:l,y:n,maxWidth:r}=e;return new Promise(e=>{for(var o=a.split(" "),s="",d=[],u=0;u<o.length;u++){var m=s+o[u]+" ";t.measureText(m).width>r&&u>0?(d.push({text:s,y:n}),s=o[u]+" ",n+=100):s=m}if(d.push({text:s.trim(),y:n}),"bottom"===i){let e=100*d.length;d=d.map(t=>({text:t.text,y:t.y-e+100}))}if("center"===i){let e=100*d.length;d=d.map(t=>({text:t.text,y:t.y-e/2+50}))}d.forEach(e=>{(0,c.Dt)()?(t.strokeText(e.text,l,e.y),t.fillText(e.text,l,e.y)):(t.fillText(e.text,l,e.y),t.strokeText(e.text,l,e.y))}),e()})}async function u(e){return new Promise((t,a)=>{let i=new Image;i.crossOrigin="Anonymous",i.src="/memedeck:memedeck:meme-deck.os/_next/static/media/logo.650a12fc.png";let l=e.canvas.width,n=e.canvas.height,r=32;l>1024&&n>1024?r=64:(l>1024||n>1024)&&(r=48),i.onload=()=>{let a=l-r-10,o=n-r-10;e.save(),e.globalAlpha=.4,e.drawImage(i,a,o,r,r),e.restore(),t()},i.onerror=e=>{a(e)}})}let m="bold ".concat(80,"px Impact");function h(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1];e.font=m,e.fillStyle=t?"white":"black",e.strokeStyle=t?"black":"white",e.lineWidth=3,e.lineJoin="round",e.textAlign="center",(0,c.Dt)()&&(e.shadowColor=t?"black":"white",e.shadowBlur=6,e.shadowOffsetX=0,e.shadowOffsetY=0)}async function p(e){let{image:t,canvas:a,topText:i,bottomText:l,centerText:n,canvasWidth:r,canvasHeight:s,imageWidth:c,imageHeight:u}=e,m=a.getContext("2d");if(!m||(t.width=c,t.height=u,a.width=r,a.height=s,n?(m.fillStyle="white",m.fillRect(0,0,a.width,a.height)):await (0,o.h)({ctx:m,image:t,targetWidth:r,targetHeight:s,imageWidth:c,imageHeight:u}),!i&&!l&&!n))return;h(m,!n);let p=a.width-40,f=a.width/2,x=a.height/2,g=a.height-64;i&&await d({ctx:m,content:i,placement:"top",x:f,y:120,maxWidth:p}),n&&await d({ctx:m,content:n,placement:"center",x:f,y:x,maxWidth:p}),l&&await d({ctx:m,content:l,placement:"bottom",x:f,y:g,maxWidth:p})}async function f(e,t,a,i,l){return new Promise(n=>{e.fillStyle="black",e.fillRect(t,a,i,l),n()})}async function x(e){let{canvas:t,studioPanels:a,studioLayout:n}=e,o=t.getContext("2d");if(!o)throw Error("Failed to create canvas context");let c=a[0];if(!c)throw Error("Failed to find first panel");let{canvasWidth:m,canvasHeight:p}=(0,r.G)(n,c),{panelWidth:x,panelHeight:g}=(0,r.H)(n,m,p);t.width=m,t.height=p;let v=a.map(e=>"generated"===e.type||"faceswap"===e.type?e:null).filter(Boolean),w=a.map(e=>"text"===e.type?e:null).filter(Boolean);for(let e=0;e<Math.min(i._j[n],v.length+w.length);e++){let t=v.find(t=>t.idx===e),a=w.find(t=>t.idx===e),i=0,r=0;if(n===l.WV.TwoHorizontal?(i=e%2==0?0:x,r=0):n===l.WV.TwoVertical?(i=0,r=e%2==0?0:g):n===l.WV.Four&&(i=e%2==0?0:x,r=e<2?0:g),t&&t.image.src)try{await s({ctx:o,url:t.image.src,x:i,y:r,panelWidth:x,panelHeight:g}),h(o);let e=t.image.topText,a=t.image.bottomText,l=x-40,n=i+x/2,c=r+120,u=r+g-64;e&&await d({ctx:o,content:e,placement:"top",x:n,y:c,maxWidth:l}),a&&await d({ctx:o,content:a,placement:"bottom",x:n,y:u,maxWidth:l})}catch(e){console.error("Failed to load image from meme source",e)}else if(a){o.fillStyle="white",o.fillRect(i,r,x,g),h(o,!1);let e=x-40,t=i+x/2,l=r+g/2;await d({ctx:o,content:a.text.text,placement:"center",x:t,y:l,maxWidth:e})}}n===l.WV.TwoHorizontal?await f(o,x,0,10,p):n===l.WV.TwoVertical?await f(o,0,g,m,10):n===l.WV.Four&&(await f(o,x,0,10,p),await f(o,0,g,m,10)),await u(o)}async function g(e,t){let a=document.createElement("canvas");return await x({canvas:a,studioPanels:e,studioLayout:t}),n(a)}},39543:function(e,t,a){a.d(t,{G:function(){return n},H:function(){return r}});var i=a(67733),l=a(69467);function n(e,t){let a=0,i=0;if(e===l.WV.One){if("faceswap"===t.type){if(!t.faceswap.baseWidth||!t.faceswap.baseHeight)throw Error("Failed to find faceswap dimensions");a=t.faceswap.baseWidth,i=t.faceswap.baseHeight}else a=t.image.width,i=t.image.height}else if(e===l.WV.TwoVertical)a=1024,i=1536;else if(e===l.WV.TwoHorizontal)a=1536,i=1024;else if(e===l.WV.Four)a=2048,i=2048;else throw Error("Unsupported panel layout");return{canvasWidth:a,canvasHeight:i}}function r(e,t,a){let n=0,r=0;if(e===l.WV.One){let e=(0,i.vO)(t,a),l=i.e5[e];n=l[0],r=l[1]}else if(e===l.WV.TwoVertical)n=1024,r=768;else if(e===l.WV.TwoHorizontal)n=768,r=1024;else if(e===l.WV.Four)n=1024,r=1024;else throw Error("Unsupported panel layout");return{panelWidth:n,panelHeight:r}}},38857:function(e,t,a){a.d(t,{h:function(){return i}});async function i(e){let{ctx:t,image:a,targetWidth:i,targetHeight:l,imageWidth:n,imageHeight:r,anchorX:o=0,anchorY:s=0}=e;return new Promise(e=>{let c=Math.max(i/n,l/r),d=n*c,u=r*c;t.save(),t.beginPath(),t.rect(o,s,i,l),t.clip(),t.drawImage(a,o+(i-d)/2,s+(l-u)/2,d,u),t.restore(),e()})}},99349:function(e,t,a){a.d(t,{q:function(){return i}});function i(){return Math.floor(1e12*Math.random())}},73139:function(e,t){t.Z={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/magic.8c74570a.svg",height:18,width:18,blurWidth:0,blurHeight:0}}}]);