"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[177],{13296:function(e,t,a){a.d(t,{T:function(){return i}});var r=a(40538),n=a(74600);let i=()=>{let e=(0,n.useRouter)(),t=(0,n.usePathname)(),a=(0,n.useSearchParams)();return{openMemeModal:n=>{let i=new URLSearchParams(a.toString());i.delete("deckId"),i.delete("memeIndex");let l=encodeURIComponent(n.replace("meme:",""));i.set("memeId",l);let o=(0,r.wS)(t,i);e.push(o,{scroll:!1})}}}},74491:function(e,t,a){a.r(t),a.d(t,{FeedProvider:function(){return l},useFeed:function(){return o}});var r=a(59547),n=a(30912);let i=(0,n.createContext)(void 0),l=e=>{let{children:t}=e,[a,l]=(0,n.useState)([]),[o,s]=(0,n.useState)(!1),[u,d]=(0,n.useState)({}),[c,p]=(0,n.useState)(""),[f,m]=(0,n.useState)([]),[v,h]=(0,n.useState)(!1),[_,y]=(0,n.useState)(""),[w,g]=(0,n.useState)([]),[b,k]=(0,n.useState)(!1),[S,x]=(0,n.useState)([]),[C,D]=(0,n.useState)(!1),[M,P]=(0,n.useState)([]),[F,j]=(0,n.useState)(!1),T=(0,n.useCallback)(e=>a.find(t=>(t.post_type,t.post.id===e))||w.find(t=>t.id===e)||M.find(t=>t.id===e)||S.find(t=>t.id===e),[a,w,M,S]),E=(0,n.useCallback)((e,t,r,n)=>{let i=a.findIndex(e=>e.post.id===t),o=w.findIndex(e=>e.id===t),s=S.findIndex(e=>e.id===t),u=M.findIndex(e=>e.id===t);if(-1===i&&-1===o&&-1===s&&-1===u)return;let d=(t,a)=>{let i={...a[t]};return"add"===r?(i.reactions.push({react:n,by:e,id:":irrelevant:"+Math.random(),avatar:":irrelevant:"+Math.random(),handle:":irrelevant:"+Math.random(),name:":irrelevant:"+Math.random()}),i.reactions=i.reactions.filter(t=>t.by!==e||t.react!==("upvote"===n?"downvote":"upvote"))):i.reactions=i.reactions.filter(t=>t.by!==e),[...a.slice(0,t),i,...a.slice(t+1)]};-1!==i&&l(e=>d(i,e)),-1!==o&&g(e=>d(o,e)),-1!==s&&x(e=>d(s,e)),-1!==u&&P(e=>d(u,e))},[a,w,M,S]),I=(0,n.useCallback)((e,t)=>{l(a=>0===a.length?a:[...e.map(e=>({id:Math.random().toString(36).substring(2,15),post_type:"meme",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},reactions:[],votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()})),...a])},[]),U=(0,n.useCallback)((e,t)=>{l(a=>0===a.length?a:a.map(a=>{if("meme"in a&&a.post.id===e){let e=a.post;return{...a,post:{...e,...t}}}return a}))},[]),A=(0,n.useCallback)((e,t)=>{l(a=>0===a.length?a:[{id:Math.random().toString(36).substring(2,15),post_type:"deck",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,memes:Object.values(e.memes).map(e=>({...e,is_public:!0})),is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},reactions:[],votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()},...a])},[]),L=(0,n.useCallback)(e=>{l(t=>t.filter(t=>t.post.id!==e))},[]),R=(0,n.useCallback)(e=>{w.length>0&&g(t=>[e,...t]),S.length>0&&x(t=>[e,...t])},[w.length,S.length]);return(0,r.jsx)(i.Provider,{value:{feed:a,setFeed:l,hasFetchedFeed:o,setHasFetchedFeed:s,feedActions:u,setFeedActions:d,appendMemesToFeed:I,appendDeckToFeed:A,removeItemFromFeed:L,updateMemeInFeed:U,searchQuery:c,setSearchQuery:p,searchResults:f,setSearchResults:m,hasFetchedSearchResults:v,setHasFetchedSearchResults:h,librarySearchQuery:_,setLibrarySearchQuery:y,library:w,setLibrary:g,hasFetchedLibrary:b,setHasFetchedLibrary:k,uploads:S,setUploads:x,hasFetchedUploads:C,setHasFetchedUploads:D,saved:M,setSaved:P,hasFetchedSaved:F,setHasFetchedSaved:j,onUploadMeme:R,getItem:T,voteOnItem:E},children:t})},o=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useFeed must be used within a FeedProvider");return e}},47177:function(e,t,a){a.r(t),a.d(t,{UploadProvider:function(){return _},useUpload:function(){return y}});var r=a(59547),n=a(53703),i=a(30912);let l=e=>{let t=new FileReader;return new Promise((a,r)=>{t.onload=e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.result;if(!n){r(Error("Failed to read file"));return}a(new Uint8Array(n))},t.onerror=()=>r(t.error),t.readAsArrayBuffer(e)})};var o=a(82972);let s=e=>{let{text:t,textButton:a,onClick:n}=e;return(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[t,a&&n&&(0,r.jsx)(o.A,{variant:"solid",color:"success",size:"sm",className:"text-white-400",onClick:n,children:a})]})};var u=a(58741),d=a(56582),c=a(74600),p=a(74491),f=a(1463),m=a(39992),v=a(13296);let h=(0,i.createContext)({}),_=e=>{let{children:t}=e,a=(0,c.useRouter)(),{openMemeModal:o}=(0,v.T)(),{isPostingMemes:_,setIsHovering:y}=(0,d.O)(),{onUploadMeme:w}=(0,p.useFeed)(),[g,b]=(0,i.useState)([]),[k,S]=(0,i.useState)(),[x,C]=(0,i.useState)(!1),D=(0,i.useCallback)(async(e,t)=>{try{let a=e.name.slice(0,20),i=(0,n.yv)("Uploading ".concat(a),{variant:"info",persist:!0});S(i);let u=await l(e),d="";if(void 0!==t){let a=await f.P.postDeckSubmission({deckId:t,filename:(0,m.Df)(e.name),filetype:e.type,bytes:u});if(!a)throw Error("Failed to upload");d=a.meme_id}else{let t=await f.P.postMeme({filename:(0,m.Df)(e.name),filetype:e.type,bytes:u});if(!t)throw Error("Failed to upload");d=t.id,b(e=>[t,...e]),w(t)}(0,n.sy)(k),S(void 0);let c=(0,n.yv)((0,r.jsx)(s,{text:"Successfully uploaded",textButton:"View",onClick:()=>{(0,n.sy)(c),o(d)}}),{variant:"success",autoHideDuration:3e3})}catch(e){console.error(e),(0,n.yv)("Failed to upload some files",{variant:"error"})}},[k,o,w,b]),M=(0,i.useCallback)(async e=>{try{let t=(0,m.Df)(e),a=t.slice(0,20),i=(0,n.yv)("Uploading ".concat(a),{variant:"info",persist:!0});S(i);let l=await f.P.postMeme({filename:t,filetype:"image",source_url:e});if(!l)throw Error("Failed to paste link");b(e=>[l,...e]),w(l),(0,n.sy)(k),S(void 0);let u=(0,n.yv)((0,r.jsx)(s,{text:"Successfully pasted link",textButton:"View",onClick:()=>{(0,n.sy)(u),o(l.id)}}),{variant:"success",autoHideDuration:3e3})}catch(e){console.error(e),(0,n.yv)("Failed to paste link",{variant:"error"})}},[k,o,w]),P=(0,i.useMemo)(()=>(0,u.k)(D,1e3),[D]),F=(0,i.useCallback)(async(e,t)=>{if(void 0===k){if(e.size>33554432){(0,n.yv)("Please upload files 32MB or less",{variant:"error"});return}return P(e,t)}},[P,k]),j=(0,i.useCallback)(async e=>{if(e.clipboardData){let t=e.clipboardData.items;for(let e=0;e<t.length;e++){let a=t[e];if(a.type.includes("image")){let e=a.getAsFile();e&&await F(e)}}}},[F]);(0,i.useEffect)(()=>(window.addEventListener("paste",j),()=>{window.removeEventListener("paste",j)}),[j]);let T=async e=>{if(!(e.dataTransfer.items.length>0)||!e.dataTransfer.items[0].type.includes("image"))return!1;e.preventDefault(),y(!1),C(!0);let t=e.dataTransfer.files;try{for(let e=0;e<t.length;e++){let a=t[e];a.type.includes("image")&&await F(a)}_||a.push("/library")}catch(e){console.error(e)}finally{C(!1)}};return(0,r.jsx)(h.Provider,{value:{uploads:g,setUploads:b,startUpload:F,pasteImageLink:M,isBatchUploading:x},children:(0,r.jsx)("div",{className:"flex min-h-0 w-full min-w-0 flex-1",onDragOver:e=>{e.preventDefault(),e.dataTransfer.items.length>0&&e.dataTransfer.items[0].type.includes("image")&&y(!0)},onDragLeave:()=>y(!1),onDrop:T,children:t})})},y=()=>(0,i.useContext)(h)},58741:function(e,t,a){a.d(t,{k:function(){return r}});let r=(e,t)=>{let a=null;return function(){for(var r=arguments.length,n=Array(r),i=0;i<r;i++)n[i]=arguments[i];return new Promise((r,i)=>{let l=async()=>{a&&clearTimeout(a);try{let t=await e(...n);r(t)}catch(e){i(e)}a=null};a&&clearTimeout(a),a=setTimeout(l,t)})}}},39992:function(e,t,a){a.d(t,{Df:function(){return n},Po:function(){return r},RL:function(){return i}});let r=e=>{let t=new Date(e/1e6),a=Math.round((new Date().getTime()-t.getTime())/1e3),r=Math.round(a/60),n=Math.round(r/60),i=Math.round(n/24);return a<60?"".concat(a,"s ago"):r<60?"".concat(r,"m ago"):n<24?"".concat(n,"h ago"):"".concat(i," day").concat(1===i?"":"s"," ago")},n=e=>e.replace(/[^a-z0-9]/gi,"_").toLowerCase(),i="image/*,.jpg_large,.png_large,.jpeg_large,.jpg_small,.png_small,.jpeg_small"}}]);