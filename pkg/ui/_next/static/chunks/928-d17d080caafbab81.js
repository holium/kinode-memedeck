(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[928],{9928:function(e,t,r){Promise.resolve().then(r.bind(r,9577))},9577:function(e,t,r){"use strict";r.r(t),r.d(t,{Page:function(){return m}});var a=r(91104),n=r(63137),i=r(26816),l=r(41116),s=r(33968),o=r(71668),u=r(41908),d={src:"/memedeck:memedeck:meme-deck.os/_next/static/media/cloud.c8336d47.svg",height:74,width:74,blurWidth:0,blurHeight:0},c=r(83301);let f=()=>{let{isBatchUploading:e}=(0,o.useUpload)();return(0,a.jsx)("div",{className:"relative size-full min-w-0 p-3",children:(0,a.jsx)("div",{className:"relative flex size-full min-w-0 items-center justify-center rounded-xl border-3 border-dashed border-blue-400",children:e?(0,a.jsx)(u.c,{}):(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center gap-3",children:[(0,a.jsx)(c.default,{src:d,width:64,height:64,alt:"cloud",loading:"eager",className:"size-24"}),(0,a.jsx)("h2",{className:"text-center text-xl font-semibold text-white-400",children:"Drop bangers to upload"})]})})})},m=e=>{let{children:t,isGated:r=!0,border:o="xs:border-0 sm:border-x border-white-400/15"}=e,u=(0,i.useRouter)(),{profile:d,setProfile:c,isHovering:m,isPostingMemes:p}=(0,l.useProfile)();return(0,n.useEffect)(()=>{r&&!d&&s.P.getMe().then(c).catch(e=>{console.error(e),u.push("/")})},[r,d,u,c]),(0,a.jsx)("div",{className:"relative size-full min-w-0 xs:pb-16 ".concat(o),children:m&&!p?(0,a.jsx)(f,{}):t})}},98127:function(e,t,r){"use strict";r.d(t,{T:function(){return i}});var a=r(17412),n=r(26816);let i=()=>{let e=(0,n.useRouter)(),t=(0,n.usePathname)(),r=(0,n.useSearchParams)(),i=e=>{let n=new URLSearchParams(r.toString());n.delete("deckId"),n.delete("memeIndex");let i=encodeURIComponent(e.replace("meme:",""));return n.set("memeId",i),(0,a.wS)(t,n)};return{openMemeModal:t=>{let r=i(t);e.push(r,{scroll:!1})},getMemeModalPath:i}}},60402:function(e,t,r){"use strict";r.r(t),r.d(t,{FeedProvider:function(){return l},useFeed:function(){return s}});var a=r(91104),n=r(63137);let i=(0,n.createContext)(void 0),l=e=>{let{children:t}=e,[r,l]=(0,n.useState)([]),[s,o]=(0,n.useState)(!1),[u,d]=(0,n.useState)({}),[c,f]=(0,n.useState)(""),[m,p]=(0,n.useState)([]),[v,h]=(0,n.useState)(!1),[y,w]=(0,n.useState)(""),[_,b]=(0,n.useState)([]),[g,x]=(0,n.useState)(!1),[k,S]=(0,n.useState)([]),[C,D]=(0,n.useState)(!1),[P,j]=(0,n.useState)([]),[F,M]=(0,n.useState)(!1),T=(0,n.useCallback)(e=>r.find(t=>(t.post_type,t.post.id===e))||_.find(t=>t.id===e)||P.find(t=>t.id===e)||k.find(t=>t.id===e),[r,_,P,k]),E=(0,n.useCallback)((e,t,a,n)=>{let i=r.findIndex(e=>e.post.id===t),s=_.findIndex(e=>e.id===t),o=k.findIndex(e=>e.id===t),u=P.findIndex(e=>e.id===t);if(-1===i&&-1===s&&-1===o&&-1===u)return;let d=(t,r)=>{let i={...r[t]},l={react:n,by:e,id:":irrelevant:"+Math.random(),avatar:":irrelevant:"+Math.random(),handle:":irrelevant:"+Math.random(),name:":irrelevant:"+Math.random()};return"add"===a?"upvote"===n?(i.votes.up.push(l),i.votes.down=i.votes.down.filter(t=>t.by!==e)):(i.votes.down.push(l),i.votes.up=i.votes.up.filter(t=>t.by!==e)):"upvote"===n?i.votes.up=i.votes.up.filter(t=>t.by!==e):i.votes.down=i.votes.down.filter(t=>t.by!==e),[...r.slice(0,t),i,...r.slice(t+1)]};-1!==i&&l(e=>d(i,e)),-1!==s&&b(e=>d(s,e)),-1!==o&&S(e=>d(o,e)),-1!==u&&j(e=>d(u,e))},[r,_,P,k]),N=(0,n.useCallback)((e,t)=>{l(r=>0===r.length?r:[...e.map(e=>({id:Math.random().toString(36).substring(2,15),post_type:"meme",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()})),...r])},[]),U=(0,n.useCallback)((e,t)=>{l(r=>0===r.length?r:r.map(r=>{if("meme"in r&&r.post.id===e){let e=r.post;return{...r,post:{...e,...t}}}return r}))},[]),I=(0,n.useCallback)((e,t)=>{l(r=>0===r.length?r:[{id:Math.random().toString(36).substring(2,15),post_type:"deck",by:t.twitter_profile.id,by_avatar:t.twitter_profile.profile_image_url_https,by_handle:t.twitter_profile.screen_name,by_name:t.twitter_profile.name,post:{...e,memes:Object.values(e.memes).map(e=>({...e,is_public:!0})),is_creator:!0,creator_name:e.creator_name,creator_handle:e.creator_handle,creator_avatar:e.creator_avatar},votes:{up:[],down:[]},created_at:1e6*Date.now(),updated_at:1e6*Date.now(),published_at:1e6*Date.now()},...r])},[]),A=(0,n.useCallback)(e=>{l(t=>t.filter(t=>t.post.id!==e))},[]),z=(0,n.useCallback)(e=>{_.length>0&&b(t=>[e,...t]),k.length>0&&S(t=>[e,...t])},[_.length,k.length]);return(0,a.jsx)(i.Provider,{value:{feed:r,setFeed:l,hasFetchedFeed:s,setHasFetchedFeed:o,feedActions:u,setFeedActions:d,appendMemesToFeed:N,appendDeckToFeed:I,removeItemFromFeed:A,updateMemeInFeed:U,searchQuery:c,setSearchQuery:f,searchResults:m,setSearchResults:p,hasFetchedSearchResults:v,setHasFetchedSearchResults:h,librarySearchQuery:y,setLibrarySearchQuery:w,library:_,setLibrary:b,hasFetchedLibrary:g,setHasFetchedLibrary:x,uploads:k,setUploads:S,hasFetchedUploads:C,setHasFetchedUploads:D,saved:P,setSaved:j,hasFetchedSaved:F,setHasFetchedSaved:M,onUploadMeme:z,getItem:T,voteOnItem:E},children:t})},s=()=>{let e=(0,n.useContext)(i);if(void 0===e)throw Error("useFeed must be used within a FeedProvider");return e}},71668:function(e,t,r){"use strict";r.r(t),r.d(t,{UploadProvider:function(){return y},useUpload:function(){return w}});var a=r(91104),n=r(36623),i=r(63137);let l=e=>{let t=new FileReader;return new Promise((r,a)=>{t.onload=e=>{var t;let n=null===(t=e.target)||void 0===t?void 0:t.result;if(!n){a(Error("Failed to read file"));return}r(new Uint8Array(n))},t.onerror=()=>a(t.error),t.readAsArrayBuffer(e)})};var s=r(57826);let o=e=>{let{text:t,textButton:r,onClick:n}=e;return(0,a.jsxs)("div",{className:"flex items-center gap-3",children:[t,r&&n&&(0,a.jsx)(s.A,{variant:"solid",color:"success",size:"sm",className:"text-white-400",onClick:n,children:r})]})};var u=r(29125),d=r(41116),c=r(26816),f=r(60402),m=r(33968),p=r(4180),v=r(98127);let h=(0,i.createContext)({}),y=e=>{let{children:t}=e,r=(0,c.useRouter)(),{openMemeModal:s}=(0,v.T)(),{isPostingMemes:y,setIsHovering:w}=(0,d.useProfile)(),{onUploadMeme:_}=(0,f.useFeed)(),[b,g]=(0,i.useState)([]),[x,k]=(0,i.useState)(),[S,C]=(0,i.useState)(!1),D=(0,i.useCallback)(async(e,t)=>{try{(0,n.sy)();let r=e.name.slice(0,20),i=(0,n.yv)("Uploading ".concat(r),{variant:"info",persist:!0});k(i);let u=await l(e),d="";if(void 0!==t){let r=await m.P.postDeckSubmission({deckId:t,filename:(0,p.Df)(e.name),filetype:e.type,bytes:u});if(!r)throw Error("Failed to upload");d=r.meme_id}else{let t=await m.P.postMeme({filename:(0,p.Df)(e.name),filetype:e.type,bytes:u});if(!t)throw Error("Failed to upload");d=t.id;let r={...t,votes:{up:[],down:[]}};g(e=>[r,...e]),_(r)}(0,n.sy)(x),k(void 0);let c=(0,n.yv)((0,a.jsx)(o,{text:"Successfully uploaded",textButton:"View",onClick:()=>{(0,n.sy)(c),s(d)}}),{variant:"success",autoHideDuration:3e3})}catch(e){console.error(e),k(void 0),(0,n.sy)(),(0,n.yv)("Failed to upload some memes",{variant:"error"})}},[x,s,_,g]),P=(0,i.useCallback)(async e=>{try{let t=(0,p.Df)(e),r=t.slice(0,20),i=(0,n.yv)("Uploading ".concat(r),{variant:"info",persist:!0});k(i);let l=await m.P.postMeme({filename:t,filetype:"image",source_url:e});if(!l)throw Error("Failed to paste link");g(e=>[l,...e]),_(l),(0,n.sy)(x),k(void 0);let u=(0,n.yv)((0,a.jsx)(o,{text:"Successfully pasted link",textButton:"View",onClick:()=>{(0,n.sy)(u),s(l.id)}}),{variant:"success",autoHideDuration:3e3})}catch(e){console.error(e),(0,n.yv)("Failed to paste link",{variant:"error"})}},[x,s,_]),j=(0,i.useMemo)(()=>(0,u.k)(D,1e3),[D]),F=(0,i.useCallback)(async(e,t)=>{if(void 0===x){if(e.size>33554432){(0,n.yv)("Please upload files 32MB or less",{variant:"error"});return}return j(e,t)}},[j,x]),M=(0,i.useCallback)(async e=>{if(e.clipboardData){let t=e.clipboardData.items;for(let e=0;e<t.length;e++){let r=t[e];if(r.type.includes("image")){let e=r.getAsFile();e&&await F(e)}}}},[F]);(0,i.useEffect)(()=>(window.addEventListener("paste",M),()=>{window.removeEventListener("paste",M)}),[M]);let T=async e=>{if(!(e.dataTransfer.items.length>0)||!e.dataTransfer.items[0].type.includes("image"))return!1;e.preventDefault(),w(!1),C(!0);let t=e.dataTransfer.files;try{for(let e=0;e<t.length;e++){let r=t[e];r.type.includes("image")&&await F(r)}y||r.push("/library")}catch(e){console.error(e)}finally{C(!1)}};return(0,a.jsx)(h.Provider,{value:{uploads:b,setUploads:g,startUpload:F,pasteImageLink:P,isBatchUploading:S},children:(0,a.jsx)("div",{className:"flex min-h-0 w-full min-w-0 flex-1",onDragOver:e=>{e.preventDefault(),e.dataTransfer.items.length>0&&e.dataTransfer.items[0].type.includes("image")&&w(!0)},onDragLeave:()=>w(!1),onDrop:T,children:t})})},w=()=>(0,i.useContext)(h)},29125:function(e,t,r){"use strict";r.d(t,{D:function(){return a},k:function(){return n}});let a=(e,t)=>{let r=null;return function(){for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];r&&clearTimeout(r),r=setTimeout(()=>{r&&clearTimeout(r);let t=e(...n);return r=null,t},t)}},n=(e,t)=>{let r=null;return function(){for(var a=arguments.length,n=Array(a),i=0;i<a;i++)n[i]=arguments[i];return new Promise((a,i)=>{let l=async()=>{r&&clearTimeout(r);try{let t=await e(...n);a(t)}catch(e){i(e)}r=null};r&&clearTimeout(r),r=setTimeout(l,t)})}}},17412:function(e,t,r){"use strict";function a(e,t){return t.toString().length?"".concat(e,"?").concat(t.toString()):e}r.d(t,{wS:function(){return a}})}}]);